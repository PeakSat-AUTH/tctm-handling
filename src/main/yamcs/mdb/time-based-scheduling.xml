<?xml version="1.0" encoding="UTF-8"?>
<xtce:SpaceSystem name="time-based-scheduling" xmlns:xtce="http://www.omg.org/spec/XTCE/20180204" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.omg.org/spec/XTCE/20180204 https://www.omg.org/spec/XTCE/20180204/SpaceSystem.xsd" shortDescription="This is a bogus satellite telemetry and telecommand database." operationalStatus="unittest">

  <!--Time-Based Sceduling Service (ST(11)) Commands -->
    <xtce:CommandMetaData>

        <xtce:ArgumentTypeSet>
            <xtce:AggregateArgumentType name="TC_header_aggr">
                <xtce:MemberList>
                    <xtce:Member typeRef="/dt/packet_version_number" name="packet_version_number" initialValue="0"/>
                    <xtce:Member typeRef="/dt/packet_type" name="packet_type" initialValue="TC"/>
                    <xtce:Member typeRef="/dt/secondary_header_flag" name="secondary_header_flag" initialValue="1"/>
                    <xtce:Member typeRef="/dt/application_process_ID" name="application_process_ID" initialValue="OBC"/>
                    <xtce:Member typeRef="/dt/sequence_flags" name="sequence_flags" initialValue="3"/>
                    <xtce:Member typeRef="/dt/int4_t" name="PUS_version_number" initialValue="2"/>
                    <xtce:Member typeRef="/dt/completion_ack" name="completion_ack" initialValue="completion_ack"/>
                    <xtce:Member typeRef="/dt/progress_of_execution_ack" name="progress_of_execution_ack" initialValue="progress_of_execution_ack"/>
                    <xtce:Member typeRef="/dt/start_of_execution_ack" name="start_of_execution_ack" initialValue="start_of_execution_ack"/>
                    <xtce:Member typeRef="/dt/acceptance_ack" name="acceptance_ack" initialValue="acceptance_ack"/>
                    <xtce:Member typeRef="/dt/service_type_ID_TC" name="service_type_ID"/>
                    <xtce:Member typeRef="/dt/message_subtype_ID_TC" name="message_subtype_ID"/>
                    <xtce:Member typeRef="/dt/uint16_t" name="source_ID" initialValue="5"/>
                </xtce:MemberList>
            </xtce:AggregateArgumentType>

            <xtce:AggregateArgumentType name="TC(3,1)args">
                <xtce:MemberList>
                    <xtce:Member typeRef="/dt/release_time_calendar" name="release_time"/>
                    <xtce:Member typeRef="/dt/uint8_t" name="new_structure_id"/>
                    <xtce:Member typeRef="/dt/uint32_t" name="collection_interval_milliseconds"/>
                    <xtce:Member typeRef="/dt/uint16_t{1-10}" name="total_parameters"/>
                    <xtce:Member typeRef="/dt/parameterIdArray_t" name="parameters" /> <!-- This isnt dynamic yet. The parameterId_Array's size depends on the total_parameters ARGUMENT which in this case is only an aggregate MEMBER, so yamcs doesnt recognise it as an argument-->
                </xtce:MemberList>
            </xtce:AggregateArgumentType>  

            <xtce:AggregateArgumentType name="TC(3,1)_aggregate">
                <xtce:MemberList>
                    <xtce:Member typeRef="TC_header_aggr" name="TC_header"/>
                    <xtce:Member typeRef="TC(3,1)args" name="TC(3,1)_arguments"/>
                </xtce:MemberList>
            </xtce:AggregateArgumentType>

            <xtce:ArrayArgumentType arrayTypeRef="TC(3,1)_aggregate" name="TC(3,1)_array">
                <xtce:DimensionList>
                    <xtce:Dimension>
                        <xtce:StartingIndex>
                            <xtce:FixedValue>0</xtce:FixedValue>
                        </xtce:StartingIndex>
                        <xtce:EndingIndex>
                            <xtce:DynamicValue>
                                <xtce:ArgumentInstanceRef argumentRef="N" />
                                <xtce:LinearAdjustment intercept="-1"/>
                            </xtce:DynamicValue>
                        </xtce:EndingIndex>
                    </xtce:Dimension>
                </xtce:DimensionList>
            </xtce:ArrayArgumentType>
         
        </xtce:ArgumentTypeSet>


        <xtce:MetaCommandSet>
            <xtce:MetaCommand name="TC(11,4)_insert_activity_into_time_based_schedule" abstract="true">
                <xtce:BaseMetaCommand metaCommandRef="/pus/Header_TC">
                    <xtce:ArgumentAssignmentList>
                        <xtce:ArgumentAssignment argumentName="service_type_ID" argumentValue="11" />
                        <xtce:ArgumentAssignment argumentName="message_subtype_ID" argumentValue="4" /> <!--I dont think /pus/ was necessary since we assign the arguments that are inside /pus/Header_TC-->
                    </xtce:ArgumentAssignmentList>
                </xtce:BaseMetaCommand>
                <xtce:ArgumentList>
                    <xtce:Argument argumentTypeRef="/dt/uint16_t" name="N" />
                </xtce:ArgumentList>
                <xtce:CommandContainer name="TC(11,4)_insert_activity_into_time_based_schedule">
                    <xtce:EntryList>
                        <xtce:ArgumentRefEntry argumentRef="N" />
                    </xtce:EntryList>
                    <xtce:BaseContainer containerRef="/pus/Header_TC" />
                </xtce:CommandContainer>
            </xtce:MetaCommand>

            <xtce:MetaCommand name="TC(11,4)(17,1)_time_based_scheduled_are_you_alive_connection">
                <xtce:BaseMetaCommand metaCommandRef="TC(11,4)_insert_activity_into_time_based_schedule">
                </xtce:BaseMetaCommand>
                    <xtce:CommandContainer name="TC(11,4)(17,1)_time_based_scheduled_are_you_alive_connection">
                        <xtce:EntryList>
                        </xtce:EntryList>
                        <xtce:BaseContainer containerRef="TC(11,4)_insert_activity_into_time_based_schedule" />
                    </xtce:CommandContainer>
            </xtce:MetaCommand>

            <xtce:MetaCommand name="TC(11,4)(3,1)_time_based_scheduled_create_a_parameter_report_structure">
                <xtce:BaseMetaCommand metaCommandRef="TC(11,4)_insert_activity_into_time_based_schedule">
                </xtce:BaseMetaCommand>
                <xtce:ArgumentList>
                   <xtce:Argument argumentTypeRef="TC(3,1)_array" name="TC(3,1)_array"/>
                </xtce:ArgumentList>
                <xtce:CommandContainer name="TC(3,1)_create_a_parameter_report_structure">
                    <xtce:EntryList>
                        <xtce:ArgumentRefEntry argumentRef="TC(3,1)_array"></xtce:ArgumentRefEntry>
                    </xtce:EntryList>
                    <xtce:BaseContainer containerRef="TC(11,4)_insert_activity_into_time_based_schedule" />
                </xtce:CommandContainer>
            </xtce:MetaCommand>

            <xtce:MetaCommand name="TC(11,4)(3,9)_time_based_scheduled_report_housekeeping_parameter_report_structures">
                <xtce:BaseMetaCommand metaCommandRef="TC(11,4)_insert_activity_into_time_based_schedule">
                </xtce:BaseMetaCommand>
                <xtce:ArgumentList>
                    <xtce:Argument argumentTypeRef="/dt/uint8_t{1-5}" name="total_structures" />
                    <xtce:Argument argumentTypeRef="/dt/structureIdArray_t" name="structures" />
                    </xtce:ArgumentList>
                    <xtce:CommandContainer name="TC(11,4)(3,9)_time_based_scheduled_report_housekeeping_parameter_report_structures">
                        <xtce:EntryList>
                            <xtce:ArgumentRefEntry argumentRef="total_structures" />
                            <xtce:ArgumentRefEntry argumentRef="structures" />
                        </xtce:EntryList>
                        <xtce:BaseContainer containerRef="TC(11,4)_insert_activity_into_time_based_schedule" />
                    </xtce:CommandContainer>
            </xtce:MetaCommand>

            <xtce:MetaCommand name="custom_TC(11,4)(3,9)_report_housekeeping_parameter_report_structures">
                <xtce:BaseMetaCommand metaCommandRef="TC(11,4)_insert_activity_into_time_based_schedule">
                </xtce:BaseMetaCommand>
                <xtce:ArgumentList>
                    <xtce:Argument argumentTypeRef="/dt/uint8_t{1-10}" name="total_structures" />
                    <xtce:Argument argumentTypeRef="/dt/uint8Array_t" name="structures" />
                </xtce:ArgumentList>
                <xtce:CommandContainer name="custom_TC(11,4)(3,9)_report_housekeeping_parameter_report_structures">
                    <xtce:EntryList>
                        <xtce:ArgumentRefEntry argumentRef="total_structures" />
                        <xtce:ArgumentRefEntry argumentRef="structures" />
                    </xtce:EntryList>
                    <xtce:BaseContainer containerRef="TC(11,4)_insert_activity_into_time_based_schedule"/>
                </xtce:CommandContainer>
            </xtce:MetaCommand>

            <xtce:MetaCommand name="TC(11,4)(3,27)_time_based_scheduled_generate_a_one_shot_report_for_housekeeping_parameter_report_structures">
                <xtce:BaseMetaCommand metaCommandRef="TC(11,4)_insert_activity_into_time_based_schedule">
                </xtce:BaseMetaCommand>
                <xtce:ArgumentList>
                    <xtce:Argument argumentTypeRef="/dt/uint8_t{1-5}" name="total_structures" />
                    <xtce:Argument argumentTypeRef="/dt/structureIdArray_t" name="structures" />
                    </xtce:ArgumentList>
                    <xtce:CommandContainer name="TC(11,4)(3,27)_time_based_scheduled_generate_a_one_shot_report_for_housekeeping_parameter_report_structures">
                        <xtce:EntryList>
                            <xtce:ArgumentRefEntry argumentRef="total_structures" />
                            <xtce:ArgumentRefEntry argumentRef="structures" />
                        </xtce:EntryList>
                        <xtce:BaseContainer containerRef="TC(11,4)_insert_activity_into_time_based_schedule" />
                    </xtce:CommandContainer>
            </xtce:MetaCommand>

            <xtce:MetaCommand name="custom_TC(11,4)(3,27)_generate_a_one_shot_report_for_housekeeping_parameter_report_structures">
                <xtce:BaseMetaCommand metaCommandRef="TC(11,4)_insert_activity_into_time_based_schedule">
                </xtce:BaseMetaCommand>
                <xtce:ArgumentList>
                    <xtce:Argument argumentTypeRef="/dt/uint8_t{1-10}" name="total_structures" />
                    <xtce:Argument argumentTypeRef="/dt/uint8Array_t" name="structures" />
                </xtce:ArgumentList>
                <xtce:CommandContainer name="custom_TC(11,4)(3,27)_generate_a_one_shot_report_for_housekeeping_parameter_report_structures">
                    <xtce:EntryList>
                        <xtce:ArgumentRefEntry argumentRef="total_structures" />
                        <xtce:ArgumentRefEntry argumentRef="structures" />
                    </xtce:EntryList>
                    <xtce:BaseContainer containerRef="TC(11,4)_insert_activity_into_time_based_schedule"></xtce:BaseContainer>
                </xtce:CommandContainer>
            </xtce:MetaCommand>

            <xtce:MetaCommand name="TC(11,4)(20,1)_time_based_scheduled_report_the_parameter_values">
                <xtce:BaseMetaCommand metaCommandRef="TC(11,4)_insert_activity_into_time_based_schedule">
                </xtce:BaseMetaCommand>
                <xtce:ArgumentList>
                    <xtce:Argument argumentTypeRef="/dt/uint16_t{1-10}" name="total_parameters" />
                    <xtce:Argument argumentTypeRef="/dt/parameterIdArray_t" name="parameters" />
                </xtce:ArgumentList>
                    <xtce:CommandContainer name="TC(11,4)(20,1)_time_based_scheduled_report_the_parameter_values">
                        <xtce:EntryList >
                            <xtce:ArgumentRefEntry argumentRef="total_parameters"/>
                            <xtce:ArgumentRefEntry argumentRef="parameters" />
                        </xtce:EntryList>
                        <xtce:BaseContainer containerRef="TC(11,4)_insert_activity_into_time_based_schedule" />
                    </xtce:CommandContainer>
            </xtce:MetaCommand>

            <xtce:MetaCommand name="TC(11,4)(4,1)_time_based_scheduled_report_the_parameter_statistics">
                <xtce:BaseMetaCommand metaCommandRef="TC(11,4)_insert_activity_into_time_based_schedule">
                </xtce:BaseMetaCommand>
                <xtce:ArgumentList>
                    <xtce:Argument argumentTypeRef="/dt/reset_flag_ST04" name="reset_flag" />
                </xtce:ArgumentList>
                <xtce:CommandContainer name="TC(11,4)(4,1)_time_based_scheduled_report_the_parameter_statistics">
                    <xtce:EntryList>
                        <xtce:ArgumentRefEntry argumentRef="reset_flag" />
                    </xtce:EntryList>
                    <xtce:BaseContainer containerRef="TC(11,4)_insert_activity_into_time_based_schedule" />
                </xtce:CommandContainer>
            </xtce:MetaCommand>
        </xtce:MetaCommandSet>
    </xtce:CommandMetaData>
</xtce:SpaceSystem>
