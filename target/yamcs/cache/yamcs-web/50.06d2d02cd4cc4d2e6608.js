(self.webpackChunk_yamcs_webapp=self.webpackChunk_yamcs_webapp||[]).push([[50],{9050:(t,e,i)=>{"use strict";i.r(e),i.d(e,{ArchiveModule:()=>Rt});var s=i(7290),n=i(3337),o=i(7102),r=i(4017),a=i(9385),l=i(2151),h=i(5366),d=i(1041),c=i(8512),p=i(8293),m=i(2773),u=i(2935),g=i(8509),y=i(6764),v=i(7487),b=i(1116);let f=(()=>{class t{constructor(t,e,i,s){this.dialogRef=t,this.yamcs=e,this.downloadURL$=new c.X(null),this.form=i.group({start:[null,d.kI.required],stop:[null,d.kI.required]}),this.form.valueChanges.subscribe(t=>{if(this.form.valid){const i=e.yamcsClient.getPacketsDownloadURL(e.instance,{start:g.Y6(t.start),stop:g.Y6(t.stop),format:"raw"});this.downloadURL$.next(i)}else this.downloadURL$.next(null)});let n=s.start,o=s.stop;n&&o||(o=this.yamcs.getMissionTime(),n=(0,g.rV)(o,"PT1H")),this.form.setValue({start:g.Y6(n),stop:g.Y6(o)})}closeDialog(){this.dialogRef.close()}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(u.so),h.Y36(p.C),h.Y36(d.qu),h.Y36(u.WI))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-download-dump-dialog"]],decls:16,vars:6,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["formControlName","start"],["formControlName","stop"],["align","end"],["mat-dialog-close","",1,"ya-button"],[3,"link","disabled","primary","click"]],template:function(t,e){1&t&&(h.TgZ(0,"h2",0),h._uU(1,"Download Packet Dump"),h.qZA(),h.TgZ(2,"mat-dialog-content",1),h.TgZ(3,"form",2),h.TgZ(4,"label"),h._uU(5," Start "),h._UZ(6,"app-date-time-input",3),h.qZA(),h.TgZ(7,"label"),h._uU(8," Stop "),h._UZ(9,"app-date-time-input",4),h.qZA(),h.qZA(),h.qZA(),h.TgZ(10,"mat-dialog-actions",5),h.TgZ(11,"button",6),h._uU(12,"CANCEL"),h.qZA(),h.TgZ(13,"app-download-button",7),h.NdJ("click",function(){return e.closeDialog()}),h.ALo(14,"async"),h._uU(15," DOWNLOAD "),h.qZA(),h.qZA()),2&t&&(h.xp6(3),h.Q6J("formGroup",e.form),h.xp6(10),h.Q6J("link",h.lcZ(14,4,e.downloadURL$))("disabled",!e.form.valid)("primary",!0))},directives:[u.uh,u.xY,d._Y,d.JL,d.sg,y.Y,d.JJ,d.u,u.H8,u.ZT,v.o],pipes:[b.Ov],encapsulation:2}),t})(),w=(()=>{class t{constructor(t,e){this.dialogRef=t,this.data=e,this.date=new d.NI(null,[d.kI.required]),this.data.date&&this.date.setValue(g.Y6(this.data.date))}select(){const t=g.ZU(this.date.value);this.dialogRef.close({date:t})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(u.so),h.Y36(u.WI))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-jump-to-dialog"]],decls:11,vars:1,consts:[["mat-dialog-title",""],[1,"ya-form","mat-typography"],[3,"formControl"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"click"]],template:function(t,e){1&t&&(h.TgZ(0,"h2",0),h._uU(1,"Jump to date"),h.qZA(),h.TgZ(2,"mat-dialog-content",1),h.TgZ(3,"label"),h._uU(4," Date "),h._UZ(5,"app-date-time-input",2),h.qZA(),h.qZA(),h.TgZ(6,"mat-dialog-actions",3),h.TgZ(7,"button",4),h._uU(8,"CANCEL"),h.qZA(),h.TgZ(9,"button",5),h.NdJ("click",function(){return e.select()}),h._uU(10,"OK"),h.qZA(),h.qZA()),2&t&&(h.xp6(5),h.Q6J("formControl",e.date))},directives:[u.uh,u.xY,y.Y,d.JJ,d.oH,u.H8,u.ZT],encapsulation:2}),t})();class x{constructor(t,e){this.loadStart=t,this.loadStop=e}}class C{constructor(t,e){this.date=t,this.x=e}}class S{constructor(t,e){this.userObject=t,this.target=e}}class k{constructor(t){this.target=t.target,this.deltaY=t.deltaY}}class T{}class E{}class D{}class M{}class A{constructor(t){this.range=t}}class V{constructor(t,e){this.userObject=t,this.target=e.target,this.clientX=e.clientX,this.clientY=e.clientY}}class B extends V{constructor(t,e){super(t,e),this.userObject=t}}class H{constructor(t,e){this.x=t,this.y=e}plus(t){return new H(this.x+t.x,this.y+t.y)}minus(t){return new H(this.x-t.x,this.y-t.y)}withX(t){return new H(t,this.y)}withY(t){return new H(this.x,t)}distanceTo(t){return Math.sqrt((t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y))}tx(t){return new H(this.x+t,this.y)}ty(t){return new H(this.x,this.y+t)}}class O{constructor(t,e,i){this.children=[],this.name=t,this.attributes=e||{},this.innerText=i}addChild(...t){for(const e of t)this.children.push(e);return this}setAttribute(t,e){this.attributes[t]=e}toDomElement(){const t=document.createElementNS("http://www.w3.org/2000/svg",this.name);for(const e of Object.keys(this.attributes))"xlink:href"===e?t.setAttributeNS("http://www.w3.org/1999/xlink",e,this.attributes[e]):t.setAttribute(e,this.attributes[e]);for(const e of this.children)t.appendChild(e.toDomElement());if(this.innerText){const e=document.createTextNode(this.innerText);t.appendChild(e)}return t}toString(){return this.stringRepresentation(!0)}stringRepresentation(t=!1,e=!1){let i="<"+this.name;t&&(i+=e?" xmlns='http://www.w3.org/2000/svg'":' xmlns="http://www.w3.org/2000/svg"');for(const s of Object.keys(this.attributes))i+=e?` ${s}='${this.attributes[s]}'`:` ${s}="${this.attributes[s]}"`;i+=">";for(const s of this.children)i+=s.stringRepresentation(!1,e);return this.innerText&&(i+=this.innerText),i+="</"+this.name+">",i}}class I extends O{constructor(t,e){super("clipPath",t,e)}}class U extends O{constructor(t,e){super("defs",t,e)}}class z extends O{constructor(t,e){super("ellipse",t,e)}}class L extends O{constructor(t,e){super("g",t,e)}}class W extends O{constructor(t,e){super("image",t,e)}}class P extends O{constructor(t,e){super("line",t,e)}}class Z extends O{constructor(t,e){super("path",t,e)}}class Y extends O{constructor(t,e){super("pattern",t,e)}}class F extends O{constructor(t,e){super("rect",t,e)}}class j extends O{constructor(t,e){super("set",t,e)}}class _ extends O{constructor(t,e){super("svg",t,e)}asImage(t={}){const e=new W(t),i=encodeURIComponent(this.stringRepresentation(!0,!0));return e.setAttribute("xlink:href","data:image/svg+xml,"+i),e}}class R extends O{constructor(t,e){super("text",t,e)}}class N extends O{constructor(t,e){super("title",t,e)}}let $=0;function X(){const t="tlid"+$;return $+=1,t}function q(t){if(!t)return t;if(t instanceof Date)return t;if("number"==typeof t)return new Date(t);if("string"==typeof t)return new Date(Date.parse(t));throw new Error(`Cannot convert '${t}' to Date`)}function G(t,e){return new Date(t.getTime()+1e3*e)}function J(t,e){return new Date(t.getTime()+e)}function Q(t,e){return e.getTime()-t.getTime()}function K(t,e){return t.getTime()<e.getTime()}function tt(t,e){return t.getTime()>e.getTime()}function et(t){const e=new Date(t.getTime());return e.setMinutes(0,0,0),e}function it(t,e){const i="GMT"===e||"UTC"===e,s=new Date(t.getTime());return i?s.setUTCHours(0,0,0,0):s.setHours(0,0,0,0),s}function st(t,e){const i="GMT"===e||"UTC"===e,s=it(t,e);if(i){const t=s.getUTCDay()||7;1!==t&&s.setUTCHours(-24*(t-1))}else{const t=s.getDay()||7;1!==t&&s.setHours(-24*(t-1))}return s}function nt(t,e,i){const s="GMT"===i||"UTC"===i;if(i&&!s)throw new Error(`Unsupported timezone '${i}'`);if("YYYY"===e)return String(s?t.getUTCFullYear():t.getFullYear());if("MM"===e){const e=(s?t.getUTCMonth():t.getMonth())+1;return e<10?"0"+e:" "+e}if("MMM"===e)return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][s?t.getUTCMonth():t.getMonth()];if("MMMM"===e)return["January","February","March","April","May","June","July","August","September","October","November","December"][s?t.getUTCMonth():t.getMonth()];if("DD"===e){const e=s?t.getUTCDate():t.getDate();return e<10?"0"+e:" "+e}if("DDDD"===e){const e=[0,31,59,90,120,151,181,212,243,273,304,334],i=s?t.getUTCMonth():t.getMonth(),o=s?t.getUTCDate():t.getDate();let r=e[i]+o;return i>1&&function(t,e){const i=e?t.getUTCFullYear():t.getFullYear();return 0==(3&i)&&(i%100!=0||i%400==0)}(t,s)&&r++,n=r,Array(3-String(n).length+1).join("0")+n}if("dd"===e)return["Su","Mo","Tu","We","Th","Fr","Sa"][s?t.getUTCDay():t.getDay()];if("ddd"===e)return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][s?t.getUTCDay():t.getDay()];if("Do"===e){const e=s?t.getUTCDate():t.getDate();return 1===e||31===e?e+"st":2===e?e+"nd":e+"th"}if("HH"===e){const e=s?t.getUTCHours():t.getHours();return e<10?"0"+e:""+e}throw new Error(`Unexpected format '${e}'`);var n}function ot(t){return t&&"object"==typeof t&&!Array.isArray(t)}function rt(t,...e){if(!e.length)return t;const i=e.shift();if(ot(t)&&ot(i))for(const s in i)ot(i[s])?(t[s]||(t[s]={}),rt(t[s],i[s])):t[s]=i[s];return rt(t,...e)}class at{constructor(t,e,i){this.timeline=t,this.opts=e,this.style=i,this.addons=e.addons||[],this.enabled=!1!==e.enabled}get height(){return 0}renderDefs(){return[]}renderFilters(){return[]}renderSection(t,e){t.x-=t.translation.x,t.addToViewportSection(e,this.renderViewport(t)),t.x+=t.translation.x}renderViewport(t){return new L}renderViewportUnderlay(t){return new L}renderViewportXUnderlay(t){return new L}renderViewportYUnderlay(t){return new L}renderViewportOverlay(t){return new L}renderViewportXOverlay(t){return new L}renderViewportYOverlay(t){return new L}postRender(t,e){}onAction(t,e){}tearDown(){}}class lt extends at{constructor(t,e,i){super(t,e,i),this.opts=e}get height(){return this.style.lineHeight}renderSection(t,e){t.addToSidebar(e,this.renderSidebar(t)),t.x-=t.translation.x,this.renderViewportSection(t,e),t.x+=t.translation.x}renderViewportSection(t,e){t.addToViewportSection(e,this.renderBand(t)),t.addToViewportSection(e,this.timeline.domReduction&&!this.opts.interactive?this.renderViewportAsImage(t):this.renderViewport(t));for(const i of this.addons){const s=i.renderViewportOverlay(t,this,this.timeline);t.addToViewportSection(e,s)}}renderViewportAsImage(t){const e=t.x,i=t.y;t.x=0,t.y=0,t.x+=this.timeline.pointsBetween(this.timeline.loadStart,this.timeline.visibleStart);const s=new _({"font-family":this.style.fontFamily}),n=new U;return n.addChild(...t.defsContentEls),s.addChild(n),s.addChild(this.renderViewport(t)),t.x=e,t.y=i,s.asImage({x:e+this.timeline.positionDate(this.timeline.loadStart),y:i,width:this.timeline.pointsBetween(this.timeline.loadStart,this.timeline.loadStop),height:this.height,"pointer-events":"none"})}renderBand(t){const e=this.timeline.pointsBetween(this.timeline.loadStart,this.timeline.loadStop);return(new L).addChild(new F({x:t.x+this.timeline.positionDate(this.timeline.loadStart),y:t.y,width:e,height:this.height,fill:this.style.bandBackgroundColor,"pointer-events":"none"}),new F({x:t.x+this.timeline.positionDate(this.timeline.loadStart),y:t.y+this.height,width:e,height:1,fill:this.style.dividerColor,"pointer-events":"none"}))}renderSidebar(t){this.sidebarId=X();const e=new F({id:this.sidebarId,x:t.x,y:t.y,width:"100%",height:this.height+t.paddingTop+t.paddingBottom,cursor:"default",fill:"transparent"});this.opts.interactiveSidebar&&(e.setAttribute("cursor","pointer"),e.addChild(new j({attributeName:"fill",to:this.style.sidebarHoverBackgroundColor,begin:"mouseover",end:"mouseout"})),this.timeline.registerActionTarget("click",this.sidebarId),this.timeline.registerActionTarget("contextmenu",this.sidebarId),this.timeline.registerActionTarget("mouseenter",this.sidebarId),this.timeline.registerActionTarget("mouseleave",this.sidebarId));const i=(new L).addChild(e,new F({x:t.x,y:t.y+this.height,width:"100%",height:1,fill:this.style.dividerColor,"pointer-events":"none"}));return this.opts.label&&i.addChild(new R({x:t.x+5,y:t.y+t.paddingTop+this.height/2,fill:this.style.sidebarForegroundColor,"pointer-events":"none","text-anchor":"left","dominant-baseline":"middle","font-size":this.style.textSize},this.opts.label||"Untitled")),i}onAction(t,e){if(t===this.sidebarId)switch(e.type){case"click":const t=new S(this.opts,e.target);t.clientX=e.clientX,t.clientY=e.clientY,this.timeline.fireEvent("sidebarClick",t);break;case"contextmenu":const i=new S(this.opts,e.target);i.clientX=e.clientX,i.clientY=e.clientY,this.timeline.fireEvent("sidebarContextMenu",i);break;case"mouseenter":if(!e.grabbing){const t=new S(this.opts,e.target);t.clientX=e.clientX,t.clientY=e.clientY,this.timeline.fireEvent("sidebarMouseEnter",t)}break;case"mouseleave":const s=new S(this.opts,e.target);s.clientX=e.clientX,s.clientY=e.clientY,this.timeline.fireEvent("sidebarMouseLeave",s)}}}class ht extends lt{constructor(t,e,i){super(t,e,i),this.opts=e,this.style=i,this.eventsById={},this.test=0,this.eventHeight=i.eventHeight||i.lineHeight,this.prepareDrawOperation(e.events||[])}static get type(){return"EventBand"}static get rules(){return{backgroundColor:"#529bff",borderColor:"#0a56bc",textColor:"#1c4b8b",textAlign:"left",cornerRadius:1,eventLeftMargin:5,highlightOpacity:.7,spaceBetween:0,lineSpacing:2,marginTop:0,marginBottom:0,borders:!1,dark:{}}}prepareDrawOperation(t){const e=this.analyzeEvents(t);this.lines=[...this.spreadAcrossLines(e.filter(t=>t.drawInfo&&t.drawInfo.milestone)),...this.spreadAcrossLines(e.filter(t=>t.drawInfo&&!t.drawInfo.milestone))],this.bandHeight=this.style.marginTop+this.eventHeight*this.lines.length+this.style.lineSpacing*(this.lines.length-1)+this.style.marginBottom,this.bandHeight=Math.max(this.bandHeight,this.style.marginTop+this.eventHeight+this.style.marginBottom)}analyzeEvents(t){const e=[];for(const i of t){const t=q(i.start);let s,n,o,r,a,l,h,d=i.milestone;if(void 0===d&&(d=!i.stop||q(i.stop).getTime()===t.getTime()),s=d?i.stop?q(i.stop):t:q(i.stop),K(t,this.timeline.loadStop)&&tt(s,this.timeline.loadStart)){if(d)n=this.timeline.positionDate(t)-this.eventHeight/2,o=n+this.eventHeight,i.title&&(o+=this.timeline.getFontMetrics(i.title,this.style.textSize).width+this.style.eventLeftMargin),r=!0,a=0,l=!1;else{n=this.timeline.positionDate(t),o=this.timeline.positionDate(s),l=K(t,this.timeline.visibleStart)&&tt(s,this.timeline.visibleStart);let e=i.title;e&&l&&(e="\u25c0"+e);const h=this.timeline.getFontMetrics(e,this.style.textSize);a=o-n,l&&(a=o-this.timeline.positionDate(this.timeline.visibleStart)),r=!1,!1!==this.opts.wrap&&a<h.width&&(o+=h.width+this.style.eventLeftMargin,r=!0)}const e=X();this.opts.interactive&&(this.timeline.registerActionTarget("click",e),this.timeline.registerActionTarget("contextmenu",e),this.timeline.registerActionTarget("mouseenter",e),this.timeline.registerActionTarget("mousemove",e),this.timeline.registerActionTarget("mouseleave",e),this.opts.draggable&&(this.timeline.registerActionTarget("grabstart",e),this.timeline.registerActionTarget("grabmove",e),this.timeline.registerActionTarget("grabend",e))),h={userObject:i,drawInfo:{id:e,renderStartX:n,renderStopX:o,milestone:d,textOutside:r,availableTitleWidth:a,offscreenStart:l}},this.eventsById[e]=h}else h={userObject:i};e.push(h)}return e}spreadAcrossLines(t){const e=[];for(const i of t){let t=!1;const s=i.drawInfo.renderStartX,n=i.drawInfo.renderStopX;for(const o of e){let e=0,r=o.length-1;for(;e<=r;){const t=Math.floor((e+r)/2),i=o[t].drawInfo.renderStopX;if(n+this.style.spaceBetween<=o[t].drawInfo.renderStartX)r=t-1;else{if(!(s>=i+this.style.spaceBetween))break;e=t+1}}if(e>r){o.splice(e,0,i),t=!0;break}}t||e.push([i])}return e}get height(){return this.bandHeight}renderViewport(t){const e=new L;this.opts.hatchUncovered&&e.addChild(new F({x:t.x+this.timeline.positionDate(this.timeline.loadStart),y:t.y,width:this.timeline.pointsBetween(this.timeline.loadStart,this.timeline.loadStop),height:this.height,fill:this.style.hatchFill,"pointer-events":"none"}));for(let i=0;i<this.lines.length;i++){const s=this.lines[i];let n=t.y+this.style.marginTop;n+=i*(this.style.lineSpacing+this.eventHeight);for(const i of s)if(i.drawInfo.milestone){const s=this.renderMilestone(i,t.x,n);e.addChild(s)}else{const s=this.renderEvent(i,t.x,n);e.addChild(s)}}return e}renderMilestone(t,e,i){const s=q(t.userObject.start),n=new L({id:t.drawInfo.id,class:"event milestone"}),o=e+this.timeline.positionDate(s),r=i,a=this.eventHeight,l=this.eventHeight,h=t.userObject.foregroundColor||this.style.textColor,d=t.userObject.borderColor||this.style.borderColor;let c=t.userObject.borders;void 0===c&&(c=this.style.borders);const p=this.eventHeight/2,m=new Z({d:`M${o},${r} l${p},${p} l-${p},${p} l-${p},-${p} l${p},-${p}`,"stroke-width":1,fill:t.userObject.backgroundColor||this.style.backgroundColor});!0===c&&m.setAttribute("stroke",d),n.addChild(m);const u=t.userObject.title;if(u){t.userObject.tooltip&&n.addChild(new N({},t.userObject.tooltip));const e=this.timeline.getFontMetrics(u,this.style.textSize),i=o+a-this.eventHeight/2+this.style.eventLeftMargin,s=r+this.eventHeight/2;n.addChild(new F({x:i,y:r,width:e.width,height:l,opacity:0})),n.addChild(new R({x:i,y:s,fill:h,"pointer-events":"none","text-anchor":"left","dominant-baseline":"middle","font-size":this.style.textSize},u))}return this.opts.interactive&&(n.setAttribute("cursor",this.style.highlightCursor),n.addChild(new j({attributeName:"opacity",to:this.style.highlightOpacity,begin:"mouseover",end:"mouseout"}))),n}renderEvent(t,e,i){const s=q(t.userObject.start),n=q(t.userObject.stop),o=new L({id:t.drawInfo.id,class:"event"}),r=e+this.timeline.positionDate(s),a=i,l=this.timeline.pointsBetween(s,n),h=this.eventHeight,d=t.userObject.foregroundColor||this.style.textColor,c=t.userObject.borderColor||this.style.borderColor,p=t.userObject.textAlign||this.style.textAlign,m=t.userObject.borders||this.style.borders,u=new F({x:r,y:a,width:l,height:h,fill:t.userObject.backgroundColor||this.style.backgroundColor,rx:this.style.cornerRadius});o.addChild(u),!0===m?u.setAttribute("stroke",c):"vertical"===m&&o.addChild(new Z({d:`M${r},${a} l0,${h} M${r+l},${a} l0,${h}`,stroke:c})),t.userObject.tooltip&&o.addChild(new N({},t.userObject.tooltip));let g=t.userObject.title;if(g){t.drawInfo.offscreenStart&&(g="\u25c0"+g);const e=this.timeline.getFontMetrics(g,this.style.textSize),i=e.width<=t.drawInfo.availableTitleWidth;if(t.drawInfo.textOutside){const t=r+l+this.style.eventLeftMargin,i=a+this.eventHeight/2;o.addChild(new F({x:t,y:a,width:e.width,height:h,opacity:0})),o.addChild(new R({x:t,y:i,fill:d,"pointer-events":"none","text-anchor":"left","dominant-baseline":"middle","font-size":this.style.textSize},g))}else if(this.opts.wrap||i){const e=X();o.addChild(new I({id:e}).addChild(new F({x:r,y:a,width:l,height:h})));let i=r;const s="center"===p;t.drawInfo.offscreenStart&&(i=Math.max(i,-this.timeline.xTranslation)),o.addChild(new R(s&&!t.drawInfo.offscreenStart?{x:i+l/2,y:a+this.eventHeight/2,fill:d,"pointer-events":"none","text-anchor":"middle","dominant-baseline":"middle","font-size":this.style.textSize,"clip-path":`url(${window.location.href}#${e})`}:{x:i+this.style.eventLeftMargin,y:a+this.eventHeight/2,fill:d,"pointer-events":"none","text-anchor":"left","dominant-baseline":"middle","font-size":this.style.textSize,"clip-path":`url(${window.location.href}#${e})`},g))}}return this.opts.interactive&&(this.opts.resizable&&(o.addChild(new z({cx:r,cy:a+this.eventHeight/2,rx:3,ry:3,fill:"white",stroke:"black","stroke-width":.5,cursor:"w-resize"})),o.addChild(new z({cx:r+l,cy:a+this.eventHeight/2,rx:3,ry:3,fill:"white",stroke:"black","stroke-width":.5,cursor:"e-resize"}))),o.setAttribute("cursor",this.style.highlightCursor),o.addChild(new j({attributeName:"opacity",to:this.style.highlightOpacity,begin:"mouseover",end:"mouseout"}))),o}renderViewportXOverlay(t){const e=new L;if(this.opts.leakEventBackground){const i=this.timeline.getSidebarWidth()-t.translation.x;for(const s of this.lines)for(const n of s){const s=q(n.userObject.start),o=q(n.userObject.stop),r=this.timeline.positionDate(s);e.addChild(n.drawInfo.milestone?new P({x1:i+r,y1:0,x2:i+r,y2:t.totalHeight,stroke:n.userObject.backgroundColor||this.style.backgroundColor,"stroke-width":1,"stroke-opacity":.3,"pointer-events":"none"}):new F({x:i+r,y:0,width:this.timeline.pointsBetween(s,o),height:t.totalHeight,fill:n.userObject.backgroundColor||this.style.backgroundColor,"fill-opacity":.1,"pointer-events":"none"}))}}return e}onAction(t,e){if(super.onAction(t,e),this.eventsById[t]){const i=this.eventsById[t].userObject;switch(e.type){case"click":const s=new V(i,e);this.timeline.fireEvent("eventClick",s);break;case"contextmenu":const n=new V(i,e);this.timeline.fireEvent("eventContextMenu",n);break;case"grabstart":this.handleDragStart(this.eventsById[t],e);break;case"grabmove":this.handleDrag(this.eventsById[t],e);break;case"grabend":this.handleDragEnd(this.eventsById[t],e);break;case"mouseenter":if(!e.grabbing){const t=new V(i,e);this.timeline.fireEvent("eventMouseEnter",t)}break;case"mousemove":const o=new V(i,e);this.timeline.fireEvent("eventMouseMove",o);break;case"mouseleave":const r=new V(i,e);this.timeline.fireEvent("eventMouseLeave",r)}}}handleDragStart(t,e){this.grabStart=e.grabStart;const i=e.target;if(i.transform.baseVal.numberOfItems){const t=i.transform.baseVal.getItem(0);this.grabStart=this.grabStart.minus(new H(t.matrix.e,t.matrix.f))}}handleDrag(t,e){if(this.grabStart){const t=e.grabPosition.minus(this.grabStart);e.target.setAttribute("transform",`translate(${t.x}, ${t.y})`)}}handleDragEnd(t,e){if(this.grabStart){const i=e.grabPosition.minus(this.grabStart);e.target.setAttribute("transform",`translate(${i.x}, ${i.y})`);const s=new B(t.userObject,e),n=e.grabPosition.x-this.grabStart.x-this.timeline.xTranslation,o=this.timeline.positionDate(q(t.userObject.start));if(s.start=this.timeline.toDate(o+n),t.userObject.stop){const e=this.timeline.positionDate(q(t.userObject.stop));s.stop=this.timeline.toDate(e+n)}this.timeline.fireEvent("eventChanged",s)}}}class dt extends at{constructor(){super(...arguments),this.trackerId=X(),this.rectId=X(),this.lineLeftId=X(),this.lineRightId=X()}static get type(){return"HorizontalSelection"}static get rules(){return{backgroundColor:"lightgrey",backgroundOpacity:.2,lineColor:"black",lineOpacity:.4,dark:{backgroundColor:"grey"}}}renderViewportXOverlay(t){return new L({id:this.trackerId,style:"visibility: hidden"}).addChild(new F({id:this.rectId,x:t.x,y:0,width:0,height:"100%",fill:this.style.backgroundColor,"fill-opacity":this.style.backgroundOpacity,"pointer-events":"none"}),new P({id:this.lineLeftId,x1:t.x,y1:0,x2:0,y2:"100%",stroke:this.style.lineColor,"stroke-dasharray":"4 3","stroke-opacity":this.style.lineOpacity,"pointer-events":"none"}),new P({id:this.lineRightId,x1:t.x,y1:0,x2:0,y2:"100%",stroke:this.style.lineColor,"stroke-opacity":this.style.lineOpacity,"stroke-dasharray":"4 3","pointer-events":"none"}))}setSelection(t){const e=this.svgEl.getElementById(this.trackerId),i=this.svgEl.getElementById(this.rectId),s=this.svgEl.getElementById(this.lineLeftId),n=this.svgEl.getElementById(this.lineRightId),o=this.timeline.getSidebarWidth()-this.ctx.translation.x,r=o+this.timeline.positionDate(t.start),a=o+this.timeline.positionDate(t.stop);i.setAttribute("x",r),i.setAttribute("width",a-r),s.setAttribute("x1",r),s.setAttribute("x2",r),n.setAttribute("x1",a),n.setAttribute("x2",a),e.style.visibility="visible"}clearSelection(){const t=this.svgEl.getElementById(this.trackerId);t&&(t.style.visibility="hidden")}postRender(t,e){this.ctx=t,this.svgEl=e;const i=this.timeline.selectedRange;i&&this.setSelection(i)}}class ct extends at{constructor(){super(...arguments),this.trackerId=X()}static get type(){return"LocationTracker"}static get rules(){return{knobColor:"#ccc",knobRadius:3,lineColor:"#ccc",lineWidth:"1px",lineOpacity:.6,dark:{lineColor:"grey"}}}renderViewportXOverlay(t){return new L({id:this.trackerId,style:"visibility: hidden"}).addChild(new P({x1:t.x-this.style.knobRadius,y1:0,x2:0,y2:"100%",stroke:this.style.lineColor,"stroke-width":this.style.lineWidth,"stroke-opacity":this.style.lineOpacity,"stroke-dasharray":"4 3","pointer-events":"none"}),new z({cx:t.x-this.style.knobRadius,cy:0,rx:this.style.knobRadius,ry:this.style.knobRadius,fill:this.style.lineColor,"pointer-events":"none"}))}postRender(t,e){const i=e.getElementById(this.trackerId);this.hoverListener=t=>{if(i)if(void 0!==t.x){const e=t.x+this.timeline.getSidebarWidth();i.childNodes[0].setAttribute("x1",e),i.childNodes[0].setAttribute("x2",e),i.childNodes[1].setAttribute("cx",e),i.style.visibility="visible"}else i.style.visibility="hidden"},this.timeline.on("viewportHover",this.hoverListener)}tearDown(){this.timeline.off("viewportHover",this.hoverListener)}}class pt extends at{static get type(){return"NoDataZone"}static get rules(){return{backgroundColor:"#fff",backgroundFilter:"crossHatch",dark:{backgroundColor:"#2b2b2b",backgroundFilter:"darkHatch"}}}renderViewport(t){const e=new L;return e.addChild(new F({x:t.x+this.timeline.positionDate(this.timeline.loadStop),y:0,width:15e3,height:"100%",fill:this.style.backgroundColor,"pointer-events":"none"})),e.addChild(new F({x:t.x+this.timeline.positionDate(this.timeline.loadStop),y:0,width:15e3,height:"100%",fill:`url(${window.location.href}#${this.style.backgroundFilter})`,"pointer-events":"none"})),e.addChild(new F({x:t.x+this.timeline.positionDate(this.timeline.loadStart)-15e3,y:0,width:15e3,height:"100%",fill:this.style.backgroundColor,"pointer-events":"none"})),e.addChild(new F({x:t.x+this.timeline.positionDate(this.timeline.loadStart)-15e3,y:0,width:15e3,height:"100%",fill:`url(${window.location.href}#${this.style.backgroundFilter})`,"pointer-events":"none"})),e}}class mt extends lt{static get type(){return"SpacerBand"}renderBand(t){return(new L).addChild(new F({x:t.x+this.timeline.positionDate(this.timeline.loadStart),y:t.y+this.height,width:this.timeline.pointsBetween(this.timeline.loadStart,this.timeline.loadStop),height:1,fill:this.style.dividerColor,"pointer-events":"none"}))}renderSidebar(t){return new F({x:t.x,y:t.y+this.height,width:"100%",height:1,fill:this.style.dividerColor})}}class ut extends lt{constructor(t,e,i){super(t,e,i),this.opts=e,this.style=i,e.resolution&&"auto"!==e.resolution||(this.scale=this._testSpread(36e5)?1:this._testSpread(216e5)?2:this._testSpread(864e5)?3:this._testSpread(432e6)?4:5),this.dayFormat=this.opts.dayFormat||"DDDD",this.contributionId=X()}static get type(){return"Timescale"}static get rules(){return{textColor:"grey",majorTickColor:"#aaa",majorTickWidth:1,minorTickColor:"#aaa",minorTickWidth:1,midTickColor:"#aaa",midTickWidth:1,adjust:!0,dark:{horizontalTickLineColor:"#333",horizontalTickLineWidth:2}}}renderViewport(t){const e=et(this.timeline.visibleStart),i=this.timeline.pointsBetween(this.timeline.visibleStart,e),s=new _({x:t.x+i,y:t.y,height:this.style.lineHeight,style:"overflow: visible"}).addChild((new U).addChild(this._renderHourPattern()));this.scaleBgId=X();const n={id:this.scaleBgId,x:this.timeline.positionDate(this.timeline.loadStart),y:0,width:this.timeline.pointsBetween(this.timeline.loadStart,this.timeline.loadStop)-i,height:this.style.lineHeight,fill:this.style.bandBackgroundColor};"select"===this.opts.grabAction?(n.cursor="col-resize",this.timeline.registerActionTarget("click",this.scaleBgId),this.timeline.registerActionTarget("grabstart",this.scaleBgId),this.timeline.registerActionTarget("grabmove",this.scaleBgId),this.timeline.registerActionTarget("grabend",this.scaleBgId)):n["pointer-events"]="none",this.style.horizontalTickLineColor&&(n.stroke=this.style.horizontalTickLineColor),this.style.horizontalTickLineWidth&&(n["stroke-width"]=this.style.horizontalTickLineWidth),s.addChild(new F(n));const o=new _({x:t.x,y:t.y,height:this.style.lineHeight,style:"overflow: visible"});return 1===this.scale?(n.fill=`url(${window.location.href}#${this.contributionId}_1h)`,o.addChild(...this._renderHoursScale(this.opts.tz))):2===this.scale?o.addChild(...this._renderQuarterDaysScale(this.opts.tz)):3===this.scale?o.addChild(...this._renderWeekDaysScale(this.opts.tz)):4===this.scale?o.addChild(...this._renderWeeksScale(this.opts.tz)):o.addChild(...this._renderMonthsScale(this.opts.tz)),(new L).addChild(s,o)}_testSpread(t){const e=this.timeline.positionDate(this.timeline.loadStart),i=J(this.timeline.loadStart,t);return this.timeline.positionDate(i)-e>2*this.timeline.style.divisionWidth}_renderHourPattern(){const t=this.style.divisionWidth*(3600/this.timeline.secondsPerDivision),e=this.style.lineHeight;return new Y({id:this.contributionId+"_1h",x:0,y:0,width:t,height:e,patternUnits:"userSpaceOnUse"}).addChild(new P({x1:0,y1:0,x2:0,y2:e,stroke:this.style.majorTickColor,"stroke-width":this.style.majorTickWidth}),new P({x1:.25*t,y1:.8*e,x2:.25*t,y2:e,stroke:this.style.minorTickColor,"stroke-width":this.style.minorTickWidth}),new P({x1:.5*t,y1:.6*e,x2:.5*t,y2:e,stroke:this.style.midTickColor,"stroke-width":this.style.midTickWidth}),new P({x1:.75*t,y1:.8*e,x2:.75*t,y2:e,stroke:this.style.minorTickColor,"stroke-width":this.style.minorTickWidth}))}_renderHoursScale(t){const e=[],i=et(this.timeline.loadStart);for(;i.getTime()<=this.timeline.loadStop.getTime();){const s=this.timeline.positionDate(i),n=nt(i,"HH",t);"00"===n?(e.push(new R({x:s+2,y:this.style.lineHeight/4,cursor:"default",fill:this.style.textColor,"font-size":this.style.textSize,"text-anchor":"left","dominant-baseline":"middle","pointer-events":"none"},nt(i,"MMM",t)+" "+nt(i,"DD",t))),e.push(new R({x:s+2,y:.75*this.style.lineHeight,cursor:"default",fill:this.style.textColor,"font-size":this.style.textSize,"text-anchor":"left","dominant-baseline":"middle","pointer-events":"none"},n))):e.push(new R({x:s+2,y:this.style.lineHeight/2,cursor:"default",fill:this.style.textColor,"font-size":this.style.textSize,"text-anchor":"left","dominant-baseline":"middle","pointer-events":"none"},n)),i.setTime(i.getTime()+36e5)}return e}_renderQuarterDaysScale(t){const e=[],i=it(this.timeline.loadStart,t);for(;i.getTime()<=this.timeline.loadStop.getTime();){const s=this.timeline.positionDate(i),n=nt(i,"HH",t);"00"===n?(e.push(new P({x1:s,y1:0,x2:s,y2:this.style.lineHeight,stroke:this.style.majorTickColor,"stroke-width":this.style.majorTickWidth,"pointer-events":"none"})),e.push(new R({x:s+2,y:this.style.lineHeight/4,cursor:"default",fill:this.style.textColor,"font-size":this.style.textSize,"text-anchor":"left","dominant-baseline":"middle","pointer-events":"none"},nt(i,"ddd",t)+" "+nt(i,"DD",t)+"/"+nt(i,"MM",t)))):e.push(new P({x1:s,y1:this.style.lineHeight/2,x2:s,y2:this.style.lineHeight,stroke:this.style.majorTickColor,"stroke-width":this.style.majorTickWidth,"pointer-events":"none"})),"GMT"===t||"UTC"===t?i.setTime(i.getTime()+216e5):i.setHours(i.getHours()+6);const o=this.timeline.positionDate(i);e.push(new R({x:(s+o)/2+2,y:.75*this.style.lineHeight,cursor:"default",fill:this.style.textColor,"font-size":this.style.textSize,"text-anchor":"middle","dominant-baseline":"middle","pointer-events":"none"},n))}return e}_renderDaysScale(t){const e=[],i=it(this.timeline.loadStart,t);for(;i.getTime()<=this.timeline.loadStop.getTime();){const s=this.timeline.positionDate(i);e.push(new P({x1:s,y1:0,x2:s,y2:this.style.lineHeight,stroke:this.style.majorTickColor,"stroke-width":this.style.majorTickWidth,"pointer-events":"none"}));const n=nt(i,"Do",t);"01"===n?(e.push(new R({x:s+2,y:this.style.lineHeight/4,cursor:"default",fill:this.style.textColor,"font-size":this.style.textSize,"text-anchor":"left","dominant-baseline":"middle","pointer-events":"none"},nt(i,"MMM",t))),e.push(new R({x:s+2,y:.75*this.style.lineHeight,cursor:"default",fill:this.style.textColor,"font-size":this.style.textSize,"text-anchor":"left","dominant-baseline":"middle","pointer-events":"none"},n))):e.push(new R({x:s+2,y:this.style.lineHeight/2,cursor:"default",fill:this.style.textColor,"font-size":this.style.textSize,"text-anchor":"left","dominant-baseline":"middle","pointer-events":"none"},n)),"GMT"===t||"UTC"===t?i.setTime(i.getTime()+864e5):i.setHours(i.getHours()+24)}return e}_renderWeeksScale(t){const e=[];let i=function(t,e){const i="GMT"===e||"UTC"===e,s=new Date(t.getTime());return i?(s.setUTCDate(1),s.setUTCHours(0,0,0,0)):(s.setDate(1),s.setHours(0,0,0,0)),s}(this.timeline.loadStart,t);for(;i.getTime()<=this.timeline.loadStop.getTime();){const s=this.timeline.positionDate(i);e.push(new P({x1:s,y1:0,x2:s,y2:this.style.lineHeight/2,stroke:this.style.majorTickColor,"stroke-width":this.style.majorTickWidth,"pointer-events":"none"})),e.push(new R({x:s+2,y:this.style.lineHeight/4,cursor:"default",fill:this.style.textColor,"font-size":this.style.textSize,"text-anchor":"left","dominant-baseline":"middle","pointer-events":"none"},nt(i,"MMMM",t))),"GMT"===t||"UTC"===t?i.setUTCMonth(i.getUTCMonth()+1,1):i.setMonth(i.getMonth()+1,1)}for(i=st(this.timeline.loadStart,t);i.getTime()<=this.timeline.loadStop.getTime();){const s=this.timeline.positionDate(i),n=nt(i,"DD",t)+"/"+nt(i,"MM",t);e.push(new P({x1:s,y1:this.style.lineHeight/2,x2:s,y2:this.style.lineHeight,stroke:this.style.majorTickColor,"stroke-width":this.style.majorTickWidth,"pointer-events":"none"})),"GMT"===t||"UTC"===t?i.setUTCDate(i.getUTCDate()+7):i.setDate(i.getDate()+7);const o=this.timeline.positionDate(i);e.push(new R({x:(s+o)/2+2,y:.75*this.style.lineHeight,cursor:"default",fill:this.style.textColor,"font-size":this.style.textSize,"text-anchor":"middle","dominant-baseline":"middle","pointer-events":"none"},n))}return e}_renderWeekDaysScale(t){const e=[],i=st(this.timeline.loadStart,t);for(;i.getTime()<=this.timeline.loadStop.getTime();){let s,n;"GMT"===t||"UTC"===t?(s=i.getUTCDay(),n=i.getUTCFullYear()%100):(s=i.getDay(),n=i.getFullYear()%100);const o=this.timeline.positionDate(i);1===s?(e.push(new P({x1:o,y1:0,x2:o,y2:this.style.lineHeight,stroke:this.style.majorTickColor,"stroke-width":this.style.majorTickWidth,"pointer-events":"none"})),e.push(new R({x:o+2,y:this.style.lineHeight/4,cursor:"default",fill:this.style.textColor,"font-size":this.style.textSize,"text-anchor":"left","dominant-baseline":"middle","pointer-events":"none"},nt(i,"DD",t)+" "+nt(i,"MMM",t)+", '"+n))):e.push(new P({x1:o,y1:this.style.lineHeight/2,x2:o,y2:this.style.lineHeight,stroke:this.style.majorTickColor,"stroke-width":this.style.majorTickWidth,"pointer-events":"none"}));const r=nt(i,"dd",t).charAt(0);"GMT"===t||"UTC"===t?i.setTime(i.getTime()+864e5):i.setHours(i.getHours()+24);const a=this.timeline.positionDate(i);e.push(new R({x:o+(a-o)/2,y:.75*this.style.lineHeight,cursor:"default",fill:this.style.textColor,"font-size":this.style.textSize,"text-anchor":"middle","dominant-baseline":"middle","pointer-events":"none"},r))}return e}_renderMonthsScale(t){const e=[],i=function(t,e){return"GMT"===e||"UTC"===e?new Date(Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0)):new Date(t.getFullYear(),0,1,0,0,0,0)}(this.timeline.loadStart,t);for(;i.getTime()<=this.timeline.loadStop.getTime();){const s=this.timeline.positionDate(i),n=nt(i,"MMM",t);"Jan"===n?(e.push(new P({x1:s,y1:0,x2:s,y2:this.style.lineHeight,stroke:this.style.majorTickColor,"stroke-width":this.style.majorTickWidth})),e.push(new R({x:s+2,y:this.style.lineHeight/4,cursor:"default",fill:this.style.textColor,"font-size":this.style.textSize,"text-anchor":"left","dominant-baseline":"middle","pointer-events":"none"},nt(i,"YYYY",t)))):e.push(new P({x1:s,y1:this.style.lineHeight/2,x2:s,y2:this.style.lineHeight,stroke:this.style.majorTickColor,"stroke-width":this.style.majorTickWidth,"pointer-events":"none"})),"GMT"===t||"UTC"===t?i.setUTCMonth(i.getUTCMonth()+1,1):i.setMonth(i.getMonth()+1,1);const o=this.timeline.positionDate(i);e.push(new R({x:(s+o)/2+2,y:.75*this.style.lineHeight,cursor:"default",fill:this.style.textColor,"font-size":this.style.textSize,"text-anchor":"middle","dominant-baseline":"middle","pointer-events":"none"},n))}return e}onAction(t,e){if(super.onAction(t,e),t===this.scaleBgId)switch(e.type){case"click":this.timeline.clearSelection();break;case"grabstart":this.grabX1=e.date,this.timeline.clearSelection();break;case"grabmove":case"grabend":this.timeline.selectRange(this.grabX1,e.date)}}}class gt{constructor(t){this.intervalId=window.setInterval(()=>{t.updateTime(new Date)},500)}stop(){clearInterval(this.intervalId)}}class yt extends at{constructor(t,e,i){super(t,e,i),this.opts=e,this.style=i,this.wallclockLocatorPastId=X(),this.wallclockLocatorLineId=X(),this.time=e.time}static get type(){return"WallclockLocator"}static get rules(){return{knobColor:"red",knobRadius:3,lineColor:"red",lineWidth:"1px",lineOpacity:.6,pastBackgroundColor:"lightgrey",pastBackgroundOpacity:.4}}updateTime(t){if(this.time=t,this.wallclockLocatorLineEl){this.wallclockLocatorLineEl.style.visibility="visible";let e=this.timeline.pointsBetween(this.timeline.unpannedVisibleStart,t);e+=this.timeline.getSidebarWidth(),this.wallclockLocatorLineEl.childNodes[0].setAttribute("x1",e),this.wallclockLocatorLineEl.childNodes[0].setAttribute("x2",e),this.wallclockLocatorLineEl.childNodes[1].setAttribute("cx",e)}if(this.wallclockLocatorPastEl){this.wallclockLocatorPastEl.style.visibility="visible";const e=this.timeline.pointsBetween(this.timeline.loadStart,t),i=String(Math.max(e,0));for(const t of this.wallclockLocatorPastEl.childNodes)t.setAttribute("width",i)}}renderViewportXOverlay(t){const e=this.timeline.getSidebarWidth()-t.translation.x,i=void 0===this.time?"hidden":"visible",s=this.time||new Date,n=new L({class:"wallclockLocator"}),o=e+this.timeline.positionDate(s);if(this.opts.markPast){const t=new L({id:this.wallclockLocatorPastId,visibility:i});t.addChild(new F({x:e+this.timeline.positionDate(this.timeline.loadStart),y:0,width:Math.max(this.timeline.pointsBetween(this.timeline.loadStart,s),0),height:"100%",fill:this.style.pastBackgroundColor,"fill-opacity":this.style.pastBackgroundOpacity,"pointer-events":"none"})),n.addChild(t)}return n.addChild(new L({id:this.wallclockLocatorLineId,visibility:i}).addChild(new P({x1:t.x+o,y1:0,x2:t.x+o,y2:"100%",stroke:this.style.lineColor,"stroke-width":this.style.lineWidth,"stroke-opacity":this.style.lineOpacity,"stroke-dasharray":"4 3","pointer-events":"none"}),new z({cx:t.x+o,cy:0,rx:this.style.knobRadius,ry:this.style.knobRadius,fill:this.style.lineColor,"pointer-events":"none"}))),n}postRender(t,e){this.wallclockLocatorLineEl=e.getElementById(this.wallclockLocatorLineId),this.wallclockLocatorPastEl=e.getElementById(this.wallclockLocatorPastId),!1!==this.opts.auto&&(this.clockUpdater=new gt(this))}tearDown(){this.clockUpdater&&(this.clockUpdater.stop(),this.clockUpdater=void 0)}}class vt{constructor(t,e){this.timeline=t,this.vdom=e,this.translation=new H(0,0),this.interactionAllowed=!0,this.grabbing=!1,this.panning=!1,this.snap=5,this.documentMouseMoveListener=t=>this.onDocumentMouseMove(t),this.documentMouseUpListener=t=>this.onDocumentMouseUp(t),this.documentMouseLeaveListener=t=>this.onDocumentMouseLeave(t),this.clickBlocker=t=>(document.removeEventListener("click",this.clickBlocker,!0),t.preventDefault(),t.stopPropagation(),!1),e.rootEl.addEventListener("click",t=>this.onClick(t),!1),e.rootEl.addEventListener("contextmenu",t=>this.onContextMenu(t),!1),e.rootEl.addEventListener("mousedown",t=>this.onMouseDown(t),!1),e.rootEl.addEventListener("mouseup",t=>this.onMouseUp(t),!1),e.rootEl.addEventListener("mousemove",t=>this.onMouseMove(t),!1),e.rootEl.addEventListener("wheel",t=>this.onWheel(t),!1),e.rootEl.addEventListener("touchstart",t=>this.onTouchStart(t),!1),e.rootEl.addEventListener("touchmove",t=>this.onTouchMove(t),!1),e.rootEl.addEventListener("touchend",t=>this.onTouchEnd(t),!1)}onClick(t){if(this.interactionAllowed){if(!this.grabbing&&this.mouseEnteredTarget){const e=this.timeline.findActionTarget(t.target,"click");if(e)return void this.timeline.handleUserAction(this.mouseEnteredTarget.id,{type:"click",target:e,clientX:t.clientX,clientY:t.clientY,grabbing:this.grabbing})}this.timeline.clearSelection()}}onContextMenu(t){if(this.interactionAllowed){if(this.mouseEnteredTarget){const e=this.timeline.findActionTarget(t.target,"contextmenu");e&&this.timeline.handleUserAction(this.mouseEnteredTarget.id,{type:"contextmenu",target:e,clientX:t.clientX,clientY:t.clientY,grabbing:this.grabbing})}return t.preventDefault(),t.stopPropagation(),!1}}onTouchStart(t){if(this.interactionAllowed)return this.prepareGrab(this.touchPosition(t),t),t.preventDefault(),t.stopPropagation(),!1}onMouseDown(t){if(document.removeEventListener("click",this.clickBlocker,!0),this.interactionAllowed)return 0===t.button&&this.prepareGrab(this.mousePosition(t),t),t.preventDefault(),t.stopPropagation(),!1}mousePosition(t){const e=this.vdom.rootEl.getBoundingClientRect();let i=this.vdom.rootEl.createSVGPoint();return i.x=t.clientX-e.left,i.y=t.clientY-e.top,i=i.matrixTransform(this.vdom.mousePositionReferenceEl.getCTM().inverse()),new H(i.x,i.y)}touchPosition(t){const e=this.vdom.rootEl.getBoundingClientRect(),i=t.touches[0];let s=this.vdom.rootEl.createSVGPoint();return s.x=i.pageX-e.left,s.y=i.pageY-e.top,s=s.matrixTransform(this.vdom.mousePositionReferenceEl.getCTM().inverse()),new H(s.x,s.y)}prepareGrab(t,e){this.mouseDownStart=t,this.grabStart=this.mouseDownStart.minus(this.translation),this.grabTarget=this.timeline.findActionTarget(e.target,"grabstart"),this.panning=!this.grabTarget}maybeInitializeGrab(t,e,i){if(!this.grabbing&&Math.abs(this.mouseDownStart.distanceTo(t))>this.snap){if(document.addEventListener("click",this.clickBlocker,!0),document.addEventListener("mousemove",this.documentMouseMoveListener),document.addEventListener("mouseup",this.documentMouseUpListener),document.addEventListener("mouseleave",this.documentMouseLeaveListener),this.timeline.fireEvent("grabStart",new D),this.grabTarget&&!this.grabbing){const s=this.mouseDownStart.x-this.translation.x-this.timeline.getSidebarWidth(),n=this.timeline.toDate(s);this.timeline.handleUserAction(this.grabTarget.id,{type:"grabstart",target:this.grabTarget,clientX:e,clientY:i,date:n,grabbing:!0,grabStart:this.untranslatePoint(this.mouseDownStart),grabPosition:this.untranslatePoint(t)})}this.grabbing=!0}}untranslatePoint(t){return t&&this.translation?t.minus(this.translation):t}onMouseMove(t){const e=this.mousePosition(t);this.interactionAllowed&&this.mouseDownStart&&this.maybeInitializeGrab(e,t.clientX,t.clientY);const i=e.x-this.translation.x-this.timeline.getSidebarWidth(),s=this.timeline.toDate(i);this.timeline.fireEvent("viewportHover",s>=this.timeline.visibleStart?new C(s,i):new C);const n=this.timeline.findActionTarget(t.target);n?(n!==this.mouseEnteredTarget&&(this.mouseEnteredTarget&&this.timeline.handleUserAction(this.mouseEnteredTarget.id,{type:"mouseleave",target:n,clientX:t.clientX,clientY:t.clientY,grabbing:this.grabbing}),this.mouseEnteredTarget=n,this.timeline.handleUserAction(n.id,{type:"mouseenter",target:n,clientX:t.clientX,clientY:t.clientY,grabbing:this.grabbing})),this.timeline.handleUserAction(n.id,{type:"mousemove",target:n,clientX:t.clientX,clientY:t.clientY,grabbing:this.grabbing})):this.mouseEnteredTarget&&(this.timeline.handleUserAction(this.mouseEnteredTarget.id,{type:"mouseleave",target:n,clientX:t.clientX,clientY:t.clientY,grabbing:this.grabbing}),this.mouseEnteredTarget=void 0)}onTouchMove(t){if(this.interactionAllowed&&this.mouseDownStart){const e=t.touches[0];this.maybeInitializeGrab(this.touchPosition(t),e.pageX,e.pageY)}return t.preventDefault(),t.stopPropagation(),!1}onMouseUp(t){this.interactionAllowed&&(this.mouseDownStart=void 0)}onTouchEnd(t){if(!this.interactionAllowed)return;const e=this.touchPosition(t);return this.endGrab(e),t.preventDefault(),t.stopPropagation(),!1}endGrab(t){if(this.grabbing)if(document.removeEventListener("mousemove",this.documentMouseMoveListener),document.removeEventListener("mouseup",this.documentMouseUpListener),document.removeEventListener("mouseleave",this.documentMouseLeaveListener),this.grabbing=!1,this.panning)this.reloadData(),this.timeline.fireEvent("viewportChanged",new E);else{let e,i;t&&(e=t.x-this.translation.x-this.timeline.getSidebarWidth(),i=this.timeline.toDate(e)),this.timeline.fireEvent("grabEnd",new M),this.timeline.handleUserAction(this.grabTarget.id,{type:"grabend",target:this.grabTarget,clientX:-1,clientY:-1,date:i,grabbing:!1,grabStart:this.untranslatePoint(this.mouseDownStart),grabPosition:this.untranslatePoint(t)})}this.mouseDownStart=void 0,this.grabTarget=void 0}reloadData(){this.interactionAllowed=!1,this.timeline.setRootCursor("wait",!0),setTimeout(()=>{this.timeline.render(),this.interactionAllowed=!0,this.timeline.resetRootCursor()},50)}onWheel(t){const e=this.mousePosition(t).x-this.translation.x;t.deltaY>0?this.timeline.zoomOut(e):t.deltaY<0&&this.timeline.zoomIn(e);const i=new k(t);this.timeline.fireEvent("viewportWheel",i)}onDocumentMouseMove(t){const e=this.mousePosition(t);if(this.grabTarget){const i=e.x-this.translation.x-this.timeline.getSidebarWidth(),s=this.timeline.toDate(i);this.timeline.handleUserAction(this.grabTarget.id,{type:"grabmove",target:this.grabTarget,clientX:t.clientX,clientY:t.clientY,date:s,grabbing:!0,grabStart:this.untranslatePoint(this.mouseDownStart),grabPosition:this.untranslatePoint(e)})}else this.pan(e)}pan(t){let e=t.minus(this.grabStart);"X_ONLY"===this.timeline.pannable?e=e.withY(0):"Y_ONLY"===this.timeline.pannable?e=e.withX(0):"NONE"===this.timeline.pannable&&(e=new H(0,0)),this.translation=e.withY(Math.min(e.y,0));const i=this.vdom.rootEl.createSVGTransform();i.setTranslate(this.translation.x,this.translation.y),this.vdom.bodyViewportEl.transform.baseVal.initialize(i);const s=this.vdom.rootEl.createSVGTransform();s.setTranslate(this.translation.x,0),this.vdom.headerViewportEl.transform.baseVal.initialize(s);const n=this.vdom.rootEl.createSVGTransform();n.setTranslate(0,this.translation.y),this.vdom.bodySidebarEl.transform.baseVal.initialize(n);const o=this.vdom.rootEl.createSVGTransform();o.setTranslate(this.translation.x,this.translation.y),this.vdom.overlayViewportEl.transform.baseVal.initialize(o);const r=this.vdom.rootEl.createSVGTransform();r.setTranslate(this.translation.x,0),this.vdom.xOverlayViewportEl.transform.baseVal.initialize(r);const a=this.vdom.rootEl.createSVGTransform();a.setTranslate(0,this.translation.y),this.vdom.yOverlayViewportEl.transform.baseVal.initialize(a),this.timeline.fireEvent("viewportChange",new T)}onDocumentMouseUp(t){if(!this.interactionAllowed)return;this.onMouseMove(t);const e=this.mousePosition(t);return this.endGrab(e),t.preventDefault(),t.stopPropagation(),!1}onDocumentMouseLeave(t){this.timeline.fireEvent("viewportHover",new C),this.mouseDownStart&&(this.endGrab(),this.timeline.render())}resetPan(){const t=this.vdom.rootEl.createSVGTransform();t.setTranslate(0,0),this.vdom.bodyViewportEl.transform.baseVal.initialize(t);const e=this.vdom.rootEl.createSVGTransform();e.setTranslate(0,0),this.vdom.headerViewportEl.transform.baseVal.initialize(e);const i=this.vdom.rootEl.createSVGTransform();i.setTranslate(0,0),this.vdom.bodySidebarEl.transform.baseVal.initialize(i);const s=this.vdom.rootEl.createSVGTransform();s.setTranslate(0,0),this.vdom.underlayViewportEl.transform.baseVal.initialize(s);const n=this.vdom.rootEl.createSVGTransform();n.setTranslate(0,0),this.vdom.xUnderlayViewportEl.transform.baseVal.initialize(n);const o=this.vdom.rootEl.createSVGTransform();o.setTranslate(0,0),this.vdom.yUnderlayViewportEl.transform.baseVal.initialize(o);const r=this.vdom.rootEl.createSVGTransform();r.setTranslate(0,0),this.vdom.overlayViewportEl.transform.baseVal.initialize(r);const a=this.vdom.rootEl.createSVGTransform();a.setTranslate(0,0),this.vdom.xOverlayViewportEl.transform.baseVal.initialize(a);const l=this.vdom.rootEl.createSVGTransform();l.setTranslate(0,0),this.vdom.yOverlayViewportEl.transform.baseVal.initialize(l),this.translation=new H(0,0)}}class bt extends lt{constructor(t,e,i){super(t,e,i),this.opts=e,this.style=i,this.eventsById={},this.events=e.events||[],this.hatchUncovered=!1!==e.hatchUncovered,this.lines=this.spreadAcrossLines(this.events),this.lineHeight=i.lineHeight,this.bandHeight=Math.max(this.lineHeight,this.lineHeight*this.lines.length)}static get type(){return"AttitudeBand"}static get rules(){return{dotColor:"#000",dotRadius:2,connectorColor:"grey",textColor:"grey",highlightOpacity:.2,eventHoverBackground:"#e2e2e2",dark:{dotColor:"#fff"}}}spreadAcrossLines(t){const e=[];for(const i of t){const t=q(i.start),s=q(i.stop),n=this.timeline.getFontMetrics(i.attitude,this.style.textSize);if(K(t,this.timeline.loadStop)&&tt(s,this.timeline.loadStart)){let s=!1;const o=this.timeline.positionDate(t),r=o+20+n.width;for(const t of e){let e=0,n=t.length-1;for(;e<=n;){const i=Math.floor((e+n)/2),s=this.timeline.getFontMetrics(t[i].attitude,this.style.textSize),a=this.timeline.positionDate(q(t[i].start)),l=a+20+s.width;if(r<=a)n=i-1;else{if(!(o>=l))break;e=i+1}}if(e>n){t.splice(e,0,i),s=!0;break}}s||e.push([i])}}return e}overlaps(t){const e=this.timeline.positionDate(q(t.start)),i=e+20+this.timeline.getFontMetrics(t.attitude,this.style.textSize).width;for(const s of this.events)if(t!==s){const t=this.timeline.positionDate(q(s.start));if(e<t+20+this.timeline.getFontMetrics(s.attitude,this.style.textSize).width&&i>t)return!0}return!1}get height(){return this.bandHeight}renderViewport(t){const e=new L;this.hatchUncovered&&e.addChild(new F({x:t.x+this.timeline.positionDate(this.timeline.loadStart),y:t.y,width:this.timeline.pointsBetween(this.timeline.loadStart,this.timeline.loadStop),height:this.height,fill:this.style.hatchFill,"pointer-events":"none"}));for(const i of this.lines)for(const s of i){const i=q(s.start),n=q(s.stop),o=X(),r=new F({id:o,x:t.x+this.timeline.positionDate(i),y:t.y,width:this.timeline.pointsBetween(i,n),height:this.height,fill:this.style.bandBackgroundColor});s.tooltip&&r.addChild(new N({},s.tooltip)),e.addChild(r),this.opts.interactive&&(r.setAttribute("cursor",this.style.highlightCursor),r.addChild(new j({attributeName:"fill",to:this.style.eventHoverBackground,begin:"mouseover",end:"mouseout"})),this.eventsById[o]=s,this.timeline.registerActionTarget("click",o),this.timeline.registerActionTarget("contextmenu",o),this.timeline.registerActionTarget("mouseenter",o),this.timeline.registerActionTarget("mousemove",o),this.timeline.registerActionTarget("mouseleave",o))}for(let i=0;i<this.lines.length;i++){const s=this.lines[i],n=t.y+i*this.lineHeight;for(const i of s){const s=q(i.start);let o=t.x+this.timeline.positionDate(s)+20;const r=q(i.stop),a=this.timeline.getFontMetrics(i.attitude,this.style.textSize);let l=t.y+this.bandHeight/2;if(this.overlaps(i)&&(l=n+this.lineHeight/2),e.addChild(new P({x1:t.x+this.timeline.positionDate(s),y1:t.y+this.height/2,x2:o-3,y2:l,stroke:this.style.connectorColor})),e.addChild(new R({x:o,y:l,fill:this.style.textColor,"text-anchor":"left","dominant-baseline":"middle","font-size":this.style.textSize,"pointer-events":"none"},i.attitude)),K(s,this.timeline.loadStart)||e.addChild(new z({cx:t.x+this.timeline.positionDate(s),cy:t.y+this.bandHeight/2,rx:this.style.dotRadius,ry:this.style.dotRadius,fill:this.style.dotColor})),this.timeline.pointsBetween(s,r)>2*a.width){const n=o+this.timeline.pointsBetween(s,r)-2*a.width;for(o+=2*a.width;o<=n;)e.addChild(new R({x:o,y:t.y+this.height/2,fill:this.style.textColor,"text-anchor":"left","dominant-baseline":"middle","font-size":this.style.textSize,"pointer-events":"none"},i.attitude)),o+=2*a.width}}}return e}onAction(t,e){if(super.onAction(t,e),this.eventsById[t])switch(e.type){case"click":const i=new V(this.eventsById[t],e);this.timeline.fireEvent("eventClick",i);break;case"contextmenu":const s=new V(this.eventsById[t],e);this.timeline.fireEvent("eventContextMenu",s);break;case"mouseenter":if(!e.grabbing){const i=new V(this.eventsById[t],e);this.timeline.fireEvent("eventMouseEnter",i)}break;case"mousemove":const n=new V(this.eventsById[t],e);this.timeline.fireEvent("eventMouseMove",n);break;case"mouseleave":const o=new V(this.eventsById[t],e);this.timeline.fireEvent("eventMouseLeave",o)}}}class ft extends lt{constructor(t,e,i){super(t,e,i),this.opts=e,this.style=i,this.eventsById={},this.commsBands=e.bands||[],this.events=e.events||[]}static get type(){return"CommsBand"}static get rules(){return{topMargin:0,bottomMargin:0,highlightOpacity:.7}}renderViewport(t){const e=new L,i=(this.height-this.style.topMargin-this.style.bottomMargin)/this.commsBands.length;for(const s of this.events){const n=q(s.start),o=q(s.stop);if(K(n,this.timeline.loadStop)&&tt(o,this.timeline.loadStart))for(let r=0;r<this.commsBands.length;r++){const a=this.commsBands[r];if(s[a.type]){const l=X(),h=new F({id:l,x:t.x+this.timeline.positionDate(n),y:t.y+this.style.topMargin+r*i,width:this.timeline.pointsBetween(n,o),height:i,fill:a.color});s.tooltip&&h.addChild(new N({},s.tooltip)),e.addChild(h),this.opts.interactive&&(h.setAttribute("cursor",this.style.highlightCursor),h.addChild(new j({attributeName:"opacity",to:this.style.highlightOpacity,begin:"mouseover",end:"mouseout"})),this.eventsById[l]=s,this.timeline.registerActionTarget("click",l),this.timeline.registerActionTarget("contextmenu",l),this.timeline.registerActionTarget("mouseenter",l),this.timeline.registerActionTarget("mousemove",l),this.timeline.registerActionTarget("mouseleave",l))}}}return e}onAction(t,e){if(super.onAction(t,e),this.eventsById[t])switch(e.type){case"click":const i=new V(this.eventsById[t],e);this.timeline.fireEvent("eventClick",i);break;case"contextmenu":const s=new V(this.eventsById[t],e);this.timeline.fireEvent("eventContextMenu",s);break;case"mouseenter":if(!e.grabbing){const i=new V(this.eventsById[t],e);this.timeline.fireEvent("eventMouseEnter",i)}break;case"mousemove":const n=new V(this.eventsById[t],e);this.timeline.fireEvent("eventMouseMove",n);break;case"mouseleave":const o=new V(this.eventsById[t],e);this.timeline.fireEvent("eventMouseLeave",o)}}}class wt extends lt{constructor(t,e,i){super(t,e,i),this.opts=e,this.style=i,this.eventsById={},this.events=e.events||[]}static get type(){return"DayNightBand"}static get rules(){return{dayColor:"#fff",nightColor:"#000",cursor:"pointer",dayHoverColor:"#e0e0e0",nightHoverColor:"grey",dividerColor:"#aaa",dark:{dayColor:"#bbb"}}}renderViewport(t){const e=new L;this.opts.hatchUncovered&&e.addChild(new F({x:t.x+this.timeline.positionDate(this.timeline.loadStart),y:t.y,width:this.timeline.pointsBetween(this.timeline.loadStart,this.timeline.loadStop),height:this.height,fill:this.style.hatchFill,"pointer-events":"none"}));for(let i=0;i<this.events.length;i++){const s=this.events[i],n=q(s.start),o=q(s.stop),r=X();if(K(n,this.timeline.loadStop)&&tt(o,this.timeline.loadStart)){const a=new F({id:r,x:t.x+this.timeline.positionDate(n),y:t.y,width:this.timeline.pointsBetween(n,o),height:this.height,fill:s.day?this.style.dayColor:this.style.nightColor});s.tooltip&&a.addChild(new N({},s.tooltip)),e.addChild(a),this.opts.interactive&&(s.day&&!this.opts.interactiveDays||(a.setAttribute("cursor",this.style.cursor),a.addChild(new j({attributeName:"fill",to:s.day?this.style.dayHoverColor:this.style.nightHoverColor,begin:"mouseover",end:"mouseout"})),this.eventsById[r]=s,this.timeline.registerActionTarget("click",r),this.timeline.registerActionTarget("contextmenu",r),this.timeline.registerActionTarget("mouseenter",r),this.timeline.registerActionTarget("mousemove",r),this.timeline.registerActionTarget("mouseleave",r))),K(n,this.timeline.loadStart)||e.addChild(new P({x1:t.x+this.timeline.positionDate(n),y1:t.y,x2:t.x+this.timeline.positionDate(n),y2:t.y+this.height,stroke:this.style.dividerColor})),i===this.events.length-1&&K(o,this.timeline.loadStop)&&e.addChild(new P({x1:t.x+this.timeline.positionDate(o),y1:t.y,x2:t.x+this.timeline.positionDate(o),y2:t.y+this.height,stroke:this.style.dividerColor}))}}return e}onAction(t,e){if(super.onAction(t,e),this.eventsById[t])switch(e.type){case"click":const i=new V(this.eventsById[t],e);this.timeline.fireEvent("eventClick",i);break;case"contextmenu":const s=new V(this.eventsById[t],e);this.timeline.fireEvent("eventContextMenu",s);break;case"mouseenter":if(!e.grabbing){const i=new V(this.eventsById[t],e);this.timeline.fireEvent("eventMouseEnter",i)}break;case"mousemove":const n=new V(this.eventsById[t],e);this.timeline.fireEvent("eventMouseMove",n);break;case"mouseleave":const o=new V(this.eventsById[t],e);this.timeline.fireEvent("eventMouseLeave",o)}}}class xt extends ht{constructor(t,e,i){super(t,Object.assign(Object.assign({},e),{wrap:!1}),i),this.opts=e,this.style=i}static get type(){return"OrbitNumberBand"}static get rules(){return rt({},ht.rules,{cornerRadius:0,textAlign:"center",borderColor:"#aaa",backgroundColor:"#f5f5f5",textColor:"grey",borders:"vertical"})}}class Ct extends lt{constructor(t,e,i){super(t,e,i),this.opts=e,this.style=i,this.eventsById={}}static get type(){return"SaaBand"}static get rules(){return{lineColor:"#c13f37",lineWidth:2,whiskerColor:"#c13f37",whiskerHeight:5,whiskerWidth:2}}renderViewport(t){const e=new L,i=(this.height-this.style.whiskerHeight)/2,s=this.opts.events||[];for(const n of s){const s=q(n.start),o=q(n.stop);if(K(s,this.timeline.loadStop)&&tt(o,this.timeline.loadStart)){const r=X(),a=new L({id:r});a.addChild(new F({x:t.x+this.timeline.positionDate(s),y:t.y,width:this.timeline.pointsBetween(s,o),height:this.height,opacity:0}),new P({x1:t.x+this.timeline.positionDate(s),y1:t.y+i,x2:t.x+this.timeline.positionDate(s),y2:t.y+this.height-i,stroke:this.style.whiskerColor||this.style.lineColor,"stroke-width":this.style.whiskerWidth||this.style.lineWidth}),new P({x1:t.x+this.timeline.positionDate(o),y1:t.y+i,x2:t.x+this.timeline.positionDate(o),y2:t.y+this.height-i,stroke:this.style.whiskerColor||this.style.lineColor,"stroke-width":this.style.whiskerWidth||this.style.lineWidth}),new P({x1:t.x+this.timeline.positionDate(s),y1:t.y+this.height/2,x2:t.x+this.timeline.positionDate(o),y2:t.y+this.height/2,stroke:this.style.lineColor,"stroke-width":this.style.lineWidth})),n.tooltip&&a.addChild(new N({},n.tooltip)),this.opts.interactive&&(a.setAttribute("cursor",this.style.highlightCursor),this.eventsById[r]=n,this.timeline.registerActionTarget("click",r),this.timeline.registerActionTarget("contextmenu",r),this.timeline.registerActionTarget("mouseenter",r),this.timeline.registerActionTarget("mousemove",r),this.timeline.registerActionTarget("mouseleave",r)),e.addChild(a)}}return e}onAction(t,e){if(super.onAction(t,e),this.eventsById[t])switch(e.type){case"click":const i=new V(this.eventsById[t],e);this.timeline.fireEvent("eventClick",i);break;case"contextmenu":const s=new V(this.eventsById[t],e);this.timeline.fireEvent("eventContextMenu",s);break;case"mouseenter":if(!e.grabbing){const i=new V(this.eventsById[t],e);this.timeline.fireEvent("eventMouseEnter",i)}break;case"mousemove":const n=new V(this.eventsById[t],e);this.timeline.fireEvent("eventMouseMove",n);break;case"mouseleave":const o=new V(this.eventsById[t],e);this.timeline.fireEvent("eventMouseLeave",o)}}}const St={type:"base",rules:{lineHeight:20,divisionWidth:20,fontFamily:"Verdana, Geneva, sans-serif",textColor:"#000",textSize:"10px",bandBackgroundColor:"transparent",bandDividerHeight:1,sidebarBackgroundColor:"#fff",sidebarForegroundColor:"grey",sidebarHoverBackgroundColor:"#e9e9e9",dividerColor:"#d1d5da",hatchFill:`url(${window.location.href}#crossHatch)`,highlightCursor:"pointer"},filters:[],defs:[new Y({id:"crossHatch",patternUnits:"userSpaceOnUse",x:0,y:0,width:15,height:15}).addChild(new Z({d:"M0,0 l15,15 M15,0 l-15,15",stroke:"#ddd","stroke-width":1}))]},kt={type:"dark",rules:{bandBackgroundColor:"#111111",sidebarBackgroundColor:"#1c1c1c",sidebarForegroundColor:"grey",sidebarHoverBackgroundColor:"#3c3f41",dividerColor:"#2e2e2e",textColor:"#bbb",hatchFill:`url(${window.location.href}#darkHatch)`},filters:[],defs:[new Y({id:"darkHatch",patternUnits:"userSpaceOnUse",x:0,y:0,width:15,height:15}).addChild(new Z({d:"M0,0 l15,15 M15,0 l-15,15",stroke:"#222","stroke-width":1}))]};class Tt{constructor(t){this.x=0,this.y=0,this.translation=new H(0,0),this.paddingTop=0,this.paddingBottom=0,this.headerHeight=0,this.bodyHeight=0,this.defsContentEls=[],this.filterContentEls=[],this.headerViewportEls=[],this.headerSidebarEls=[],this.bodyViewportEls=[],this.bodySidebarEls=[],this.underlayViewportEls=[],this.xUnderlayViewportEls=[],this.yUnderlayViewportEls=[],this.overlayViewportEls=[],this.xOverlayViewportEls=[],this.yOverlayViewportEls=[],this.contributions=t,this.enabledContributions=t.filter(t=>t.enabled),this.enabledHeaderContributions=this.enabledContributions.filter(t=>t.header),this.enabledBodyContributions=this.enabledContributions.filter(t=>!t.header)}get totalHeight(){return this.headerHeight+this.bodyHeight}getContributions(t){return 1===t?this.enabledBodyContributions:0===t?this.enabledHeaderContributions:[]}getSectionHeight(t){return 1===t?this.bodyHeight:0===t?this.headerHeight:void 0}addDefs(...t){this.defsContentEls.push(...t)}addFilters(...t){this.filterContentEls.push(...t)}addToViewportSection(t,...e){1===t?this.bodyViewportEls.push(...e):0===t&&this.headerViewportEls.push(...e)}addToViewportUnderlay(t,...e){2===t?this.underlayViewportEls.push(...e):0===t?this.xUnderlayViewportEls.push(...e):1===t&&this.yUnderlayViewportEls.push(...e)}addToViewportOverlay(t,...e){2===t?this.overlayViewportEls.push(...e):0===t?this.xOverlayViewportEls.push(...e):1===t&&this.yOverlayViewportEls.push(...e)}addToSidebar(t,...e){1===t?this.bodySidebarEls.push(...e):0===t&&this.headerSidebarEls.push(...e)}}class Et{constructor(t,e){this.timeline=t,this.style=e,this.filterEls=[],this.rootEl=new _({width:"100%",height:"100%",style:"width: 100%; height: 100%; overflow: hidden","font-family":e.fontFamily}).toDomElement(),this.defsEl=(new U).toDomElement(),this.rootEl.appendChild(this.defsEl),this.mousePositionReferenceEl=(new _).toDomElement(),this.rootEl.appendChild(this.mousePositionReferenceEl),this.underlayViewportSvgWrapperEl=new _({class:"ts-underlay-vp",style:"overflow: visible"}).toDomElement(),this.rootEl.appendChild(this.underlayViewportSvgWrapperEl),this.underlayViewportEl=(new L).toDomElement(),this.underlayViewportSvgWrapperEl.appendChild(this.underlayViewportEl),this.xUnderlayViewportSvgWrapperEl=new _({class:"ts-underlay-x-vp",style:"overflow: visible"}).toDomElement(),this.rootEl.appendChild(this.xUnderlayViewportSvgWrapperEl),this.xUnderlayViewportEl=(new L).toDomElement(),this.xUnderlayViewportSvgWrapperEl.appendChild(this.xUnderlayViewportEl),this.yUnderlayViewportSvgWrapperEl=new _({class:"ts-underlay-y-vp",style:"overflow: visible"}).toDomElement(),this.rootEl.appendChild(this.yUnderlayViewportSvgWrapperEl),this.yUnderlayViewportEl=(new L).toDomElement(),this.yUnderlayViewportSvgWrapperEl.appendChild(this.yUnderlayViewportEl),this.bodyViewportSvgWrapperEl=new _({class:"ts-body-vp",style:"overflow: hidden"}).toDomElement(),this.rootEl.appendChild(this.bodyViewportSvgWrapperEl),this.bodyViewportEl=(new L).toDomElement(),this.bodyViewportSvgWrapperEl.appendChild(this.bodyViewportEl),this.headerViewportSvgWrapperEl=new _({class:"ts-header-vp",style:"overflow: hidden"}).toDomElement(),this.rootEl.appendChild(this.headerViewportSvgWrapperEl),this.headerViewportEl=(new L).toDomElement(),this.headerViewportSvgWrapperEl.appendChild(this.headerViewportEl),this.overlayViewportSvgWrapperEl=new _({class:"ts-overlay-vp",style:"overflow: visible"}).toDomElement(),this.rootEl.appendChild(this.overlayViewportSvgWrapperEl),this.overlayViewportEl=(new L).toDomElement(),this.overlayViewportSvgWrapperEl.appendChild(this.overlayViewportEl),this.xOverlayViewportSvgWrapperEl=new _({class:"ts-overlay-x-vp",style:"overflow: visible"}).toDomElement(),this.rootEl.appendChild(this.xOverlayViewportSvgWrapperEl),this.xOverlayViewportEl=(new L).toDomElement(),this.xOverlayViewportSvgWrapperEl.appendChild(this.xOverlayViewportEl),this.yOverlayViewportSvgWrapperEl=new _({class:"ts-overlay-y-vp",style:"overflow: visible"}).toDomElement(),this.rootEl.appendChild(this.yOverlayViewportSvgWrapperEl),this.yOverlayViewportEl=(new L).toDomElement(),this.yOverlayViewportSvgWrapperEl.appendChild(this.yOverlayViewportEl);const i=(new L).addChild(new F({x:0,y:0,height:"100%",width:this.timeline.getSidebarWidth(),fill:e.sidebarBackgroundColor}),new F({x:this.timeline.getSidebarWidth(),y:0,width:1,height:"100%",fill:e.dividerColor}));this.rootEl.appendChild(i.toDomElement()),this.bodySidebarSvgWrapperEl=new _({class:"ts-body-sb",style:"overflow: hidden",width:this.timeline.getSidebarWidth()}).toDomElement(),this.rootEl.appendChild(this.bodySidebarSvgWrapperEl),this.bodySidebarEl=(new L).toDomElement(),this.bodySidebarSvgWrapperEl.appendChild(this.bodySidebarEl),this.headerSidebarSvgWrapperEl=new _({class:"ts-header-sb",style:"overflow: hidden",width:this.timeline.getSidebarWidth()}).toDomElement(),this.rootEl.appendChild(this.headerSidebarSvgWrapperEl),this.headerSidebarEl=(new L).toDomElement(),this.headerSidebarSvgWrapperEl.appendChild(this.headerSidebarEl)}rebuild(t=new H(0,0)){const e=this.calculateContentModel(t);this.defsEl.innerHTML="",this.headerViewportEl.innerHTML="",this.headerSidebarEl.innerHTML="",this.bodyViewportEl.innerHTML="",this.bodySidebarEl.innerHTML="",this.underlayViewportEl.innerHTML="",this.xUnderlayViewportEl.innerHTML="",this.yUnderlayViewportEl.innerHTML="",this.overlayViewportEl.innerHTML="",this.xOverlayViewportEl.innerHTML="",this.yOverlayViewportEl.innerHTML="";for(const i of this.filterEls)this.rootEl.removeChild(i);this.filterEls=[];for(const i of e.defsContentEls)this.defsEl.appendChild(i.toDomElement());for(const i of e.filterContentEls){const t=i.toDomElement();this.rootEl.appendChild(t),this.filterEls.push(t)}for(const i of e.underlayViewportEls)this.underlayViewportEl.appendChild(i.toDomElement());for(const i of e.xUnderlayViewportEls)this.xUnderlayViewportEl.appendChild(i.toDomElement());for(const i of e.yUnderlayViewportEls)this.yUnderlayViewportEl.appendChild(i.toDomElement());for(const i of e.headerViewportEls)this.headerViewportEl.appendChild(i.toDomElement());for(const i of e.headerSidebarEls)this.headerSidebarEl.appendChild(i.toDomElement());for(const i of e.bodyViewportEls)this.bodyViewportEl.appendChild(i.toDomElement());for(const i of e.bodySidebarEls)this.bodySidebarEl.appendChild(i.toDomElement());for(const i of e.overlayViewportEls)this.overlayViewportEl.appendChild(i.toDomElement());for(const i of e.xOverlayViewportEls)this.xOverlayViewportEl.appendChild(i.toDomElement());for(const i of e.yOverlayViewportEls)this.yOverlayViewportEl.appendChild(i.toDomElement());return this.headerViewportSvgWrapperEl.setAttribute("x",String(this.timeline.getSidebarWidth())),this.bodyViewportSvgWrapperEl.setAttribute("x",String(this.timeline.getSidebarWidth())),this.bodyViewportSvgWrapperEl.setAttribute("y",String(e.headerHeight)),this.bodySidebarSvgWrapperEl.setAttribute("y",String(e.headerHeight)),e}calculateContentModel(t){const e=new Tt(this.timeline.contributions);e.translation=t;for(let i=0;i<e.enabledContributions.length;i++){const t=e.enabledContributions[i];t.header?(e.headerHeight+=t.height,0!==i&&t.height>0&&(e.headerHeight+=this.style.bandDividerHeight)):(e.bodyHeight+=t.height,0!==i&&t.height>0&&(e.bodyHeight+=this.style.bandDividerHeight))}e.addDefs(...this.renderDefs()),e.addFilters(...this.renderFilters());for(const i of e.enabledContributions)e.addToViewportUnderlay(2,i.renderViewportUnderlay(e)),e.addToViewportUnderlay(0,i.renderViewportUnderlay(e)),e.addToViewportUnderlay(1,i.renderViewportUnderlay(e));this.renderSection(e,0),this.renderSection(e,1);for(const i of e.enabledContributions)e.addToViewportOverlay(2,i.renderViewportOverlay(e)),e.addToViewportOverlay(0,i.renderViewportXOverlay(e)),e.addToViewportOverlay(1,i.renderViewportYOverlay(e));return e}renderSection(t,e){t.x=0,t.y=0;for(const i of t.getContributions(e)){i.renderSection(t,e);let s=i.height;s>0&&(s+=this.style.bandDividerHeight),t.y+=s}}renderDefs(){const t=this.timeline.theme.defs||[];for(const e of this.timeline.contributions)t.push(...e.renderDefs());return t}renderFilters(){const t=this.timeline.theme.filters||[];for(const e of this.timeline.contributions)t.push(...e.renderFilters());return t}}class Dt{constructor(t,e){this.contributions=[],this.contributionsById={},this.plugins={},this.themes={},this.eventListeners={loadRange:[],eventClick:[],eventContextMenu:[],eventChanged:[],eventMouseEnter:[],eventMouseMove:[],eventMouseLeave:[],grabStart:[],grabEnd:[],rangeSelectionChanged:[],sidebarClick:[],sidebarContextMenu:[],sidebarMouseEnter:[],sidebarMouseLeave:[],viewportHover:[],viewportChange:[],viewportChanged:[],viewportWheel:[]},this.sidebarWidth=200,this.actionTargetsByType={},this.containerEl=t,this.registerPlugin(ht),this.registerPlugin(mt),this.registerPlugin(ct),this.registerPlugin(pt),this.registerPlugin(dt),this.registerPlugin(yt),this.registerPlugin(ut),this.registerPlugin(bt),this.registerPlugin(ft),this.registerPlugin(wt),this.registerPlugin(xt),this.registerPlugin(Ct),this.registerTheme(St),this.registerTheme(kt),this.measurerSvg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.measurerSvg.setAttribute("height","0"),this.measurerSvg.setAttribute("width","0"),this.measurerSvg.setAttribute("style","visibility: hidden"),this.containerEl.appendChild(this.measurerSvg),this.width=function(t){return t.getBoundingClientRect().width}(this.containerEl),e=rt({theme:"base",zoom:Dt.defaultZoom,initialDate:new Date,domReduction:!1,pannable:"XY",tracker:!0,nodata:!0,wallclock:!0,data:[]},e),this.updateOptions(e,!1)}registerPlugin(t){this.plugins[t.type]=t}registerTheme(t){this.themes[t.type]={type:t.type,rules:rt({},St.rules,t.rules),filters:St.filters.concat(t.filters||[]),defs:St.defs.concat(t.defs||[])}}static get minZoom(){return 1}static get defaultZoom(){return 12}static get maxZoom(){return 15}getFontMetrics(t,e){const i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("font-size",String(e)),i.appendChild(document.createTextNode(t)),this.measurerSvg.appendChild(i);const s=i.getBBox();return this.measurerSvg.removeChild(i),{height:s.height,width:s.width}}updateOptions(t,e=!0){let i,s;if(t.style&&(this._style=t.style),t.theme&&(this.theme=this.themes[t.theme]),this.style=rt({},this.theme.rules,this._style),this.measurerSvg.setAttribute("font-family",this.style.fontFamily),t.zoom&&(this.zoom=Math.min(Dt.maxZoom,Math.max(Dt.minZoom,t.zoom)),this.secondsPerDivision=this.calculateSecondsPerDivision()),t.initialDate){this.eventHandling&&this.eventHandling.resetPan();const e=q(t.initialDate);this.unpannedVisibleStart=this.leftifyDate(e),i=this.unpannedVisibleStart,s=G(i,this.visibleWidth*(this.secondsPerDivision/this.style.divisionWidth))}void 0!==t.tracker&&(this.tracker=t.tracker),void 0!==t.nodata&&(this.nodata=!!t.nodata),void 0!==t.wallclock&&(this.wallclock=!!t.wallclock),void 0!==t.data&&(this.data=t.data),void 0!==t.domReduction&&(this.domReduction=!!t.domReduction),void 0!==t.sidebarWidth&&(this.sidebarWidth=t.sidebarWidth),void 0!==t.pannable&&(this.pannable=!1===t.pannable?"NONE":!0===t.pannable?"XY":t.pannable),i||(i=new Date(this.visibleStart.getTime())),s||(s=new Date(this.visibleStop.getTime()));const n=1*Q(i,s);return this.loadStart=J(i,-n),this.loadStop=J(s,n),e&&(this.fireEvent("loadRange",new x(this.loadStart,this.loadStop)),this.doRender()),this}setData(t,e=!0){return this.data=t,e&&this.doRender(),this}on(t,e){if(!(t in this.eventListeners))throw new Error(`Unknown event '${t}'`);return this.eventListeners[t].push(e),this}off(t,e){if(!(t in this.eventListeners))throw new Error(`Unknown event '${t}'`);return this.eventListeners[t]=this.eventListeners[t].filter(t=>t!==e),this}fireEvent(t,e){this.eventListeners[t].forEach(t=>t(e))}get visibleStart(){return this.eventHandling?G(this.unpannedVisibleStart,this.secondsPerDivision*(-this.eventHandling.translation.x/this.style.divisionWidth)):this.unpannedVisibleStart}get visibleCenter(){return G(this.visibleStart,this.visibleWidth/2*(this.secondsPerDivision/this.style.divisionWidth))}get visibleStop(){return G(this.visibleStart,this.visibleWidth*(this.secondsPerDivision/this.style.divisionWidth))}getZoom(){return this.zoom}zoomIn(t){return this.applyZoom(this.zoom+1,t),this}zoomOut(t){return this.applyZoom(this.zoom-1,t),this}applyZoom(t,e){if(void 0===e){const e=this.visibleCenter;this.zoom=Math.min(Dt.maxZoom,Math.max(Dt.minZoom,t)),this.secondsPerDivision=this.calculateSecondsPerDivision(),this.eventHandling.resetPan(),this.reveal(e)}else{const i=this.toDate(e),s=(e+this.xTranslation)/this.visibleWidth;this.zoom=Math.min(Dt.maxZoom,Math.max(Dt.minZoom,t)),this.secondsPerDivision=this.calculateSecondsPerDivision();const n=G(i,this.visibleWidth*(this.secondsPerDivision/this.style.divisionWidth)*(.5-s));this.eventHandling.resetPan(),this.reveal(n)}return this}get xTranslation(){return this.eventHandling?this.eventHandling.translation.x:0}calculateSecondsPerDivision(){switch(this.zoom){case 1:return 1638400;case 2:return 819200;case 3:return 409600;case 4:return 204800;case 5:return 102400;case 6:return 51200;case 7:return 25600;case 8:return 12800;case 9:return 6400;case 10:return 3200;case 11:return 1600;case 12:return 800;case 13:return 400;case 14:return 200;case 15:return 100;default:throw new Error(`Unexpected zoom level ${this.zoom}`)}}toDate(t){return G(this.unpannedVisibleStart,t/this.style.divisionWidth*this.secondsPerDivision)}positionDate(t){return this.pointsBetween(this.unpannedVisibleStart,t)+this.xTranslation}pointsBetween(t,e){return Q(t,e)/1e3/this.secondsPerDivision*this.style.divisionWidth}registerActionTarget(t,e){this.actionTargetsByType.hasOwnProperty(t)?this.actionTargetsByType[t].push(e):this.actionTargetsByType[t]=[e]}handleUserAction(t,e){for(const i of this.contributions)i.onAction(t,e)}setWallclockTime(t){this.lastManualWallclockTime=q(t),this.contributionsById._wallclock.updateTime(this.lastManualWallclockTime)}get visibleWidth(){return this.width-this.sidebarWidth}getSidebarWidth(){return this.sidebarWidth}setSidebarWidth(t){this.sidebarWidth=t}leftifyDate(t){return G(t,-this.visibleWidth/2*(this.secondsPerDivision/this.style.divisionWidth))}render(){return this.updateOptions({}),this}rebuildDOM(){return this.vdom.rebuild(this.eventHandling.translation),this}doRender(){if(this.vdom){for(const t of this.contributions)t.tearDown();this.contributions=[],this.contributionsById={}}if(Array.isArray(this.data))for(const e of this.data)this.createContribution(e);else{for(const t of this.data.header)this.createContribution(t,!0);for(const t of this.data.body)this.createContribution(t)}this.createContribution({type:"HorizontalSelection"}),this.tracker&&this.createContribution({type:"LocationTracker"}),this.nodata&&this.createContribution({type:"NoDataZone"}),this.createContribution({id:"_wallclock",type:"WallclockLocator",auto:!!this.wallclock,time:this.lastManualWallclockTime||new Date}),this.vdom||(this.vdom=new Et(this,this.style),this.eventHandling=new vt(this,this.vdom),this.containerEl.appendChild(this.vdom.rootEl));const t=this.vdom.rebuild(this.eventHandling.translation);for(const e of this.contributions)e.postRender(t,this.vdom.rootEl);this.fireEvent("viewportChanged",new E)}createContribution(t,e=!1){const i=this.plugins[t.type];if(!i)throw new Error(`No plugin could be found matching type '${t.type}'`);const s=rt({},this.style);i.rules&&(rt(s,i.rules),i.rules[this.theme.type]&&rt(s,i.rules[this.theme.type])),t.style&&rt(s,t.style);const n=new i(this,t,s);n.type=i.type,n.header=e,this.contributions.push(n),t.id&&(this.contributionsById[t.id]=n)}selectRange(t,e){const i=q(t),s=q(e);this.selectedRange=i.getTime()<=s.getTime()?{start:i,stop:s}:{start:s,stop:i};for(const n of this.contributions)if(n.type===dt.type)return n.setSelection(this.selectedRange),void this.fireEvent("rangeSelectionChanged",new A(this.selectedRange))}clearSelection(){this.selectedRange=void 0;for(const t of this.contributions)if(t.type===dt.type)return t.clearSelection(),void this.fireEvent("rangeSelectionChanged",new A)}findActionTarget(t,e){const i=this.getTargetElement(t);if(!e)return i;if(i){const t=this.actionTargetsByType[e];if(t&&t.indexOf(i.id)>=0)return i}}getTargetElement(t){let e=t;for(;e&&e.parentElement&&e!==this.vdom.rootEl&&!e.id;)e=e.parentElement;if(e&&e.id)return e}setRootCursor(t,e=!1){e?this.vdom.rootEl.style.setProperty("cursor",t,"important"):this.vdom.rootEl.style.setProperty("cursor",t)}resetRootCursor(){this.vdom.rootEl.style.removeProperty("cursor")}goForward(t=.3){const e=this.positionDate(this.visibleCenter);this.reveal(this.toDate(e+t*this.visibleWidth))}goBackward(t=.3){const e=this.positionDate(this.visibleCenter);this.reveal(this.toDate(e-t*this.visibleWidth))}reveal(t){return this.updateOptions({initialDate:t}),this}}const Mt=["tt"];let At=(()=>{class t{show(t,e,i){const s=this.tt.nativeElement;s.style.left=e+"px",s.style.top=i+"px",s.style.display="block",s.innerHTML=t}hide(){this.tt.nativeElement.style.display="none"}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=h.Xpm({type:t,selectors:[["ng-component"]],viewQuery:function(t,e){if(1&t&&h.Gf(Mt,7),2&t){let t;h.iGM(t=h.CRH())&&(e.tt=t.first)}},decls:2,vars:0,consts:[[1,"ya-tooltip"],["tt",""]],template:function(t,e){1&t&&h._UZ(0,"div",0,1)},styles:[".ya-tooltip[_ngcontent-%COMP%]{position:absolute;display:none;white-space:nowrap;color:#fff;border-radius:2px;max-width:250px;margin-top:14px;background:rgba(97,97,97,.9);font-family:Roboto Mono,monospace;font-size:10px;padding:6px 8px}"]}),t})();var Vt=i(9624),Bt=i(5333),Ht=i(487),Ot=i(3589),It=i(9451),Ut=i(6972),zt=i(4369),Lt=i(7307),Wt=i(4311),Pt=i(1430);const Zt=["container"];function Yt(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"label",18),h.TgZ(1,"input",19),h.NdJ("change",function(){return h.CHM(t),h.oxw().updateLegend()}),h.qZA(),h._uU(2),h.qZA()}if(2&t){const t=e.$implicit;h.Udp("background-color",t.bg)("color",t.fg),h.xp6(1),h.Q6J("formControlName",t.id),h.xp6(1),h.hij(" ",t.name," ")}}function Ft(t,e){if(1&t&&(h.TgZ(0,"span"),h._uU(1),h.ALo(2,"datetime"),h.ALo(3,"datetime"),h.qZA()),2&t){const t=e.ngIf;h.xp6(1),h.AsE(" ",h.xi3(2,2,null==t?null:t.start,!1)," \u2013 ",h.lcZ(3,5,null==t?null:t.stop)," ")}}const jt=[{path:"",canActivate:[r.a,o.z],canActivateChild:[r.a],runGuardsAndResolvers:"always",component:a.K,children:[{path:"",pathMatch:"full",component:(()=>{class t{constructor(t,e,i,s,n,o,r,a){var p,m;this.yamcs=e,this.route=i,this.router=s,this.overlay=n,this.dialog=o,this.dateTimePipe=r,this.snackBar=a,this.completenessBg="orange",this.completenessFg="rgb(173, 94, 0)",this.packetsBg="palegoldenrod",this.packetsFg="#555",this.parametersBg="navajowhite",this.parametersFg="#1c4b8b",this.commandsBg="#ffcc00",this.commandsFg="#1c4b8b",this.eventsBg="#ffff66",this.eventsFg="#1c4b8b",this.legendOptions=[{id:"packets",name:"Packets",bg:this.packetsBg,fg:this.packetsFg,checked:!0},{id:"parameters",name:"Parameters",bg:this.parametersBg,fg:this.parametersFg,checked:!0},{id:"commands",name:"Commands",bg:this.commandsBg,fg:this.commandsFg,checked:!1},{id:"events",name:"Events",bg:this.eventsBg,fg:this.eventsFg,checked:!1}],this.rangeSelection$=new c.X(null),this.viewportRange$=new c.X(null),this.packetNames=[],t.setTitle("Archive Browser"),-1!==((null===(m=null===(p=e.connectionInfo$.value)||void 0===p?void 0:p.instance)||void 0===m?void 0:m.capabilities)||[]).indexOf("ccsds-completeness")&&(this.legendOptions=[{id:"completeness",name:"Completeness",bg:this.completenessBg,fg:this.completenessFg,checked:!0},...this.legendOptions]),this.filterForm=new d.cw({});const u=this.route.snapshot.queryParamMap;for(const l of this.legendOptions){let t=l.checked;u.has(l.id)&&(t="true"===u.get(l.id)),this.filterForm.addControl(l.id,new d.NI(t))}this.timeSubscription=e.time$.subscribe(t=>{this.timeline&&t&&this.timeline.setWallclockTime(t)});const g=new h.SBq(document.body),y=this.overlay.position().connectedTo(g,{originX:"start",originY:"top"},{overlayX:"start",overlayY:"top"}),v=this.overlay.create({positionStrategy:y}),b=new l.C5(At);this.tooltipInstance=v.attach(b).instance}hideTooltip(){this.tooltipInstance.hide()}ngAfterViewInit(){this.yamcs.yamcsClient.getPacketNames(this.yamcs.instance).then(t=>{this.packetNames=t,window.setTimeout(()=>this.initializeTimeline())})}initializeTimeline(){const t=this.route.snapshot.queryParamMap,e=t.get("t");let i;t.has("z")&&(i=Number(t.get("z")));const s={initialDate:e||this.yamcs.getMissionTime().toISOString(),zoom:i||12,pannable:"X_ONLY",wallclock:!1,sidebarWidth:200};this.timeline=new Dt(this.container.nativeElement,s),this.timeline.on("viewportChanged",()=>{this.viewportRange$.next({start:this.timeline.visibleStart,stop:this.timeline.visibleStop});const t={};for(const e of this.legendOptions)t[e.id]=this.filterForm.value[e.id];this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParamsHandling:"merge",queryParams:Object.assign({t:this.timeline.visibleCenter.toISOString(),z:this.timeline.getZoom()},t)})}),this.timeline.on("eventMouseEnter",t=>{const e=t.userObject;let i=`Start: ${this.dateTimePipe.transform(e.start)}<br>`;if(i+=`Stop:&nbsp; ${this.dateTimePipe.transform(e.stop)}<br>`,e.data.count>=0){const t=(Date.parse(e.stop)-Date.parse(e.start))/1e3;i+=`Count: ${e.data.count}`,e.data.count>1&&(i+=` (${(e.data.count/t).toFixed(3)} Hz)`)}else e.data.description&&(i+=e.data.description);this.tooltipInstance.show(i,t.clientX,t.clientY)}),this.timeline.on("eventClick",t=>{const e=t.userObject;this.timeline.selectRange(e.start,e.stop)}),this.timeline.on("grabStart",()=>{this.tooltipInstance.hide()}),this.timeline.on("eventMouseLeave",t=>{this.tooltipInstance.hide()}),this.timeline.on("viewportHover",t=>{void 0===t.x&&this.tooltipInstance.hide()}),this.timeline.on("rangeSelectionChanged",t=>{this.rangeSelection$.next(t.range||null)}),this.timeline.on("loadRange",t=>{let e=Promise.resolve([]);this.filterForm.value.completeness&&(e=this.yamcs.yamcsClient.getCompletenessIndex(this.yamcs.instance,{start:t.loadStart.toISOString(),stop:t.loadStop.toISOString(),limit:1e3}));let i=Promise.resolve([]);this.filterForm.value.packets&&(i=this.yamcs.yamcsClient.getPacketIndex(this.yamcs.instance,{start:t.loadStart.toISOString(),stop:t.loadStop.toISOString(),limit:1e3}));let s=Promise.resolve([]);this.filterForm.value.parameters&&(s=this.yamcs.yamcsClient.getParameterIndex(this.yamcs.instance,{start:t.loadStart.toISOString(),stop:t.loadStop.toISOString(),limit:1e3}));let n=Promise.resolve([]);this.filterForm.value.commands&&(n=this.yamcs.yamcsClient.getCommandIndex(this.yamcs.instance,{start:t.loadStart.toISOString(),stop:t.loadStop.toISOString(),limit:1e3}));let o=Promise.resolve([]);this.filterForm.value.events&&(o=this.yamcs.yamcsClient.getEventIndex(this.yamcs.instance,{start:t.loadStart.toISOString(),stop:t.loadStop.toISOString(),limit:1e3})),Promise.all([this.yamcs.yamcsClient.getTags(this.yamcs.instance,{start:t.loadStart.toISOString(),stop:t.loadStop.toISOString()}),e,i,s,n,o]).then(t=>{const e=t[0].tag||[],i=t[1],s=t[2],n=t[3],o=t[4],r=t[5],a=[];if(e.length){const t=[];for(const i of e)t.push({start:i.startUTC,stop:i.stopUTC,milestone:!1,title:i.name,backgroundColor:i.color,foregroundColor:"black",data:{id:i.id,description:i.description}});a.push({id:"Tags",type:"EventBand",label:"Tags",interactive:!0,interactiveSidebar:!1,style:{marginTop:4,marginBottom:4},events:t})}for(let l=0;l<i.length;l++){const t=i[l],e=[];for(const i of t.entry){const t={start:i.start,stop:i.stop,milestone:!1,data:{count:i.count}};if(i.count>1){const e=(Date.parse(i.stop)-Date.parse(i.start))/1e3;t.title=`${(i.count/e).toFixed(1)} Hz`}e.push(t)}const s={};l<i.length-1&&(s.dividerColor="transparent"),a.push({id:t.id.name,type:"EventBand",label:t.id.name,interactive:!0,interactiveSidebar:!1,wrap:!1,style:Object.assign(Object.assign({},s),{backgroundColor:this.completenessBg,textColor:this.completenessFg,marginTop:4,marginBottom:4}),events:e})}if(this.filterForm.value.packets)for(let l=0;l<this.packetNames.length;l++){const t=this.packetNames[l],e=[];for(const n of s)if(n.id.name===t)for(const t of n.entry){const i={start:t.start,stop:t.stop,milestone:!1,data:{count:t.count}};if(t.count>1){const e=(Date.parse(t.stop)-Date.parse(t.start))/1e3;i.title=`${(t.count/e).toFixed(1)} Hz`}e.push(i)}const i={};l<this.packetNames.length-1&&(i.dividerColor="transparent"),a.push({id:t,type:"EventBand",label:t,interactive:!0,interactiveSidebar:!1,wrap:!1,style:Object.assign(Object.assign({},i),{backgroundColor:this.packetsBg,textColor:this.packetsFg,marginTop:4,marginBottom:4}),events:e})}for(let l=0;l<n.length;l++){const t=n[l],e=[];for(const s of t.entry){const t={start:s.start,stop:s.stop,milestone:!1,data:{count:s.count}};if(s.count>1){const e=(Date.parse(s.stop)-Date.parse(s.start))/1e3;t.title=`${(s.count/e).toFixed(1)} Hz`}e.push(t)}const i={};l<n.length-1&&(i.dividerColor="transparent"),a.push({id:t.id.name,type:"EventBand",label:t.id.name,interactive:!0,interactiveSidebar:!1,wrap:!1,style:Object.assign(Object.assign({},i),{backgroundColor:this.parametersBg,textColor:this.parametersFg,marginTop:4,marginBottom:4}),events:e})}for(let l=0;l<o.length;l++){const t=o[l],e=[];for(const s of t.entry){const t={start:s.start,stop:s.stop,data:{count:s.count}};if(s.count>1){const e=(Date.parse(s.stop)-Date.parse(s.start))/1e3;t.title=`${(s.count/e).toFixed(1)} Hz`}e.push(t)}const i={};l<o.length-1&&(i.dividerColor="transparent"),a.push({id:t.id.name,type:"EventBand",label:t.id.name,interactive:!0,interactiveSidebar:!1,wrap:!1,style:Object.assign(Object.assign({},i),{backgroundColor:this.commandsBg,textColor:this.commandsFg,marginTop:4,marginBottom:4}),events:e})}for(let l=0;l<r.length;l++){const t=r[l],e=[];for(const s of t.entry){const t={start:s.start,stop:s.stop,data:{count:s.count}};if(s.count>1){const e=(Date.parse(s.stop)-Date.parse(s.start))/1e3;t.title=`${(s.count/e).toFixed(1)} Hz`}e.push(t)}const i={};l<r.length-1&&(i.dividerColor="transparent"),a.push({id:t.id.name,type:"EventBand",label:t.id.name,interactive:!0,interactiveSidebar:!1,wrap:!1,style:Object.assign(Object.assign({},i),{backgroundColor:this.eventsBg,textColor:this.eventsFg,marginTop:4,marginBottom:4}),events:e})}this.timeline.setData({header:[{type:"Timescale",label:"",tz:"UTC",grabAction:"select"}],body:a})})}),this.timeline.render()}jumpToNow(){const t=this.yamcs.getMissionTime();this.timeline.reveal(t)}jumpTo(){this.dialog.open(w,{width:"400px",data:{date:this.timeline.visibleCenter}}).afterClosed().subscribe(t=>{t&&this.timeline.reveal(t.date)})}refresh(){this.timeline.reveal(this.timeline.visibleCenter)}zoomIn(){this.timeline.zoomIn()}zoomOut(){this.timeline.zoomOut()}goBackward(){this.timeline.goBackward()}goForward(){this.timeline.goForward()}replayRange(){const t=this.rangeSelection$.value;t&&this.dialog.open(m.N,{width:"400px",data:{start:t.start,stop:t.stop}}).afterClosed().subscribe(t=>{t&&(this.snackBar.open(`Initializing replay ${t.name}...`,void 0,{horizontalPosition:"end"}),this.yamcs.yamcsClient.createProcessor(t).then(()=>{this.yamcs.switchContext(this.yamcs.instance,t.name),this.snackBar.open(`Joining replay ${t.name}`,void 0,{duration:3e3,horizontalPosition:"end"})}).catch(t=>{this.snackBar.open("Failed to initialize replay",void 0,{duration:3e3,horizontalPosition:"end"})}))})}downloadDump(){const t=this.rangeSelection$.value;t&&this.dialog.open(f,{width:"400px",data:{start:t.start,stop:t.stop}})}updateLegend(){this.refresh()}ngOnDestroy(){this.timeSubscription&&this.timeSubscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(Vt.Dx),h.Y36(p.C),h.Y36(n.gz),h.Y36(n.F0),h.Y36(Bt.aV),h.Y36(u.uw),h.Y36(Ht.i),h.Y36(Ot.ux))},t.\u0275cmp=h.Xpm({type:t,selectors:[["ng-component"]],viewQuery:function(t,e){if(1&t&&h.Gf(Zt,7),2&t){let t;h.iGM(t=h.CRH())&&(e.container=t.first)}},hostBindings:function(t,e){1&t&&h.NdJ("mouseleave",function(){return e.hideTooltip()})},decls:51,vars:11,consts:[["noscroll","true"],["mat-button","","color","primary",3,"disabled","click"],["mat-icon-button","","color","primary","matTooltip","Refresh view",3,"click"],[2,"height","24px","margin","6px"],[3,"formGroup"],[1,"ya-button",2,"margin-right","0",3,"click"],[1,"ya-button",2,"margin-left","0","margin-right","0",3,"click"],[1,"ya-button",2,"margin-left","0",3,"click"],[1,"ya-button",3,"click"],["class","legend no-select",3,"backgroundColor","color",4,"ngFor","ngForOf"],[1,"timeline-container"],["container",""],[1,"zoom-actions"],[1,"zoom-actions-inner","mat-elevation-z1"],["mat-button","",3,"click"],[1,"separator"],[1,"info"],[4,"ngIf"],[1,"legend","no-select"],["type","checkbox",3,"formControlName","change"]],template:function(t,e){1&t&&(h.TgZ(0,"app-instance-page",0),h.TgZ(1,"app-instance-toolbar"),h._uU(2," Archive Browser \xa0\xa0\xa0 "),h.TgZ(3,"button",1),h.NdJ("click",function(){return e.replayRange()}),h.ALo(4,"async"),h.TgZ(5,"mat-icon"),h._uU(6,"play_circle_filled"),h.qZA(),h._uU(7," REPLAY RANGE "),h.qZA(),h.TgZ(8,"button",1),h.NdJ("click",function(){return e.downloadDump()}),h.ALo(9,"async"),h.TgZ(10,"mat-icon"),h._uU(11,"file_download"),h.qZA(),h._uU(12," DOWNLOAD DUMP "),h.qZA(),h.TgZ(13,"button",2),h.NdJ("click",function(){return e.refresh()}),h.TgZ(14,"mat-icon"),h._uU(15,"refresh"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(16,"div",3),h.TgZ(17,"form",4),h.TgZ(18,"button",5),h.NdJ("click",function(){return e.goBackward()}),h._uU(19,"<"),h.qZA(),h.TgZ(20,"button",6),h.NdJ("click",function(){return e.jumpToNow()}),h._uU(21,"Now"),h.qZA(),h.TgZ(22,"button",7),h.NdJ("click",function(){return e.goForward()}),h._uU(23,">"),h.qZA(),h._uU(24," \xa0 "),h.TgZ(25,"button",8),h.NdJ("click",function(){return e.jumpTo()}),h._uU(26,"Jump to..."),h.qZA(),h._uU(27," \xa0\xa0\xa0\xa0 "),h.YNc(28,Yt,3,6,"label",9),h.qZA(),h.qZA(),h._UZ(29,"div",10,11),h.TgZ(31,"div",12),h.TgZ(32,"div",13),h.TgZ(33,"button",14),h.NdJ("click",function(){return e.zoomIn()}),h.TgZ(34,"mat-icon"),h._uU(35,"add"),h.qZA(),h.qZA(),h._UZ(36,"span",15),h.TgZ(37,"button",14),h.NdJ("click",function(){return e.zoomOut()}),h.TgZ(38,"mat-icon"),h._uU(39,"remove"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(40,"div",16),h.YNc(41,Ft,4,7,"span",17),h.ALo(42,"async"),h._uU(43," \xa0\xa0 "),h.TgZ(44,"app-help"),h.TgZ(45,"p"),h._uU(46,"This view allows inspecting the content of the TM Archive, as well as retrieving data as packets. Data is grouped by packet name in bands. For each band, index blocks indicate the presence of data at a particular time range. Note that a single index block does not necessarily mean that there was no gap in the data. When zooming in, more gaps may appear."),h.qZA(),h.TgZ(47,"p"),h._uU(48,"Pan around by grabbing the canvas."),h.qZA(),h.TgZ(49,"p"),h._uU(50,"Some actions require you to make a selection. To do so either select an index block or start a selection by clicking on the timescale band."),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(3),h.Q6J("disabled",!h.lcZ(4,5,e.rangeSelection$)),h.xp6(5),h.Q6J("disabled",!h.lcZ(9,7,e.rangeSelection$)),h.xp6(9),h.Q6J("formGroup",e.filterForm),h.xp6(11),h.Q6J("ngForOf",e.legendOptions),h.xp6(13),h.Q6J("ngIf",h.lcZ(42,9,e.viewportRange$)))},directives:[It.a,Ut.k,zt.lW,Lt.Hw,Wt.gM,d._Y,d.JL,d.sg,b.sg,b.O5,Pt.W,d.Wl,d.JJ,d.u],pipes:[b.Ov,Ht.i],styles:[".tooltip[_ngcontent-%COMP%]{position:absolute}.timeline-container[_ngcontent-%COMP%]{line-height:0;border-top:1px solid #d1d5da;position:absolute;top:36px;bottom:0;left:0;right:0}.zoom-actions[_ngcontent-%COMP%]{position:absolute;bottom:35px;left:201px;right:0;margin:0 auto;text-align:center}.zoom-actions-inner[_ngcontent-%COMP%]{display:inline-block;background-color:#fafafa}.zoom-actions[_ngcontent-%COMP%]   .mat-button[_ngcontent-%COMP%]{line-height:inherit;min-width:0}.info[_ngcontent-%COMP%]{position:absolute;bottom:35px;right:0;padding:0 16px;opacity:.75;font-size:small}label.legend[_ngcontent-%COMP%]{font-size:small;padding:3px 5px;margin-right:10px}"],changeDetection:0}),t})()}]}];let _t=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=h.oAB({type:t}),t.\u0275inj=h.cJS({imports:[[n.Bz.forChild(jt)],n.Bz]}),t})(),Rt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=h.oAB({type:t}),t.\u0275inj=h.cJS({imports:[[s.m,_t]]}),t})()}}]);