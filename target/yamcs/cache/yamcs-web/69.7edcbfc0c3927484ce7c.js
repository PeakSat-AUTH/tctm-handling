(self.webpackChunk_yamcs_webapp=self.webpackChunk_yamcs_webapp||[]).push([[69],{4069:(e,t,i)=>{"use strict";i.r(t),i.d(t,{FileTransferModule:()=>it});var n=i(7290),s=i(3337),a=i(7102),r=i(4017),c=i(9385),o=i(7340),l=i(8512),u=i(8293),p=i(6673),f=i(8569);class m{constructor(e,t){this.period=e,this.scheduler=t}call(e,t){return t.subscribe(new d(e,this.period,this.scheduler))}}class d extends p.L{constructor(e,t,i){super(e),this.period=t,this.scheduler=i,this.hasValue=!1,this.add(i.schedule(h,t,{subscriber:this,period:t}))}_next(e){this.lastValue=e,this.hasValue=!0}notifyNext(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))}}function h(e){let{subscriber:t,period:i}=e;t.notifyNext(),this.schedule(e,i)}var g=i(6238),b=i(9996),y=i(8720);class Z{constructor(e,t){this.transfer=e,this.objectUrl=t,this.originalTransfer$=new l.X(e),this.transfer$=this.originalTransfer$.pipe(function(e,t=f.P){return i=>i.lift(new m(e,t))}(500),(0,g.O)(e)),this.state$=this.originalTransfer$.pipe((0,b.U)(e=>e.state),(0,y.x)())}updateTransfer(e){this.transfer=e,this.originalTransfer$.next(e)}}var x=i(5366),v=i(6243),T=i(2420),w=i(1116),A=i(3357),C=i(2312),N=i(487),_=i(3116);function q(e,t){1&e&&(x.TgZ(0,"th",19),x._uU(1,"Started"),x.qZA())}function k(e,t){if(1&e&&(x.TgZ(0,"td",20),x._uU(1),x.ALo(2,"datetime"),x.qZA()),2&e){const e=t.$implicit;x.xp6(1),x.hij(" ",x.lcZ(2,1,e.transfer.startTime)," ")}}function S(e,t){1&e&&(x.TgZ(0,"th",19),x._uU(1,"Local file"),x.qZA())}function U(e,t){if(1&e&&(x.TgZ(0,"td",20),x.TgZ(1,"a",21),x._uU(2),x.qZA(),x.qZA()),2&e){const e=t.$implicit;x.xp6(1),x.Q6J("href",e.objectUrl,x.LSH),x.xp6(1),x.Oqu(e.transfer.objectName)}}function I(e,t){1&e&&(x.TgZ(0,"th",22),x._uU(1,"Direction"),x.qZA())}function O(e,t){1&e&&(x.ynx(0),x._uU(1,"\u27f5"),x.BQk())}function Q(e,t){1&e&&(x.ynx(0),x._uU(1,"\u27f6"),x.BQk())}function P(e,t){if(1&e&&(x.TgZ(0,"td",23),x.YNc(1,O,2,0,"ng-container",24),x.YNc(2,Q,2,0,"ng-container",24),x.qZA()),2&e){const e=t.$implicit;x.xp6(1),x.Q6J("ngIf","DOWNLOAD"===e.transfer.direction),x.xp6(1),x.Q6J("ngIf","UPLOAD"===e.transfer.direction)}}function B(e,t){1&e&&(x.TgZ(0,"th",19),x._uU(1,"Remote file"),x.qZA())}function J(e,t){if(1&e&&(x.TgZ(0,"td",20),x._uU(1),x.qZA()),2&e){const e=t.$implicit;x.xp6(1),x.Oqu(e.transfer.remotePath||"-")}}function F(e,t){1&e&&(x.TgZ(0,"th",25),x._uU(1,"Size"),x.qZA())}function $(e,t){if(1&e&&(x.TgZ(0,"td",20),x._uU(1),x.ALo(2,"formatBytes"),x.qZA()),2&e){const e=t.$implicit;x.xp6(1),x.Oqu(x.lcZ(2,1,e.transfer.totalSize))}}function Y(e,t){1&e&&(x.TgZ(0,"th",26),x._uU(1,"Status"),x.qZA())}function M(e,t){if(1&e&&(x.ynx(0),x._uU(1),x.ALo(2,"titlecase"),x.BQk()),2&e){const e=t.ngIf;x.xp6(1),x.hij(" ",x.lcZ(2,1,e)||"-"," ")}}function D(e,t){if(1&e&&(x.TgZ(0,"td",20),x.YNc(1,M,3,3,"ng-container",24),x.ALo(2,"async"),x.qZA()),2&e){const e=t.$implicit;x.xp6(1),x.Q6J("ngIf",x.lcZ(2,1,e.state$))}}function L(e,t){1&e&&x._UZ(0,"th",27)}function E(e,t){if(1&e){const e=x.EpF();x.TgZ(0,"app-text-action",31),x.NdJ("click",function(){x.CHM(e);const t=x.oxw(2).$implicit;return x.oxw().pauseTransfer(t)}),x._uU(1,"PAUSE"),x.qZA()}}function j(e,t){if(1&e){const e=x.EpF();x.TgZ(0,"app-text-action",32),x.NdJ("click",function(){x.CHM(e);const t=x.oxw(2).$implicit;return x.oxw().resumeTransfer(t)}),x._uU(1,"RESUME"),x.qZA()}}function R(e,t){if(1&e){const e=x.EpF();x.ynx(0),x.YNc(1,E,2,0,"app-text-action",28),x.YNc(2,j,2,0,"app-text-action",29),x.TgZ(3,"app-text-action",30),x.NdJ("click",function(){x.CHM(e);const t=x.oxw().$implicit;return x.oxw().cancelTransfer(t)}),x._uU(4,"CANCEL"),x.qZA(),x.BQk()}if(2&e){const e=t.ngIf;x.xp6(1),x.Q6J("ngIf","RUNNING"===e),x.xp6(1),x.Q6J("ngIf","PAUSED"===e)}}function H(e,t){if(1&e&&(x.TgZ(0,"td",20),x.YNc(1,R,5,2,"ng-container",24),x.ALo(2,"async"),x.qZA()),2&e){const e=t.$implicit;x.xp6(1),x.Q6J("ngIf",x.lcZ(2,1,e.state$))}}function G(e,t){if(1&e&&x._UZ(0,"mat-progress-bar",37),2&e){const e=x.oxw().ngIf,t=x.oxw(2);x.Q6J("value",100*t.transferPercent(e))}}function X(e,t){if(1&e&&(x.TgZ(0,"span",38),x._uU(1),x.qZA()),2&e){const e=x.oxw().ngIf;x.xp6(1),x.hij(" ",e.failureReason," ")}}function z(e,t){if(1&e&&(x.TgZ(0,"div",34),x._uU(1),x.ALo(2,"percent"),x.YNc(3,G,1,1,"mat-progress-bar",35),x.TgZ(4,"span"),x._uU(5),x.ALo(6,"formatBytes"),x.qZA(),x.YNc(7,X,2,1,"span",36),x.qZA()),2&e){const e=t.ngIf,i=x.oxw(2);x.xp6(1),x.hij(" ",x.xi3(2,4,i.transferPercent(e),"1.1")," "),x.xp6(2),x.Q6J("ngIf","RUNNING"===e.state||"PAUSED"===e.state||"CANCELLING"===e.state),x.xp6(2),x.Oqu(x.lcZ(6,7,e.sizeTransferred)),x.xp6(2),x.Q6J("ngIf",e.failureReason)}}function W(e,t){if(1&e&&(x.TgZ(0,"td",20),x.ALo(1,"async"),x.YNc(2,z,8,9,"div",33),x.ALo(3,"async"),x.qZA()),2&e){const e=t.$implicit,i=x.oxw();x.uIk("colspan",x.lcZ(1,2,i.displayedColumns$).length),x.xp6(2),x.Q6J("ngIf",x.lcZ(3,4,e.transfer$))}}function V(e,t){1&e&&x._UZ(0,"tr",39)}function K(e,t){1&e&&x._UZ(0,"tr",40),2&e&&x.ekj("nodetail","COMPLETED"===t.$implicit.transfer.state)}function ee(e,t){1&e&&x._UZ(0,"tr",41)}const te=function(){return["detail"]};let ie=(()=>{class e{constructor(e,t){this.yamcs=e,this.messageService=t,this.defaultColumns=["startTime","localFile","direction","remoteFile","size","status"],this.displayedColumns$=new l.X(this.defaultColumns),this.isIncomplete=(e,t)=>"COMPLETED"!==t.transfer.state,this.dataSource=new o.by,this.showActions=!1}ngOnChanges(){this.displayedColumns$.next(this.showActions?[...this.defaultColumns,"actions"]:this.defaultColumns)}transferPercent(e){return 0!=e.totalSize?e.sizeTransferred/e.totalSize:0}pauseTransfer(e){this.yamcs.yamcsClient.pauseFileTransfer(this.yamcs.instance,this.serviceName,e.transfer.id).catch(e=>{this.messageService.showError(e)})}resumeTransfer(e){this.yamcs.yamcsClient.resumeFileTransfer(this.yamcs.instance,this.serviceName,e.transfer.id).catch(e=>{this.messageService.showError(e)})}cancelTransfer(e){this.yamcs.yamcsClient.cancelFileTransfer(this.yamcs.instance,this.serviceName,e.transfer.id).catch(e=>{this.messageService.showError(e)})}}return e.\u0275fac=function(t){return new(t||e)(x.Y36(u.C),x.Y36(T.e))},e.\u0275cmp=x.Xpm({type:e,selectors:[["app-file-transfer-table"]],inputs:{serviceName:"serviceName",dataSource:"dataSource",showActions:"showActions"},features:[x.TTD],decls:29,vars:10,consts:[["mat-table","","multiTemplateDataRows","",1,"ya-data-table",3,"dataSource"],["matColumnDef","startTime"],["mat-header-cell","","style","width: 200px",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","localFile"],["matColumnDef","direction"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["mat-cell","","style","text-align: center",4,"matCellDef"],["matColumnDef","remoteFile"],["matColumnDef","size"],["mat-header-cell","","style","width: 70px",4,"matHeaderCellDef"],["matColumnDef","status"],["mat-header-cell","","style","width: 100px",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","detail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","item-row",3,"nodetail",4,"matRowDef","matRowDefColumns"],["mat-row","","class","item-detail",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["mat-header-cell","",2,"width","200px"],["mat-cell",""],["download","",3,"href"],["mat-header-cell","","width","1"],["mat-cell","",2,"text-align","center"],[4,"ngIf"],["mat-header-cell","",2,"width","70px"],["mat-header-cell","",2,"width","100px"],["mat-header-cell",""],["icon","pause_circle_outline",3,"click",4,"ngIf"],["icon","play_circle_outline",3,"click",4,"ngIf"],["icon","not_interested",3,"click"],["icon","pause_circle_outline",3,"click"],["icon","play_circle_outline",3,"click"],["class","detail-layout",4,"ngIf"],[1,"detail-layout"],["style","width: 200px",3,"value",4,"ngIf"],["class","error",4,"ngIf"],[2,"width","200px",3,"value"],[1,"error"],["mat-header-row",""],["mat-row","",1,"item-row"],["mat-row","",1,"item-detail"]],template:function(e,t){1&e&&(x.TgZ(0,"table",0),x.ynx(1,1),x.YNc(2,q,2,0,"th",2),x.YNc(3,k,3,3,"td",3),x.BQk(),x.ynx(4,4),x.YNc(5,S,2,0,"th",2),x.YNc(6,U,3,2,"td",3),x.BQk(),x.ynx(7,5),x.YNc(8,I,2,0,"th",6),x.YNc(9,P,3,2,"td",7),x.BQk(),x.ynx(10,8),x.YNc(11,B,2,0,"th",2),x.YNc(12,J,2,1,"td",3),x.BQk(),x.ynx(13,9),x.YNc(14,F,2,0,"th",10),x.YNc(15,$,3,3,"td",3),x.BQk(),x.ynx(16,11),x.YNc(17,Y,2,0,"th",12),x.YNc(18,D,3,3,"td",3),x.BQk(),x.ynx(19,13),x.YNc(20,L,1,0,"th",14),x.YNc(21,H,3,3,"td",3),x.BQk(),x.ynx(22,15),x.YNc(23,W,4,6,"td",3),x.BQk(),x.YNc(24,V,1,0,"tr",16),x.ALo(25,"async"),x.YNc(26,K,1,2,"tr",17),x.ALo(27,"async"),x.YNc(28,ee,1,0,"tr",18),x.qZA()),2&e&&(x.Q6J("dataSource",t.dataSource),x.xp6(24),x.Q6J("matHeaderRowDef",x.lcZ(25,5,t.displayedColumns$)),x.xp6(2),x.Q6J("matRowDefColumns",x.lcZ(27,7,t.displayedColumns$)),x.xp6(2),x.Q6J("matRowDefColumns",x.DdM(9,te))("matRowDefWhen",t.isIncomplete))},directives:[o.BZ,o.w1,o.fO,o.Dz,o.as,o.nj,o.ge,o.ev,w.O5,A.l,C.pW,o.XQ,o.Gk],pipes:[w.Ov,N.i,_.b,w.rS,w.Zx],styles:["tr.item-row[_ngcontent-%COMP%]:not(.nodetail)   td[_ngcontent-%COMP%]{border-bottom-width:0}tr.item-detail[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:40px!important}.detail-layout[_ngcontent-%COMP%]{display:flex;align-items:center}.detail-layout[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-left:20px}.error[_ngcontent-%COMP%]{color:#dc143c}"],changeDetection:0}),e})(),ne=(()=>{class e{constructor(e,t,i){this.yamcs=e,this.serviceName$=new l.X(null),this.dataSource=new o.by,this.transfersById=new Map,this.dirty=!1,this.storageClient=e.createStorageClient(),this.queryParamSubscription=t.queryParamMap.subscribe(e=>{const t=e.get("service");this.serviceName$.next(t),this.switchService(t)}),this.syncSubscription=i.sync(()=>{if(this.dirty){const e=[...this.transfersById.values()];e.sort((e,t)=>this.compareTransfers(e.transfer,t.transfer)),this.dataSource.data=e,this.dirty=!1}})}compareTransfers(e,t){return(t.creationTime||t.startTime||"").localeCompare(e.creationTime||e.startTime||"")}switchService(e){this.dirty=!1,this.transfersById.clear(),this.dataSource.data=[],this.transferSubscription&&this.transferSubscription.cancel(),e&&(this.transferSubscription=this.yamcs.yamcsClient.createTransferSubscription({instance:this.yamcs.instance,serviceName:e},e=>{switch(e.state){case"FAILED":this.setOrUpdate(e)}this.dirty=!0}))}setOrUpdate(e){let t=this.transfersById.get(e.id);if(t)t.updateTransfer(e);else{const i=this.storageClient.getObjectURL("_global",e.bucket,e.objectName);t=new Z(e,i),this.transfersById.set(e.id,t)}}ngOnDestroy(){this.syncSubscription&&this.syncSubscription.unsubscribe(),this.queryParamSubscription&&this.queryParamSubscription.unsubscribe(),this.transferSubscription&&this.transferSubscription.cancel()}}return e.\u0275fac=function(t){return new(t||e)(x.Y36(u.C),x.Y36(s.gz),x.Y36(v.j))},e.\u0275cmp=x.Xpm({type:e,selectors:[["ng-component"]],decls:3,vars:4,consts:[[1,"panel-content"],[3,"serviceName","dataSource"]],template:function(e,t){1&e&&(x.TgZ(0,"div",0),x._UZ(1,"app-file-transfer-table",1),x.ALo(2,"async"),x.qZA()),2&e&&(x.xp6(1),x.Q6J("serviceName",x.lcZ(2,2,t.serviceName$))("dataSource",t.dataSource))},directives:[ie],pipes:[w.Ov],encapsulation:2,changeDetection:0}),e})();var se=i(1041),ae=i(2935),re=i(989),ce=i(5722),oe=i(7112),le=i(2679),ue=i(3061),pe=i(7307);const fe=["selector"];function me(e,t){if(1&e){const e=x.EpF();x.TgZ(0,"app-breadcrumb",25),x.NdJ("click",function(){const t=x.CHM(e).$implicit;return x.oxw(2).changePrefix(t.prefix)}),x.qZA()}2&e&&x.Q6J("label",t.$implicit.name)("action",!0)}function de(e,t){if(1&e){const e=x.EpF();x.TgZ(0,"div",22),x.TgZ(1,"app-breadcrumb-trail"),x.TgZ(2,"app-breadcrumb",23),x.NdJ("click",function(){return x.CHM(e),x.oxw().changePrefix("")}),x.qZA(),x.YNc(3,me,1,2,"app-breadcrumb",24),x.qZA(),x.qZA()}if(2&e){const e=t.ngIf;x.xp6(2),x.Q6J("action",!0),x.xp6(1),x.Q6J("ngForOf",e)}}function he(e,t){if(1&e&&(x.TgZ(0,"td",26),x.TgZ(1,"mat-icon",27),x._uU(2,"shopping_basket"),x.qZA(),x._uU(3),x.qZA()),2&e){const e=t.$implicit;x.xp6(3),x.hij("\xa0 ",e.name," ")}}const ge=function(e){return{selected:e}};function be(e,t){if(1&e){const e=x.EpF();x.TgZ(0,"tr",28),x.NdJ("click",function(){const t=x.CHM(e).$implicit;return x.oxw().selectBucket(t)}),x.ALo(1,"async"),x.qZA()}if(2&e){const e=t.$implicit,i=x.oxw();x.Q6J("ngClass",x.VKq(3,ge,e===x.lcZ(1,1,i.selectedBucket$)))}}function ye(e,t){if(1&e){const e=x.EpF();x.ynx(0),x.TgZ(1,"app-object-selector",29,30),x.NdJ("prefixChange",function(t){return x.CHM(e),x.oxw().updateBreadcrumb(t)}),x.qZA(),x.BQk()}if(2&e){const e=t.ngIf;x.xp6(1),x.Q6J("bucket",e)("isMultiSelect",!1)("foldersOnly",!0)}}function Ze(e,t){1&e&&(x.ynx(0),x.TgZ(1,"label"),x._UZ(2,"input",31),x._uU(3," Reliable "),x.qZA(),x._UZ(4,"br"),x.BQk())}function xe(e,t){if(1&e&&(x.TgZ(0,"option",32),x._uU(1),x.qZA()),2&e){const e=t.$implicit;x.Q6J("value",e.name),x.xp6(1),x.AsE("",e.name," [id=",e.id,"]")}}function ve(e,t){if(1&e&&(x.TgZ(0,"option",32),x._uU(1),x.qZA()),2&e){const e=t.$implicit;x.Q6J("value",e.name),x.xp6(1),x.AsE("",e.name," [id=",e.id,"]")}}let Te=(()=>{class e{constructor(e,t,i,n){this.dialogRef=e,this.yamcs=t,this.data=n,this.dataSource=new o.by,this.displayedColumns=["name"],this.selectedBucket$=new l.X(null),this.breadcrumb$=new l.X([]),this.service=n.service;const s=this.service.localEntities.length?this.service.localEntities[0].name:"",a=this.service.remoteEntities.length?this.service.remoteEntities[0].name:"";this.storageClient=t.createStorageClient(),this.storageClient.getBuckets("_global").then(e=>{this.dataSource.data=e||[]}),this.localForm=i.group({object:["",[]]}),this.remoteForm=i.group({remotePath:["",se.kI.required],source:[s,se.kI.required],destination:[a,se.kI.required],reliable:[!0,[]]})}selectBucket(e){this.selectedBucket$.next(e)}startTransfer(){this.yamcs.yamcsClient.createFileTransfer(this.yamcs.instance,this.service.name,{direction:"DOWNLOAD",bucket:this.selectedBucket$.value.name,objectName:this.objectSelector.currentPrefix$.value||"",remotePath:this.remoteForm.value.remotePath,source:this.remoteForm.value.source,destination:this.remoteForm.value.destination,uploadOptions:{reliable:this.remoteForm.value.reliable}}).then(()=>{this.dialogRef.close()})}updateBreadcrumb(e){if(!e)return void this.breadcrumb$.next([]);e.endsWith("/")&&(e=e.substr(0,e.length-1));const t=[],i=e.split("/");for(let n=0;n<i.length;n++)t.push({name:i[n],prefix:i.slice(0,n+1).join("/")});this.breadcrumb$.next(t)}changePrefix(e){e&&(e+="/"),this.objectSelector.changePrefix(e)}}return e.\u0275fac=function(t){return new(t||e)(x.Y36(ae.so),x.Y36(u.C),x.Y36(se.qu),x.Y36(ae.WI))},e.\u0275cmp=x.Xpm({type:e,selectors:[["app-download-file-dialog"]],viewQuery:function(e,t){if(1&e&&x.Gf(fe,5),2&e){let e;x.iGM(e=x.CRH())&&(t.objectSelector=e.first)}},decls:45,vars:16,consts:[[1,"local-selector","mat-typography"],[1,"ya-form",3,"formGroup"],[1,"table-caption-wrapper"],[1,"table-caption"],["class","table-breadcrumb",4,"ngIf"],[1,"bucket-table-wrapper"],["mat-table","",1,"ya-data-table",3,"dataSource"],["cdkColumnDef","name"],["mat-cell","",4,"cdkCellDef"],["mat-row","",3,"ngClass","click",4,"cdkRowDef","cdkRowDefColumns"],[1,"object-table-wrapper"],[4,"ngIf"],[1,"remote-selector","mat-typography"],[2,"margin-top","16px"],["type","text","formControlName","remotePath","placeholder","Filename.dat"],[2,"margin-top","32px"],["formControlName","source"],[3,"value",4,"ngFor","ngForOf"],["formControlName","destination"],[1,"footer","mat-typography"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"],[1,"table-breadcrumb"],["icon","account_tree",3,"action","click"],[3,"label","action","click",4,"ngFor","ngForOf"],[3,"label","action","click"],["mat-cell",""],[2,"vertical-align","middle"],["mat-row","",3,"ngClass","click"],["formControlName","object",3,"bucket","isMultiSelect","foldersOnly","prefixChange"],["selector",""],["type","checkbox","formControlName","reliable"],[3,"value"]],template:function(e,t){1&e&&(x.TgZ(0,"div",0),x.TgZ(1,"form",1),x.TgZ(2,"h2"),x._uU(3,"Download File"),x.qZA(),x.TgZ(4,"div",2),x.TgZ(5,"label",3),x._uU(6,"Bucket"),x.qZA(),x.qZA(),x.YNc(7,de,4,2,"div",4),x.ALo(8,"async"),x.TgZ(9,"div",5),x.TgZ(10,"table",6),x.ynx(11,7),x.YNc(12,he,4,1,"td",8),x.BQk(),x.YNc(13,be,2,5,"tr",9),x.qZA(),x.qZA(),x.TgZ(14,"div",10),x.YNc(15,ye,3,3,"ng-container",11),x.ALo(16,"async"),x.qZA(),x.qZA(),x.qZA(),x.TgZ(17,"div",12),x.TgZ(18,"form",1),x.TgZ(19,"h2",13),x._uU(20,"Source File"),x.qZA(),x.TgZ(21,"label"),x._uU(22," Filename "),x._UZ(23,"input",14),x.qZA(),x.TgZ(24,"h2",15),x._uU(25,"Options"),x.qZA(),x.YNc(26,Ze,5,0,"ng-container",11),x.TgZ(27,"label"),x._uU(28," Local Entity "),x.TgZ(29,"select",16),x.YNc(30,xe,2,3,"option",17),x.qZA(),x.qZA(),x._UZ(31,"br"),x.TgZ(32,"label"),x._uU(33," Remote Entity "),x.TgZ(34,"select",18),x.YNc(35,ve,2,3,"option",17),x.qZA(),x.qZA(),x.qZA(),x.qZA(),x.TgZ(36,"div",19),x.TgZ(37,"mat-toolbar"),x.TgZ(38,"mat-toolbar-row"),x.TgZ(39,"button",20),x._uU(40,"CANCEL"),x.qZA(),x._uU(41,"\xa0\xa0 "),x.TgZ(42,"button",21),x.NdJ("click",function(){return t.startTransfer()}),x.ALo(43,"async"),x._uU(44,"DOWNLOAD"),x.qZA(),x.qZA(),x.qZA(),x.qZA()),2&e&&(x.xp6(1),x.Q6J("formGroup",t.localForm),x.xp6(6),x.Q6J("ngIf",x.lcZ(8,10,t.breadcrumb$)),x.xp6(3),x.Q6J("dataSource",t.dataSource),x.xp6(3),x.Q6J("cdkRowDefColumns",t.displayedColumns),x.xp6(2),x.Q6J("ngIf",x.lcZ(16,12,t.selectedBucket$)),x.xp6(3),x.Q6J("formGroup",t.remoteForm),x.xp6(8),x.Q6J("ngIf",t.service.capabilities.reliable),x.xp6(4),x.Q6J("ngForOf",t.service.localEntities),x.xp6(5),x.Q6J("ngForOf",t.service.remoteEntities),x.xp6(7),x.Q6J("disabled",!x.lcZ(43,14,t.selectedBucket$)||!t.remoteForm.valid))},directives:[se._Y,se.JL,se.sg,w.O5,o.BZ,ce.fo,ce.O_,ce.Sq,se.Fj,se.JJ,se.u,se.EJ,w.sg,oe.Ye,oe.rD,ae.ZT,le.w,ue.a,o.ev,pe.Hw,o.Gk,w.mk,re.O,se.Wl,se.YN,se.Kr],pipes:[w.Ov],styles:[".mat-dialog-container{border-radius:0;position:relative}table.ya-data-table[_ngcontent-%COMP%]{width:100%}.ya-data-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:none}.local-selector[_ngcontent-%COMP%], .remote-selector[_ngcontent-%COMP%]{position:relative;height:calc(50% - 32px)}.remote-selector[_ngcontent-%COMP%]{max-width:600px}.footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:64px;left:0;right:0;border-top:1px solid #d3d3d3}.bucket-table-wrapper[_ngcontent-%COMP%]{position:absolute;overflow:auto;border:1px solid #d3d3d3;top:68px;bottom:1em;left:0;width:250px}.bucket-table-wrapper[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{cursor:pointer}.object-table-wrapper[_ngcontent-%COMP%]{position:absolute;overflow:auto;border:1px solid #d3d3d3;top:68px;bottom:1em;right:0;left:calc(250px + 1em)}.table-caption-wrapper[_ngcontent-%COMP%]{position:absolute;top:48px;left:0}label.table-caption[_ngcontent-%COMP%]{margin:0}.table-breadcrumb[_ngcontent-%COMP%]{position:absolute;top:42px;left:calc(250px + 1em);right:0;overflow:hidden}"]}),e})();const we=["selector"];function Ae(e,t){if(1&e){const e=x.EpF();x.TgZ(0,"app-breadcrumb",23),x.NdJ("click",function(){const t=x.CHM(e).$implicit;return x.oxw(2).changePrefix(t.prefix)}),x.qZA()}2&e&&x.Q6J("label",t.$implicit.name)("action",!0)}function Ce(e,t){if(1&e){const e=x.EpF();x.TgZ(0,"div",20),x.TgZ(1,"app-breadcrumb-trail"),x.TgZ(2,"app-breadcrumb",21),x.NdJ("click",function(){return x.CHM(e),x.oxw().changePrefix("")}),x.qZA(),x.YNc(3,Ae,1,2,"app-breadcrumb",22),x.qZA(),x.qZA()}if(2&e){const e=t.ngIf;x.xp6(2),x.Q6J("action",!0),x.xp6(1),x.Q6J("ngForOf",e)}}function Ne(e,t){if(1&e&&(x.TgZ(0,"td",24),x.TgZ(1,"mat-icon",25),x._uU(2,"shopping_basket"),x.qZA(),x._uU(3),x.qZA()),2&e){const e=t.$implicit;x.xp6(3),x.hij("\xa0 ",e.name," ")}}const _e=function(e){return{selected:e}};function qe(e,t){if(1&e){const e=x.EpF();x.TgZ(0,"tr",26),x.NdJ("click",function(){const t=x.CHM(e).$implicit;return x.oxw().selectBucket(t)}),x.ALo(1,"async"),x.qZA()}if(2&e){const e=t.$implicit,i=x.oxw();x.Q6J("ngClass",x.VKq(3,_e,e===x.lcZ(1,1,i.selectedBucket$)))}}function ke(e,t){if(1&e){const e=x.EpF();x.ynx(0),x.TgZ(1,"app-object-selector",27,28),x.NdJ("prefixChange",function(t){return x.CHM(e),x.oxw().updateBreadcrumb(t)}),x.qZA(),x.BQk()}if(2&e){const e=t.ngIf;x.xp6(1),x.Q6J("bucket",e)("isMultiSelect",!0)}}function Se(e,t){1&e&&(x.ynx(0),x.TgZ(1,"h2",29),x._uU(2,"Destination File"),x.qZA(),x.TgZ(3,"label"),x._uU(4," Filename "),x._UZ(5,"input",30),x.qZA(),x.BQk())}function Ue(e,t){1&e&&(x.ynx(0),x.TgZ(1,"label"),x._UZ(2,"input",31),x._uU(3," Reliable "),x.qZA(),x._UZ(4,"br"),x.BQk())}function Ie(e,t){if(1&e&&(x.TgZ(0,"option",32),x._uU(1),x.qZA()),2&e){const e=t.$implicit;x.Q6J("value",e.name),x.xp6(1),x.AsE("",e.name," [id=",e.id,"]")}}function Oe(e,t){if(1&e&&(x.TgZ(0,"option",32),x._uU(1),x.qZA()),2&e){const e=t.$implicit;x.Q6J("value",e.name),x.xp6(1),x.AsE("",e.name," [id=",e.id,"]")}}let Qe=(()=>{class e{constructor(e,t,i,n,s){this.dialogRef=e,this.yamcs=t,this.messageService=n,this.data=s,this.dataSource=new o.by,this.displayedColumns=["name"],this.selectedBucket$=new l.X(null),this.breadcrumb$=new l.X([]),this.service=s.service;const a=this.service.localEntities.length?this.service.localEntities[0].name:"",r=this.service.remoteEntities.length?this.service.remoteEntities[0].name:"";this.storageClient=t.createStorageClient(),this.storageClient.getBuckets("_global").then(e=>{this.dataSource.data=e||[]}),this.localForm=i.group({object:["",se.kI.required]}),this.remoteForm=i.group({remotePath:["",this.service.capabilities.remotePath?se.kI.required:[]],source:[a,se.kI.required],destination:[r,se.kI.required],reliable:[!0,[]]})}selectBucket(e){this.selectedBucket$.next(e)}startTransfer(){return e=this,void 0,i=function*(){const e=this.localForm.value.object.split("|").map(e=>this.yamcs.yamcsClient.createFileTransfer(this.yamcs.instance,this.service.name,{direction:"UPLOAD",bucket:this.selectedBucket$.value.name,objectName:e,remotePath:this.remoteForm.value.remotePath,source:this.remoteForm.value.source,destination:this.remoteForm.value.destination,uploadOptions:{reliable:this.remoteForm.value.reliable}}));let t,i=0;for(const s of e)try{yield s}catch(n){t=n,i++}t&&this.messageService.showError(1===i?t:i===e.length?"Failed to start any of the selected transfers. See server log.":"Some of the transfers failed to start. See server log."),this.dialogRef.close()},new((t=void 0)||(t=Promise))(function(n,s){function a(e){try{c(i.next(e))}catch(t){s(t)}}function r(e){try{c(i.throw(e))}catch(t){s(t)}}function c(e){var i;e.done?n(e.value):(i=e.value,i instanceof t?i:new t(function(e){e(i)})).then(a,r)}c((i=i.apply(e,[])).next())});var e,t,i}updateBreadcrumb(e){if(!e)return void this.breadcrumb$.next([]);e.endsWith("/")&&(e=e.substr(0,e.length-1));const t=[],i=e.split("/");for(let n=0;n<i.length;n++)t.push({name:i[n],prefix:i.slice(0,n+1).join("/")});this.breadcrumb$.next(t)}changePrefix(e){e&&(e+="/"),this.objectSelector.changePrefix(e)}}return e.\u0275fac=function(t){return new(t||e)(x.Y36(ae.so),x.Y36(u.C),x.Y36(se.qu),x.Y36(T.e),x.Y36(ae.WI))},e.\u0275cmp=x.Xpm({type:e,selectors:[["app-upload-file-dialog"]],viewQuery:function(e,t){if(1&e&&x.Gf(we,5),2&e){let e;x.iGM(e=x.CRH())&&(t.objectSelector=e.first)}},decls:40,vars:15,consts:[[1,"local-selector","mat-typography"],[1,"ya-form",3,"formGroup"],[1,"table-caption-wrapper"],[1,"table-caption"],["class","table-breadcrumb",4,"ngIf"],[1,"bucket-table-wrapper"],["mat-table","",1,"ya-data-table",3,"dataSource"],["cdkColumnDef","name"],["mat-cell","",4,"cdkCellDef"],["mat-row","",3,"ngClass","click",4,"cdkRowDef","cdkRowDefColumns"],[1,"object-table-wrapper"],[4,"ngIf"],[1,"remote-selector","mat-typography"],[2,"margin-top","32px"],["formControlName","source"],[3,"value",4,"ngFor","ngForOf"],["formControlName","destination"],[1,"footer","mat-typography"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"],[1,"table-breadcrumb"],["icon","account_tree",3,"action","click"],[3,"label","action","click",4,"ngFor","ngForOf"],[3,"label","action","click"],["mat-cell",""],[2,"vertical-align","middle"],["mat-row","",3,"ngClass","click"],["formControlName","object",3,"bucket","isMultiSelect","prefixChange"],["selector",""],[2,"margin-top","16px"],["type","text","formControlName","remotePath","placeholder","/CF:/filename"],["type","checkbox","formControlName","reliable"],[3,"value"]],template:function(e,t){1&e&&(x.TgZ(0,"div",0),x.TgZ(1,"form",1),x.TgZ(2,"h2"),x._uU(3,"Upload File"),x.qZA(),x.TgZ(4,"div",2),x.TgZ(5,"label",3),x._uU(6,"Bucket"),x.qZA(),x.qZA(),x.YNc(7,Ce,4,2,"div",4),x.ALo(8,"async"),x.TgZ(9,"div",5),x.TgZ(10,"table",6),x.ynx(11,7),x.YNc(12,Ne,4,1,"td",8),x.BQk(),x.YNc(13,qe,2,5,"tr",9),x.qZA(),x.qZA(),x.TgZ(14,"div",10),x.YNc(15,ke,3,2,"ng-container",11),x.ALo(16,"async"),x.qZA(),x.qZA(),x.qZA(),x.TgZ(17,"div",12),x.TgZ(18,"form",1),x.YNc(19,Se,6,0,"ng-container",11),x.TgZ(20,"h2",13),x._uU(21,"Options"),x.qZA(),x.YNc(22,Ue,5,0,"ng-container",11),x.TgZ(23,"label"),x._uU(24," Local Entity "),x.TgZ(25,"select",14),x.YNc(26,Ie,2,3,"option",15),x.qZA(),x.qZA(),x._UZ(27,"br"),x.TgZ(28,"label"),x._uU(29," Remote Entity "),x.TgZ(30,"select",16),x.YNc(31,Oe,2,3,"option",15),x.qZA(),x.qZA(),x.qZA(),x.qZA(),x.TgZ(32,"div",17),x.TgZ(33,"mat-toolbar"),x.TgZ(34,"mat-toolbar-row"),x.TgZ(35,"button",18),x._uU(36,"CANCEL"),x.qZA(),x._uU(37,"\xa0\xa0 "),x.TgZ(38,"button",19),x.NdJ("click",function(){return t.startTransfer()}),x._uU(39,"UPLOAD"),x.qZA(),x.qZA(),x.qZA(),x.qZA()),2&e&&(x.xp6(1),x.Q6J("formGroup",t.localForm),x.xp6(6),x.Q6J("ngIf",x.lcZ(8,11,t.breadcrumb$)),x.xp6(3),x.Q6J("dataSource",t.dataSource),x.xp6(3),x.Q6J("cdkRowDefColumns",t.displayedColumns),x.xp6(2),x.Q6J("ngIf",x.lcZ(16,13,t.selectedBucket$)),x.xp6(3),x.Q6J("formGroup",t.remoteForm),x.xp6(1),x.Q6J("ngIf",t.service.capabilities.remotePath),x.xp6(3),x.Q6J("ngIf",t.service.capabilities.reliable),x.xp6(4),x.Q6J("ngForOf",t.service.localEntities),x.xp6(5),x.Q6J("ngForOf",t.service.remoteEntities),x.xp6(7),x.Q6J("disabled",!t.localForm.valid||!t.remoteForm.valid))},directives:[se._Y,se.JL,se.sg,w.O5,o.BZ,ce.fo,ce.O_,ce.Sq,se.EJ,se.JJ,se.u,w.sg,oe.Ye,oe.rD,ae.ZT,le.w,ue.a,o.ev,pe.Hw,o.Gk,w.mk,re.O,se.Fj,se.Wl,se.YN,se.Kr],pipes:[w.Ov],styles:[".mat-dialog-container{border-radius:0;position:relative}table.ya-data-table[_ngcontent-%COMP%]{width:100%}.ya-data-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:none}.local-selector[_ngcontent-%COMP%], .remote-selector[_ngcontent-%COMP%]{position:relative;height:calc(50% - 32px)}.remote-selector[_ngcontent-%COMP%]{max-width:600px}.footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:64px;left:0;right:0;border-top:1px solid #d3d3d3}.bucket-table-wrapper[_ngcontent-%COMP%]{position:absolute;overflow:auto;border:1px solid #d3d3d3;top:68px;bottom:1em;left:0;width:250px}.bucket-table-wrapper[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{cursor:pointer}.object-table-wrapper[_ngcontent-%COMP%]{position:absolute;overflow:auto;border:1px solid #d3d3d3;top:68px;bottom:1em;right:0;left:calc(250px + 1em)}.table-caption-wrapper[_ngcontent-%COMP%]{position:absolute;top:48px;left:0}label.table-caption[_ngcontent-%COMP%]{margin:0}.table-breadcrumb[_ngcontent-%COMP%]{position:absolute;top:42px;left:calc(250px + 1em);right:0;overflow:hidden}"]}),e})();var Pe=i(9624),Be=i(9451),Je=i(6972),Fe=i(4369),$e=i(7070),Ye=i(7173),Me=i(4626);function De(e,t){if(1&e){const e=x.EpF();x.TgZ(0,"button",6),x.NdJ("click",function(){const t=x.CHM(e).$implicit;return x.oxw(2).switchService(t)}),x._uU(1),x.qZA()}if(2&e){const e=t.$implicit;x.xp6(1),x.Oqu(e.name)}}function Le(e,t){if(1&e&&(x.ynx(0),x.TgZ(1,"button",2),x._uU(2),x.ALo(3,"async"),x.TgZ(4,"mat-icon"),x._uU(5,"arrow_drop_down"),x.qZA(),x.qZA(),x.TgZ(6,"mat-menu",3,4),x.YNc(8,De,2,1,"button",5),x.qZA(),x.BQk()),2&e){const e=t.ngIf,i=x.MAs(7),n=x.oxw();let s;x.xp6(1),x.Q6J("matMenuTriggerFor",i),x.xp6(1),x.hij(" ",(null==(s=x.lcZ(3,3,n.service$))?null:s.name)||"select service"," "),x.xp6(6),x.Q6J("ngForOf",e)}}function Ee(e,t){if(1&e){const e=x.EpF();x.ynx(0),x.TgZ(1,"button",7),x.NdJ("click",function(){x.CHM(e);const t=x.oxw().ngIf;return x.oxw().uploadFile(t)}),x.TgZ(2,"mat-icon"),x._uU(3,"cloud_upload"),x.qZA(),x._uU(4," UPLOAD FILE "),x.qZA(),x.BQk()}}function je(e,t){if(1&e&&(x.ynx(0),x.YNc(1,Ee,5,0,"ng-container",0),x.BQk()),2&e){const e=t.ngIf;x.xp6(1),x.Q6J("ngIf",e.capabilities.upload)}}function Re(e,t){if(1&e){const e=x.EpF();x.ynx(0),x.TgZ(1,"button",7),x.NdJ("click",function(){x.CHM(e);const t=x.oxw().ngIf;return x.oxw().downloadFile(t)}),x.TgZ(2,"mat-icon"),x._uU(3,"cloud_download"),x.qZA(),x._uU(4," DOWNLOAD FILE "),x.qZA(),x.BQk()}}function He(e,t){if(1&e&&(x.ynx(0),x.YNc(1,Re,5,0,"ng-container",0),x.BQk()),2&e){const e=t.ngIf;x.xp6(1),x.Q6J("ngIf",e.capabilities.download)}}function Ge(e,t){if(1&e&&(x.ynx(0),x._uU(1),x.BQk()),2&e){const e=t.ngIf;x.xp6(1),x.hij("(",e,")")}}function Xe(e,t){if(1&e&&(x.ynx(0),x._uU(1),x.BQk()),2&e){const e=t.ngIf;x.xp6(1),x.hij("(",e,")")}}function ze(e,t){if(1&e&&(x.ynx(0),x._uU(1),x.BQk()),2&e){const e=t.ngIf;x.xp6(1),x.hij("(",e,")")}}const We=function(e,t){return{c:e,service:t}};function Ve(e,t){if(1&e&&(x.ynx(0),x.TgZ(1,"nav",8),x.TgZ(2,"a",9,10),x._uU(4," ONGOING "),x.YNc(5,Ge,2,1,"ng-container",0),x.ALo(6,"async"),x.qZA(),x.TgZ(7,"a",11,12),x._uU(9," FAILED "),x.YNc(10,Xe,2,1,"ng-container",0),x.ALo(11,"async"),x.qZA(),x.TgZ(12,"a",13,14),x._uU(14," SUCCESSFUL "),x.YNc(15,ze,2,1,"ng-container",0),x.ALo(16,"async"),x.qZA(),x.qZA(),x.TgZ(17,"div",15),x._UZ(18,"router-outlet"),x.qZA(),x.BQk()),2&e){const e=t.ngIf,i=x.MAs(3),n=x.MAs(8),s=x.MAs(13),a=x.oxw();x.xp6(2),x.Q6J("queryParams",x.WLB(15,We,a.yamcs.context,e.name))("active",i.isActive),x.xp6(3),x.Q6J("ngIf",x.lcZ(6,9,a.ongoingCount$)),x.xp6(2),x.Q6J("queryParams",x.WLB(18,We,a.yamcs.context,e.name))("active",n.isActive),x.xp6(3),x.Q6J("ngIf",x.lcZ(11,11,a.failedCount$)),x.xp6(2),x.Q6J("queryParams",x.WLB(21,We,a.yamcs.context,e.name))("active",s.isActive),x.xp6(3),x.Q6J("ngIf",x.lcZ(16,13,a.successfulCount$))}}function Ke(e,t){1&e&&(x.TgZ(0,"app-empty-message",16),x.TgZ(1,"p"),x._uU(2," This instance has no file transfer services configured. "),x.qZA(),x.qZA())}const et=[{path:"",canActivate:[r.a,a.z],canActivateChild:[r.a],runGuardsAndResolvers:"always",component:c.K,children:[{path:"",component:(()=>{class e{constructor(e,t,i,n,s,a){this.yamcs=e,this.dialog=i,this.route=n,this.router=s,this.services$=new l.X([]),this.service$=new l.X(null),this.ongoingTransfersById=new Map,this.failedTransfersById=new Map,this.successfulTransfersById=new Map,this.ongoingCount$=new l.X(0),this.failedCount$=new l.X(0),this.successfulCount$=new l.X(0),this.dirty=!1,t.setTitle("File Transfer");const r=n.snapshot.queryParamMap.get("service");e.yamcsClient.getFileTransferServices(e.instance).then(e=>{this.services$.next(e.services);let t=null;for(const i of e.services)if(r===i.name){t=i;break}t||r||(t=e.services.length?e.services[0]:null),t&&this.switchService(t)}),this.syncSubscription=a.sync(()=>{this.dirty&&(this.ongoingCount$.next(this.ongoingTransfersById.size),this.failedCount$.next(this.failedTransfersById.size),this.successfulCount$.next(this.successfulTransfersById.size))})}switchService(e){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{service:(null==e?void 0:e.name)||null},queryParamsHandling:"merge"}),this.ongoingCount$.next(0),this.failedCount$.next(0),this.successfulCount$.next(0),this.ongoingTransfersById.clear(),this.failedTransfersById.clear(),this.successfulTransfersById.clear(),this.transferSubscription&&this.transferSubscription.cancel(),this.service$.next(e),e&&(this.transferSubscription=this.yamcs.yamcsClient.createTransferSubscription({instance:this.yamcs.instance,serviceName:e.name},e=>{switch(e.state){case"RUNNING":case"PAUSED":case"CANCELLING":case"QUEUED":this.ongoingTransfersById.set(e.id,e);break;case"FAILED":this.ongoingTransfersById.delete(e.id),this.failedTransfersById.set(e.id,e);break;case"COMPLETED":this.ongoingTransfersById.delete(e.id),this.successfulTransfersById.set(e.id,e)}this.dirty=!0}))}uploadFile(e){this.dialog.open(Qe,{width:"70%",height:"100%",autoFocus:!1,position:{right:"0"},data:{service:e}})}downloadFile(e){this.dialog.open(Te,{width:"70%",height:"100%",autoFocus:!1,position:{right:"0"},data:{service:e}})}ngOnDestroy(){this.syncSubscription&&this.syncSubscription.unsubscribe(),this.transferSubscription&&this.transferSubscription.cancel()}}return e.\u0275fac=function(t){return new(t||e)(x.Y36(u.C),x.Y36(Pe.Dx),x.Y36(ae.uw),x.Y36(s.gz),x.Y36(s.F0),x.Y36(v.j))},e.\u0275cmp=x.Xpm({type:e,selectors:[["ng-component"]],decls:13,vars:15,consts:[[4,"ngIf"],["headerTitle","File Transfer",4,"ngIf"],["mat-button","",3,"matMenuTriggerFor"],[1,"ya-menu"],["serviceMenu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"click"],["mat-button","","color","primary",3,"click"],["mat-tab-nav-bar",""],["mat-tab-link","","routerLink","./ongoing-transfers","routerLinkActive","",3,"queryParams","active"],["rla","routerLinkActive"],["mat-tab-link","","routerLink","./failed-transfers","routerLinkActive","",3,"queryParams","active"],["rlb","routerLinkActive"],["mat-tab-link","","routerLink","./successful-transfers","routerLinkActive","",3,"queryParams","active"],["rlc","routerLinkActive"],[1,"outlet-wrapper"],["headerTitle","File Transfer"]],template:function(e,t){1&e&&(x.TgZ(0,"app-instance-page"),x.TgZ(1,"app-instance-toolbar"),x._uU(2," File Transfer \xa0\xa0\xa0\xa0 "),x.YNc(3,Le,9,5,"ng-container",0),x.ALo(4,"async"),x.YNc(5,je,2,1,"ng-container",0),x.ALo(6,"async"),x.YNc(7,He,2,1,"ng-container",0),x.ALo(8,"async"),x.qZA(),x.YNc(9,Ve,19,24,"ng-container",0),x.ALo(10,"async"),x.YNc(11,Ke,3,0,"app-empty-message",1),x.ALo(12,"async"),x.qZA()),2&e&&(x.xp6(3),x.Q6J("ngIf",x.lcZ(4,5,t.services$)),x.xp6(2),x.Q6J("ngIf",x.lcZ(6,7,t.service$)),x.xp6(2),x.Q6J("ngIf",x.lcZ(8,9,t.service$)),x.xp6(2),x.Q6J("ngIf",x.lcZ(10,11,t.service$)),x.xp6(2),x.Q6J("ngIf",!x.lcZ(12,13,t.services$).length))},directives:[Be.a,Je.k,w.O5,Fe.lW,$e.p6,pe.Hw,$e.VK,w.sg,$e.OP,Ye.BU,s.yS,Ye.Nj,s.Od,s.lC,Me.M],pipes:[w.Ov],styles:[".outlet-wrapper[_ngcontent-%COMP%]{overflow:auto;position:absolute;top:49px;bottom:0;left:0;right:0}"],changeDetection:0}),e})(),children:[{path:"",pathMatch:"full",redirectTo:"ongoing-transfers"},{path:"ongoing-transfers",component:(()=>{class e{constructor(e,t,i){this.yamcs=e,this.serviceName$=new l.X(null),this.dataSource=new o.by,this.transfersById=new Map,this.dirty=!1,this.storageClient=e.createStorageClient(),this.queryParamSubscription=t.queryParamMap.subscribe(e=>{const t=e.get("service");this.serviceName$.next(t),this.switchService(t)}),this.syncSubscription=i.sync(()=>{if(this.dirty){const e=[...this.transfersById.values()];e.sort((e,t)=>this.compareTransfers(e.transfer,t.transfer)),this.dataSource.data=e,this.dirty=!1}})}compareTransfers(e,t){if(e.state!=t.state){if("RUNNING"==e.state)return-1;if("RUNNING"==t.state)return 1}return(t.creationTime||t.startTime||"").localeCompare(e.creationTime||e.startTime||"")}switchService(e){this.dirty=!1,this.transfersById.clear(),this.dataSource.data=[],this.transferSubscription&&this.transferSubscription.cancel(),e&&(this.transferSubscription=this.yamcs.yamcsClient.createTransferSubscription({instance:this.yamcs.instance,serviceName:e},e=>{switch(e.state){case"RUNNING":case"PAUSED":case"CANCELLING":case"QUEUED":this.setOrUpdate(e);break;case"FAILED":case"COMPLETED":this.transfersById.delete(e.id)}this.dirty=!0}))}setOrUpdate(e){let t=this.transfersById.get(e.id);if(t)t.updateTransfer(e);else{const i=this.storageClient.getObjectURL("_global",e.bucket,e.objectName);t=new Z(e,i),this.transfersById.set(e.id,t)}}ngOnDestroy(){this.syncSubscription&&this.syncSubscription.unsubscribe(),this.queryParamSubscription&&this.queryParamSubscription.unsubscribe(),this.transferSubscription&&this.transferSubscription.cancel()}}return e.\u0275fac=function(t){return new(t||e)(x.Y36(u.C),x.Y36(s.gz),x.Y36(v.j))},e.\u0275cmp=x.Xpm({type:e,selectors:[["ng-component"]],decls:3,vars:5,consts:[[1,"panel-content"],[3,"serviceName","dataSource","showActions"]],template:function(e,t){1&e&&(x.TgZ(0,"div",0),x._UZ(1,"app-file-transfer-table",1),x.ALo(2,"async"),x.qZA()),2&e&&(x.xp6(1),x.Q6J("serviceName",x.lcZ(2,3,t.serviceName$))("dataSource",t.dataSource)("showActions",!0))},directives:[ie],pipes:[w.Ov],encapsulation:2,changeDetection:0}),e})()},{path:"failed-transfers",component:ne},{path:"successful-transfers",component:(()=>{class e{constructor(e,t,i){this.yamcs=e,this.serviceName$=new l.X(null),this.dataSource=new o.by,this.transfersById=new Map,this.dirty=!1,this.storageClient=e.createStorageClient(),this.queryParamSubscription=t.queryParamMap.subscribe(e=>{const t=e.get("service");this.serviceName$.next(t),this.switchService(t)}),this.syncSubscription=i.sync(()=>{if(this.dirty){const e=[...this.transfersById.values()];e.sort((e,t)=>this.compareTransfers(e.transfer,t.transfer)),this.dataSource.data=e,this.dirty=!1}})}compareTransfers(e,t){return(t.creationTime||t.startTime||"").localeCompare(e.creationTime||e.startTime||"")}switchService(e){this.dirty=!1,this.transfersById.clear(),this.dataSource.data=[],this.transferSubscription&&this.transferSubscription.cancel(),e&&(this.transferSubscription=this.yamcs.yamcsClient.createTransferSubscription({instance:this.yamcs.instance,serviceName:e},e=>{switch(e.state){case"COMPLETED":this.setOrUpdate(e)}this.dirty=!0}))}setOrUpdate(e){let t=this.transfersById.get(e.id);if(t)t.updateTransfer(e);else{const i=this.storageClient.getObjectURL("_global",e.bucket,e.objectName);t=new Z(e,i),this.transfersById.set(e.id,t)}}ngOnDestroy(){this.syncSubscription&&this.syncSubscription.unsubscribe(),this.queryParamSubscription&&this.queryParamSubscription.unsubscribe(),this.transferSubscription&&this.transferSubscription.cancel()}}return e.\u0275fac=function(t){return new(t||e)(x.Y36(u.C),x.Y36(s.gz),x.Y36(v.j))},e.\u0275cmp=x.Xpm({type:e,selectors:[["ng-component"]],decls:3,vars:4,consts:[[1,"panel-content"],[3,"serviceName","dataSource"]],template:function(e,t){1&e&&(x.TgZ(0,"div",0),x._UZ(1,"app-file-transfer-table",1),x.ALo(2,"async"),x.qZA()),2&e&&(x.xp6(1),x.Q6J("serviceName",x.lcZ(2,2,t.serviceName$))("dataSource",t.dataSource))},directives:[ie],pipes:[w.Ov],encapsulation:2,changeDetection:0}),e})()}]}]}];let tt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=x.oAB({type:e}),e.\u0275inj=x.cJS({imports:[[s.Bz.forChild(et)],s.Bz]}),e})(),it=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=x.oAB({type:e}),e.\u0275inj=x.cJS({imports:[[n.m,tt]]}),e})()}}]);