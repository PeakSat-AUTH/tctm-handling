(self.webpackChunk_yamcs_webapp=self.webpackChunk_yamcs_webapp||[]).push([[751],{3751:(t,e,n)=>{"use strict";n.r(e),n.d(e,{StorageModule:()=>Ht});var a=n(7290),o=n(3337),i=n(4017),c=n(7187),s=n(8378),r=n(7340),l=n(8512),u=n(3835),d=n(8293),p=n(1641),h=n(1041),g=n(2935),m=n(5366),f=n(1576);let b=(()=>{class t{constructor(t,e,n,a,o){this.dialogRef=t,this.data=o,this.storageClient=n.createStorageClient(),this.bucketInstance=this.data.bucketInstance;const i=a.transform(this.data.name);this.filenameForm=e.group({name:[i,[h.kI.required]]})}rename(){return t=this,void 0,n=function*(){let t;const e=this.data.name.lastIndexOf("/");-1!==e&&(t=this.data.name.substring(0,e+1));const n=yield this.storageClient.getObject(this.bucketInstance,this.data.bucket,this.data.name),a=yield n.blob(),o=(t||"")+this.filenameForm.get("name").value;yield this.storageClient.uploadObject(this.bucketInstance,this.data.bucket,o,a),yield this.storageClient.deleteObject(this.bucketInstance,this.data.bucket,this.data.name),this.dialogRef.close(o)},new((e=void 0)||(e=Promise))(function(a,o){function i(t){try{s(n.next(t))}catch(e){o(e)}}function c(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var n;t.done?a(t.value):(n=t.value,n instanceof e?n:new e(function(t){t(n)})).then(i,c)}s((n=n.apply(t,[])).next())});var t,e,n}}return t.\u0275fac=function(e){return new(e||t)(m.Y36(g.so),m.Y36(h.qu),m.Y36(d.C),m.Y36(f.X),m.Y36(g.WI))},t.\u0275cmp=m.Xpm({type:t,selectors:[["app-rename-object-dialog"]],decls:13,vars:4,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["type","text","formControlName","name"],["filename",""],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"]],template:function(t,e){if(1&t&&(m.TgZ(0,"h2",0),m._uU(1,"Rename file"),m.qZA(),m.TgZ(2,"mat-dialog-content",1),m.TgZ(3,"form",2),m.TgZ(4,"label"),m._uU(5," Name "),m._UZ(6,"input",3,4),m.qZA(),m.qZA(),m.qZA(),m.TgZ(8,"mat-dialog-actions",5),m.TgZ(9,"button",6),m._uU(10,"CANCEL"),m.qZA(),m.TgZ(11,"button",7),m.NdJ("click",function(){return e.rename()}),m._uU(12,"RENAME"),m.qZA(),m.qZA()),2&t){let t;m.xp6(3),m.Q6J("formGroup",e.filenameForm),m.xp6(1),m.ekj("invalid",null==(t=e.filenameForm.get("name"))?null:t.invalid),m.xp6(7),m.Q6J("disabled",!e.filenameForm.valid)}},directives:[g.uh,g.xY,h._Y,h.JL,h.sg,h.Fj,h.JJ,h.u,g.H8,g.ZT],encapsulation:2}),t})();const Z=["files"];let x=(()=>{class t{constructor(t,e,n,a){this.dialogRef=t,this.data=a,this.storageClient=n.createStorageClient(),this.formGroup=e.group({path:[a.path,h.kI.required],files:[null,h.kI.required]})}save(){let t=this.formGroup.get("path").value.trim();t.startsWith("/")&&(t=t.substring(1)),t.endsWith("/")&&(t=t.substring(0,t.length-1));const e=this.filesInput.nativeElement.files,n=[];for(const a in e)if(!isNaN(parseInt(a,10))){const o=e[a],i=this.storageClient.uploadObject(this.data.bucketInstance,this.data.bucket,t?t+"/"+o.name:o.name,o);n.push({filename:o.name,promise:i})}this.dialogRef.close(n)}}return t.\u0275fac=function(e){return new(e||t)(m.Y36(g.so),m.Y36(h.qu),m.Y36(d.C),m.Y36(g.WI))},t.\u0275cmp=m.Xpm({type:t,selectors:[["app-upload-objects-dialog"]],viewQuery:function(t,e){if(1&t&&m.Gf(Z,7),2&t){let t;m.iGM(t=m.CRH())&&(e.filesInput=t.first)}},decls:18,vars:1,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["type","file","formControlName","files","multiple",""],["files",""],["type","text","formControlName","path"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"click"]],template:function(t,e){1&t&&(m.TgZ(0,"h2",0),m._uU(1,"Upload files"),m.qZA(),m.TgZ(2,"mat-dialog-content",1),m.TgZ(3,"form",2),m.TgZ(4,"label"),m._uU(5," Files"),m._UZ(6,"br"),m._UZ(7,"input",3,4),m.qZA(),m._UZ(9,"br"),m.TgZ(10,"label"),m._uU(11," Path "),m._UZ(12,"input",5),m.qZA(),m.qZA(),m.qZA(),m.TgZ(13,"mat-dialog-actions",6),m.TgZ(14,"button",7),m._uU(15,"CANCEL"),m.qZA(),m.TgZ(16,"button",8),m.NdJ("click",function(){return e.save()}),m._uU(17,"UPLOAD"),m.qZA(),m.qZA()),2&t&&(m.xp6(3),m.Q6J("formGroup",e.formGroup))},directives:[g.uh,g.xY,h._Y,h.JL,h.sg,h.Fj,h.JJ,h.u,g.H8,g.ZT],encapsulation:2}),t})();var k=n(7701),A=n(4369),w=n(7307),y=n(1116),C=n(4311),v=n(2312);const T=["tableWrapper"];function q(t,e){1&t&&(m.ynx(0),m._uU(1," Finished "),m.BQk())}function _(t,e){if(1&t&&(m.ynx(0),m.TgZ(1,"mat-icon",11),m._uU(2,"error"),m.qZA(),m._uU(3," Failed "),m.BQk()),2&t){const t=m.oxw().$implicit;m.xp6(1),m.Q6J("matTooltip",t.err)}}function U(t,e){1&t&&m._UZ(0,"mat-progress-bar",12)}function O(t,e){if(1&t&&(m.TgZ(0,"tr"),m.TgZ(1,"td"),m._uU(2),m.qZA(),m.TgZ(3,"td",8),m.YNc(4,q,2,0,"ng-container",9),m.YNc(5,_,4,1,"ng-container",9),m.YNc(6,U,1,0,"mat-progress-bar",10),m.qZA(),m.qZA()),2&t){const t=e.$implicit;m.ekj("failed",t.err),m.xp6(2),m.Oqu(t.filename),m.xp6(2),m.Q6J("ngIf",t.complete&&!t.err),m.xp6(1),m.Q6J("ngIf",t.complete&&t.err),m.xp6(1),m.Q6J("ngIf",!t.complete)}}let D=(()=>{class t{constructor(t,e){this.data=e,this.uploads$=e.uploads$.pipe((0,k.b)(500))}}return t.\u0275fac=function(e){return new(e||t)(m.Y36(g.so),m.Y36(g.WI))},t.\u0275cmp=m.Xpm({type:t,selectors:[["app-upload-progress-dialog"]],viewQuery:function(t,e){if(1&t&&m.Gf(T,7),2&t){let t;m.iGM(t=m.CRH())&&(e.tableWrapper=t.first)}},decls:12,vars:3,consts:[["mat-dialog-title",""],[2,"float","right"],["mat-icon-button","","mat-dialog-close",""],[1,"mat-typography"],[1,"table-wrapper"],["tableWrapper",""],[2,"font-size","small","width","100%"],[3,"failed",4,"ngFor","ngForOf"],[2,"width","100px","text-align","center"],[4,"ngIf"],["mode","buffer",4,"ngIf"],[1,"icon14",2,"vertical-align","middle",3,"matTooltip"],["mode","buffer"]],template:function(t,e){1&t&&(m.TgZ(0,"h3",0),m.TgZ(1,"div",1),m.TgZ(2,"button",2),m.TgZ(3,"mat-icon"),m._uU(4,"close"),m.qZA(),m.qZA(),m.qZA(),m._uU(5," Uploads\n"),m.qZA(),m.TgZ(6,"mat-dialog-content",3),m.TgZ(7,"div",4,5),m.TgZ(9,"table",6),m.YNc(10,O,7,6,"tr",7),m.ALo(11,"async"),m.qZA(),m.qZA(),m.qZA()),2&t&&(m.xp6(10),m.Q6J("ngForOf",m.lcZ(11,1,e.uploads$)))},directives:[g.uh,A.lW,g.ZT,w.Hw,g.xY,y.sg,y.O5,C.gM,v.pW],pipes:[y.Ov],styles:["tr.failed[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:red}h3.mat-dialog-title[_ngcontent-%COMP%]{background-color:#24292e;color:#fff;margin:0;padding-left:5px;font-size:16px;line-height:40px}table[_ngcontent-%COMP%]{border-collapse:collapse}.table-wrapper[_ngcontent-%COMP%]{height:150px;overflow-y:scroll;overflow-x:hidden;padding:5px}"],changeDetection:0}),t})();var J=n(9624);const N=[[["app-storage-toolbar"]],[["app-detail-pane"]],"*"],P=["app-storage-toolbar","app-detail-pane","*"];let Y=(()=>{class t{constructor(){this.noscroll=!1}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=m.Xpm({type:t,selectors:[["app-storage-page"]],inputs:{noscroll:"noscroll"},ngContentSelectors:P,decls:4,vars:2,consts:[[1,"page-content"]],template:function(t,e){1&t&&(m.F$t(N),m.Hsn(0),m.TgZ(1,"div",0),m.Hsn(2,1),m.Hsn(3,2),m.qZA()),2&t&&(m.xp6(1),m.Udp("overflow",e.noscroll?"hidden":"auto"))},styles:[".page-content[_ngcontent-%COMP%]{position:absolute;top:49px;bottom:0;left:0;right:0;overflow:auto}"],changeDetection:0}),t})();var S=n(5847),$=n(7112);function Q(t,e){if(1&t){const t=m.EpF();m.TgZ(0,"button",4),m.NdJ("click",function(){return m.CHM(t),m.oxw(2).showDetailPane(!0)}),m._uU(1," SHOW INFO PANEL "),m.qZA()}}function I(t,e){if(1&t){const t=m.EpF();m.TgZ(0,"button",4),m.NdJ("click",function(){return m.CHM(t),m.oxw(2).showDetailPane(!1)}),m._uU(1," HIDE INFO PANEL "),m.qZA()}}function M(t,e){if(1&t&&(m.ynx(0),m.YNc(1,Q,2,0,"button",3),m.ALo(2,"async"),m.YNc(3,I,2,0,"button",3),m.ALo(4,"async"),m.BQk()),2&t){const t=m.oxw();m.xp6(1),m.Q6J("ngIf",!m.lcZ(2,2,t.showDetailPane$)),m.xp6(2),m.Q6J("ngIf",m.lcZ(4,4,t.showDetailPane$))}}const F=["*"];let j=(()=>{class t{constructor(t){this.preferenceStore=t,this.hasDetailPane=!1,this.showDetailPane$=t.detailPane$}showDetailPane(t){this.preferenceStore.setShowDetailPane(t)}}return t.\u0275fac=function(e){return new(e||t)(m.Y36(S.V))},t.\u0275cmp=m.Xpm({type:t,selectors:[["app-storage-toolbar"]],inputs:{hasDetailPane:"hasDetailPane"},ngContentSelectors:F,decls:5,vars:1,consts:[[1,"top"],[2,"flex","1 1 auto"],[4,"ngIf"],["mat-button","",3,"click",4,"ngIf"],["mat-button","",3,"click"]],template:function(t,e){1&t&&(m.F$t(),m.TgZ(0,"mat-toolbar",0),m.TgZ(1,"mat-toolbar-row"),m.Hsn(2),m._UZ(3,"span",1),m.YNc(4,M,5,6,"ng-container",2),m.qZA(),m.qZA()),2&t&&(m.xp6(4),m.Q6J("ngIf",e.hasDetailPane))},directives:[$.Ye,$.rD,y.O5,A.lW],pipes:[y.Ov],styles:["mat-toolbar[_ngcontent-%COMP%]{border-bottom:1px solid #d3d3d3;background-color:#fff;box-sizing:initial;color:rgba(0,0,0,.65)}mat-toolbar-row[_ngcontent-%COMP%]{padding-left:24px}.hide[_ngcontent-%COMP%]{visibility:hidden}.toolbar-text[_ngcontent-%COMP%]{font-size:12px}"],changeDetection:0}),t})();var L=n(2679),H=n(3061),B=n(5722),E=n(7070),R=n(6278),z=n(4626),G=n(487),X=n(3116);const W=["droparea"];function V(t,e){if(1&t&&m._UZ(0,"app-breadcrumb",13),2&t){const t=e.$implicit;m.Q6J("link",t.route)("label",t.name)}}const K=function(){return["/storage","buckets"]},tt=function(t){return{instance:t}},et=function(t,e){return["/storage","buckets",t,e]};function nt(t,e){if(1&t&&(m.ynx(0),m.TgZ(1,"app-breadcrumb-trail"),m._UZ(2,"app-breadcrumb",10),m._UZ(3,"app-breadcrumb",11),m.YNc(4,V,1,2,"app-breadcrumb",12),m.qZA(),m.BQk()),2&t){const t=e.ngIf,n=m.oxw();m.xp6(2),m.Q6J("link",m.DdM(5,K))("queryParams",m.VKq(6,tt,n.bucketInstance)),m.xp6(1),m.Q6J("link",m.WLB(8,et,n.bucketInstance,n.name))("label",n.name),m.xp6(1),m.Q6J("ngForOf",t)}}function at(t,e){if(1&t){const t=m.EpF();m.TgZ(0,"th",30),m.TgZ(1,"input",31),m.NdJ("change",function(e){m.CHM(t);const n=m.oxw(2);return e?n.masterToggle():null}),m.qZA(),m.qZA()}if(2&t){const t=m.oxw(2);m.xp6(1),m.Q6J("checked",t.selection.hasValue()&&t.isAllSelected())}}function ot(t,e){if(1&t){const t=m.EpF();m.TgZ(0,"td",32),m.TgZ(1,"input",33),m.NdJ("click",function(t){return t.stopPropagation()})("change",function(e){const n=m.CHM(t).$implicit,a=m.oxw(2);return e?a.selection.toggle(n):null}),m.qZA(),m.qZA()}if(2&t){const t=e.$implicit,n=m.oxw(2);m.xp6(1),m.Q6J("checked",n.selection.isSelected(t))}}function it(t,e){1&t&&(m.TgZ(0,"th",34),m._uU(1,"Name"),m.qZA())}function ct(t,e){if(1&t&&(m.ynx(0),m.TgZ(1,"mat-icon",36),m._uU(2,"folder"),m.qZA(),m.TgZ(3,"a",37),m.NdJ("click",function(t){return t.stopPropagation()}),m._uU(4),m.ALo(5,"filename"),m.qZA(),m.BQk()),2&t){const t=m.oxw().$implicit,e=m.oxw(2);m.xp6(3),m.Q6J("routerLink","/storage/buckets/"+e.bucketInstance+"/"+e.name+"/"+t.name),m.xp6(1),m.hij(" ",m.lcZ(5,2,t.name)," ")}}function st(t,e){if(1&t&&(m.ynx(0),m.TgZ(1,"mat-icon",36),m._uU(2,"description"),m.qZA(),m.TgZ(3,"a",38),m.NdJ("click",function(t){return t.stopPropagation()}),m._uU(4),m.ALo(5,"filename"),m.qZA(),m.BQk()),2&t){const t=m.oxw().$implicit;m.xp6(3),m.Q6J("href",t.objectUrl,m.LSH),m.xp6(1),m.hij(" ",m.lcZ(5,2,t.name)," ")}}function rt(t,e){if(1&t&&(m.TgZ(0,"td",35),m.YNc(1,ct,6,4,"ng-container",7),m.YNc(2,st,6,4,"ng-container",7),m.qZA()),2&t){const t=e.$implicit;m.xp6(1),m.Q6J("ngIf",t.folder),m.xp6(1),m.Q6J("ngIf",!t.folder)}}function lt(t,e){1&t&&(m.TgZ(0,"th",39),m._uU(1,"Date modified"),m.qZA())}function ut(t,e){if(1&t&&(m.TgZ(0,"td",35),m._uU(1),m.ALo(2,"datetime"),m.qZA()),2&t){const t=e.$implicit;m.xp6(1),m.hij(" ",m.lcZ(2,1,t.modified)||"-"," ")}}function dt(t,e){1&t&&(m.TgZ(0,"th",40),m._uU(1,"Size"),m.qZA())}function pt(t,e){if(1&t&&(m.TgZ(0,"td",35),m._uU(1),m.ALo(2,"formatBytes"),m.qZA()),2&t){const t=e.$implicit;m.xp6(1),m.hij(" ",m.lcZ(2,1,t.size)||"-"," ")}}function ht(t,e){1&t&&m._UZ(0,"th",41)}function gt(t,e){if(1&t){const t=m.EpF();m.ynx(0),m.TgZ(1,"mat-menu",42,43),m.TgZ(3,"button",44),m.NdJ("click",function(){m.CHM(t);const e=m.oxw().$implicit;return m.oxw(2).renameFile(e)}),m._uU(4," Rename "),m.qZA(),m.TgZ(5,"a",45),m._uU(6," Download "),m.qZA(),m._UZ(7,"mat-divider"),m.TgZ(8,"button",44),m.NdJ("click",function(){m.CHM(t);const e=m.oxw().$implicit;return m.oxw(2).deleteFile(e)}),m._uU(9," Delete "),m.qZA(),m.qZA(),m.TgZ(10,"button",46),m.NdJ("click",function(t){return t.stopPropagation()}),m.TgZ(11,"mat-icon"),m._uU(12,"more_vert"),m.qZA(),m.qZA(),m.BQk()}if(2&t){const t=m.MAs(2),e=m.oxw().$implicit;m.xp6(5),m.Q6J("href",e.objectUrl,m.LSH),m.xp6(5),m.Q6J("matMenuTriggerFor",t)}}function mt(t,e){if(1&t&&(m.TgZ(0,"td",35),m.YNc(1,gt,13,2,"ng-container",7),m.qZA()),2&t){const t=e.$implicit;m.xp6(1),m.Q6J("ngIf",!t.folder)}}function ft(t,e){1&t&&m._UZ(0,"tr",47)}function bt(t,e){if(1&t){const t=m.EpF();m.TgZ(0,"tr",48),m.NdJ("click",function(){const e=m.CHM(t).$implicit;return m.oxw(2).toggleOne(e)}),m.qZA()}if(2&t){const t=e.$implicit,n=m.oxw(2);m.ekj("selected",n.selection.isSelected(t))}}function Zt(t,e){if(1&t&&(m.TgZ(0,"table",14),m.ynx(1,15),m.YNc(2,at,2,1,"th",16),m.YNc(3,ot,2,1,"td",17),m.BQk(),m.ynx(4,18),m.YNc(5,it,2,0,"th",19),m.YNc(6,rt,3,2,"td",20),m.BQk(),m.ynx(7,21),m.YNc(8,lt,2,0,"th",22),m.YNc(9,ut,3,3,"td",20),m.BQk(),m.ynx(10,23),m.YNc(11,dt,2,0,"th",24),m.YNc(12,pt,3,3,"td",20),m.BQk(),m.ynx(13,25),m.YNc(14,ht,1,0,"th",26),m.YNc(15,mt,2,1,"td",27),m.BQk(),m.YNc(16,ft,1,0,"tr",28),m.YNc(17,bt,1,2,"tr",29),m.qZA()),2&t){const t=m.oxw();m.Q6J("dataSource",t.dataSource),m.xp6(16),m.Q6J("cdkHeaderRowDef",t.displayedColumns),m.xp6(1),m.Q6J("cdkRowDefColumns",t.displayedColumns)}}function xt(t,e){1&t&&(m.TgZ(0,"app-empty-message"),m._uU(1,"Empty directory."),m.qZA())}let kt=(()=>{class t{constructor(t,e,n,a,i){this.dialog=t,this.route=n,this.breadcrumb$=new l.X([]),this.dragActive$=new l.X(!1),this.displayedColumns=["select","name","size","modified","actions"],this.dataSource=new r.by([]),this.selection=new s.Ov(!0,[]),this.uploads$=new l.X([]),this.progressDialogOpen=!1,this.bucketInstance=n.snapshot.parent.paramMap.get("instance"),this.name=n.snapshot.parent.paramMap.get("name"),i.setTitle(this.name),this.storageClient=a.createStorageClient(),this.loadCurrentFolder(),this.routerSubscription=e.events.pipe((0,u.h)(t=>t instanceof o.m2)).subscribe(()=>{this.loadCurrentFolder()})}loadCurrentFolder(){const t={delimiter:"/"},e=this.route.snapshot.url;e.length&&(t.prefix=e.map(t=>t.path).join("/")+"/"),this.storageClient.listObjects(this.bucketInstance,this.name,t).then(t=>{this.updateBrowsePath(),this.changedir(t)})}changedir(t){this.selection.clear();const e=[];for(const n of t.prefixes||[])e.push({folder:!0,name:n});for(const n of t.objects||[])e.push({folder:!1,name:n.name,modified:n.created,size:n.size,objectUrl:this.storageClient.getObjectURL(this.bucketInstance,this.name,n.name)});this.dataSource.data=e}isAllSelected(){const t=this.dataSource.data.length;return this.selection.selected.length===t&&t>0}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.data.forEach(t=>this.selection.select(t))}toggleOne(t){(!this.selection.isSelected(t)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(t)}uploadObjects(){this.dialog.open(x,{width:"400px",data:{bucketInstance:this.bucketInstance,bucket:this.name,path:this.getCurrentPath()}}).afterClosed().subscribe(t=>{t.length&&this.showUploadProgress().then(()=>{for(const e of t)this.trackUpload(e);this.settlePromises(t.map(t=>t.promise)).then(()=>{this.loadCurrentFolder()})})})}settlePromises(t){return Promise.all(t.map(t=>t.then(t=>({state:"fullfilled",value:t}),t=>({state:"rejected",value:t}))))}trackUpload(t){t.promise.then(()=>{t.complete=!0,this.uploads$.next([...this.uploads$.value])}).catch(e=>{e.response.json().then(e=>{t.complete=!0,t.err=e.msg,this.uploads$.next([...this.uploads$.value])}).catch(()=>{t.complete=!0,t.err=e.statusText,this.uploads$.next([...this.uploads$.value])})}),this.uploads$.next([...this.uploads$.value,t])}getCurrentPath(){let t="";for(const e of this.route.snapshot.url)t+="/"+e.path;return t||"/"}deleteSelectedObjects(){const t=[],e=[];for(const n of this.selection.selected)n.folder?e.push(this.storageClient.listObjects(this.bucketInstance,this.name,{prefix:n.name}).then(e=>{t.push(...(e.objects||[]).map(t=>t.name))})):t.push(n.name);Promise.all(e).then(()=>{if(confirm(`You are about to delete ${t.length} files. Are you sure you want to continue?`)){const e=[];for(const n of t)e.push(this.storageClient.deleteObject(this.bucketInstance,this.name,n));Promise.all(e).then(()=>{this.loadCurrentFolder()})}})}renameFile(t){this.dialog.open(b,{data:{bucketInstance:this.bucketInstance,bucket:this.name,name:t.name},width:"400px"}).afterClosed().subscribe(t=>{t&&this.loadCurrentFolder()})}deleteFile(t){confirm(`Are you sure you want to delete ${t.name}?`)&&this.storageClient.deleteObject(this.bucketInstance,this.name,t.name).then(()=>{this.loadCurrentFolder()})}dragEnter(t){return this.dragActive$.next(!0),t.preventDefault(),t.stopPropagation(),!1}dragOver(t){return t.preventDefault(),t.stopPropagation(),!1}dragLeave(t){return this.dragActive$.next(!1),t.preventDefault(),t.stopPropagation(),!1}drop(t){const e=t.dataTransfer||{};if(e){let t=this.getCurrentPath().substring(1);""!==t&&(t+="/"),p.v(e).then(e=>{if(e.length){const n=[];this.showUploadProgress().then(()=>{for(const a of e){const e=this.storageClient.uploadObject(this.bucketInstance,this.name,t+a._fullPath,a);this.trackUpload({filename:a._fullPath,promise:e}),n.push(e)}this.settlePromises(n).then(()=>{this.loadCurrentFolder()})})}})}return this.dragActive$.next(!1),t.preventDefault(),t.stopPropagation(),!1}updateBrowsePath(){const t=[];let e="";for(const n of this.route.snapshot.url)e+="/"+n.path,t.push({name:n.path,route:`/storage/buckets/${this.bucketInstance}/${this.name}`+e});return this.breadcrumb$.next(t),e||"/"}showUploadProgress(){return t=this,void 0,n=function*(){if(!this.progressDialogOpen)return this.dialogRef=this.dialog.open(D,{position:{bottom:"10px",right:"10px"},width:"500px",data:{uploads$:this.uploads$},hasBackdrop:!1,autoFocus:!1,panelClass:["progress-dialog","mat-elevation-z2"]}),this.dialogRef.afterOpened().subscribe(()=>this.progressDialogOpen=!0),this.dialogRef.afterClosed().subscribe(()=>{this.uploads$.next([]),this.progressDialogOpen=!1}),new Promise((t,e)=>{this.dialogRef.afterOpened().subscribe(()=>{t(!0)},t=>{e(t)})})},new((e=void 0)||(e=Promise))(function(a,o){function i(t){try{s(n.next(t))}catch(e){o(e)}}function c(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var n;t.done?a(t.value):(n=t.value,n instanceof e?n:new e(function(t){t(n)})).then(i,c)}s((n=n.apply(t,[])).next())});var t,e,n}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.dialogRef&&this.dialogRef.close()}}return t.\u0275fac=function(e){return new(e||t)(m.Y36(g.uw),m.Y36(o.F0),m.Y36(o.gz),m.Y36(d.C),m.Y36(J.Dx))},t.\u0275cmp=m.Xpm({type:t,selectors:[["ng-component"]],viewQuery:function(t,e){if(1&t&&m.Gf(W,7),2&t){let t;m.iGM(t=m.CRH())&&(e.dropArea=t.first)}},decls:25,vars:15,consts:[["mat-icon-button","","routerLink","/storage/buckets","color","primary"],["mat-button","","color","primary",3,"click"],["mat-button","","color","primary",3,"disabled","click"],[1,"droparea",3,"dragenter"],["droparea",""],[1,"droparea-overlay",3,"dragover","dragleave","drop"],[1,"panel-content"],[4,"ngIf"],["mat-table","","class","ya-data-table","style","width: 100%",3,"dataSource",4,"ngIf","ngIfElse"],["empty",""],["icon","account_tree",3,"link","queryParams"],["icon","shopping_basket",3,"link","label"],["icon","folder",3,"link","label",4,"ngFor","ngForOf"],["icon","folder",3,"link","label"],["mat-table","",1,"ya-data-table",2,"width","100%",3,"dataSource"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["cdkColumnDef","name"],["mat-header-cell","","style","width: 400px",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","modified"],["mat-header-cell","","style","width: 200px",4,"cdkHeaderCellDef"],["cdkColumnDef","size"],["mat-header-cell","","style","width: 70px",4,"cdkHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"checked","change"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"checked","click","change"],["mat-header-cell","",2,"width","400px"],["mat-cell",""],[1,"icon12",2,"vertical-align","middle","margin-right","7px"],[3,"routerLink","click"],["download","",3,"href","click"],["mat-header-cell","",2,"width","200px"],["mat-header-cell","",2,"width","70px"],["mat-header-cell",""],["overlapTrigger","false",1,"ya-menu"],["fileMenu","matMenu"],["mat-menu-item","",3,"click"],["mat-menu-item","","download","",3,"href"],["mat-button","",1,"icon",3,"matMenuTriggerFor","click"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(t,e){if(1&t&&(m.TgZ(0,"app-storage-page"),m.TgZ(1,"app-storage-toolbar"),m.TgZ(2,"a",0),m.TgZ(3,"mat-icon"),m._uU(4,"arrow_back"),m.qZA(),m.qZA(),m._uU(5),m.TgZ(6,"button",1),m.NdJ("click",function(){return e.uploadObjects()}),m.TgZ(7,"mat-icon"),m._uU(8,"cloud_upload"),m.qZA(),m._uU(9," UPLOAD FILES "),m.qZA(),m.TgZ(10,"button",2),m.NdJ("click",function(){return e.deleteSelectedObjects()}),m.TgZ(11,"mat-icon"),m._uU(12,"delete"),m.qZA(),m._uU(13," DELETE "),m.qZA(),m.qZA(),m.TgZ(14,"div",3,4),m.NdJ("dragenter",function(t){return e.dragEnter(t)}),m.ALo(16,"async"),m.TgZ(17,"div",5),m.NdJ("dragover",function(t){return e.dragOver(t)})("dragleave",function(t){return e.dragLeave(t)})("drop",function(t){return e.drop(t)}),m.ALo(18,"async"),m.qZA(),m.TgZ(19,"div",6),m.YNc(20,nt,5,11,"ng-container",7),m.ALo(21,"async"),m.YNc(22,Zt,18,3,"table",8),m.YNc(23,xt,2,0,"ng-template",null,9,m.W1O),m.qZA(),m.qZA(),m.qZA()),2&t){const t=m.MAs(24);m.xp6(5),m.hij(" Buckets / ",e.name," \xa0\xa0\xa0 "),m.xp6(5),m.Q6J("disabled",!e.selection.hasValue()),m.xp6(4),m.ekj("active",m.lcZ(16,9,e.dragActive$)),m.xp6(3),m.ekj("hide",!m.lcZ(18,11,e.dragActive$)),m.xp6(3),m.Q6J("ngIf",m.lcZ(21,13,e.breadcrumb$)),m.xp6(2),m.Q6J("ngIf",e.dataSource&&e.dataSource.data.length)("ngIfElse",t)}},directives:[Y,j,A.zs,o.yS,w.Hw,A.lW,y.O5,L.w,H.a,y.sg,r.BZ,B.fo,B.D5,B.O_,r.w1,r.fO,r.Dz,B.s$,B.Sq,r.ge,r.ev,E.VK,E.OP,R.d,E.p6,r.XQ,r.Gk,z.M],pipes:[y.Ov,f.X,G.i,X.b],styles:["mat-toolbar[_ngcontent-%COMP%]{border-bottom:1px solid #d3d3d3;background-color:#fff;box-sizing:initial;color:rgba(0,0,0,.65)}mat-toolbar-row[_ngcontent-%COMP%]{padding-left:24px}.droparea[_ngcontent-%COMP%]{overflow:auto}.droparea[_ngcontent-%COMP%], .droparea-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}.droparea-overlay[_ngcontent-%COMP%]{box-sizing:border-box;background:rgba(27,97,185,.1);border:1px solid #1b61b9;z-index:10}  .progress-dialog .mat-dialog-container{box-shadow:none;padding:0;overflow:hidden}  .progress-dialog .mat-dialog-content{overflow:hidden}"],changeDetection:0}),t})(),At=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=m.Xpm({type:t,selectors:[["ng-component"]],decls:1,vars:0,template:function(t,e){1&t&&m._UZ(0,"router-outlet")},directives:[o.lC],encapsulation:2,changeDetection:0}),t})();var wt=n(9241);let yt=(()=>{class t{constructor(t,e,n,a){this.dialogRef=t,this.data=a,this.storageClient=n.createStorageClient(),this.form=e.group({name:["",h.kI.required]})}save(){this.storageClient.createBucket(this.data.bucketInstance,{name:this.form.value.name}).then(()=>this.dialogRef.close(!0))}}return t.\u0275fac=function(e){return new(e||t)(m.Y36(g.so),m.Y36(h.qu),m.Y36(d.C),m.Y36(g.WI))},t.\u0275cmp=m.Xpm({type:t,selectors:[["app-create-bucket-dialog"]],decls:12,vars:2,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["type","text","formControlName","name"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"]],template:function(t,e){1&t&&(m.TgZ(0,"h2",0),m._uU(1,"Create bucket"),m.qZA(),m.TgZ(2,"mat-dialog-content",1),m.TgZ(3,"form",2),m.TgZ(4,"label"),m._uU(5," Bucket name "),m._UZ(6,"input",3),m.qZA(),m.qZA(),m.qZA(),m.TgZ(7,"mat-dialog-actions",4),m.TgZ(8,"button",5),m._uU(9,"CANCEL"),m.qZA(),m.TgZ(10,"button",6),m.NdJ("click",function(){return e.save()}),m._uU(11,"SAVE"),m.qZA(),m.qZA()),2&t&&(m.xp6(3),m.Q6J("formGroup",e.form),m.xp6(7),m.Q6J("disabled",!e.form.valid))},directives:[g.uh,g.xY,h._Y,h.JL,h.sg,h.Fj,h.JJ,h.u,g.H8,g.ZT],encapsulation:2}),t})();var Ct=n(808),vt=n(7950);function Tt(t,e){if(1&t){const t=m.EpF();m.TgZ(0,"th",20),m.TgZ(1,"input",21),m.NdJ("change",function(e){m.CHM(t);const n=m.oxw();return e?n.masterToggle():null}),m.qZA(),m.qZA()}if(2&t){const t=m.oxw();m.xp6(1),m.Q6J("checked",t.selection.hasValue()&&t.isAllSelected())}}function qt(t,e){if(1&t){const t=m.EpF();m.TgZ(0,"td",22),m.TgZ(1,"input",23),m.NdJ("click",function(t){return t.stopPropagation()})("change",function(e){const n=m.CHM(t).$implicit,a=m.oxw();return e?a.selection.toggle(n):null}),m.qZA(),m.qZA()}if(2&t){const t=e.$implicit,n=m.oxw();m.xp6(1),m.Q6J("checked",n.selection.isSelected(t))}}function _t(t,e){1&t&&(m.TgZ(0,"th",24),m._uU(1,"Name"),m.qZA())}const Ut=function(t,e){return[t,e]};function Ot(t,e){if(1&t&&(m.TgZ(0,"td",25),m.TgZ(1,"mat-icon",26),m._uU(2,"shopping_basket"),m.qZA(),m.TgZ(3,"a",27),m.NdJ("click",function(t){return t.stopPropagation()}),m._uU(4),m.qZA(),m.qZA()),2&t){const t=e.$implicit,n=m.oxw();m.xp6(3),m.Q6J("routerLink",m.WLB(2,Ut,n.instance,t.name)),m.xp6(1),m.Oqu(t.name)}}function Dt(t,e){1&t&&(m.TgZ(0,"th",28),m._uU(1,"Size"),m.qZA())}function Jt(t,e){if(1&t&&(m.TgZ(0,"td",29),m._uU(1),m.ALo(2,"nvl"),m.ALo(3,"formatBytes"),m.qZA()),2&t){const t=e.$implicit;m.xp6(1),m.Oqu(m.xi3(2,1,m.lcZ(3,4,t.size),"-"))}}function Nt(t,e){1&t&&(m.TgZ(0,"th",30),m._uU(1,"Object count"),m.qZA())}function Pt(t,e){if(1&t&&(m.TgZ(0,"td",29),m._uU(1),m.ALo(2,"nvl"),m.ALo(3,"number"),m.qZA()),2&t){const t=e.$implicit;m.xp6(1),m.Oqu(m.xi3(2,1,m.lcZ(3,4,t.numObjects),"-"))}}function Yt(t,e){1&t&&m._UZ(0,"tr",31)}function St(t,e){if(1&t){const t=m.EpF();m.TgZ(0,"tr",32),m.NdJ("click",function(){const e=m.CHM(t).$implicit;return m.oxw().toggleOne(e)}),m.qZA()}if(2&t){const t=e.$implicit,n=m.oxw();m.ekj("selected",n.selection.isSelected(t))}}let $t=(()=>{class t{constructor(t,e,n,a,o){this.yamcs=t,this.dialog=e,this.router=n,this.route=a,this.instance="_global",this.displayedColumns=["select","name","size","numObjects"],this.filterForm=new h.cw({instance:new h.NI("_global")}),this.instanceOptions$=new l.X([{id:"_global",label:"_global"}]),this.dataSource=new r.by,this.selection=new s.Ov(!0,[]),o.setTitle("Buckets"),this.storageClient=this.yamcs.createStorageClient(),t.yamcsClient.getInstances({filter:"state=RUNNING"}).then(t=>{for(const e of t)this.instanceOptions$.next([...this.instanceOptions$.value,{id:e.name,label:e.name}])}),this.initializeOptions(),this.refreshDataSources(),this.filterForm.get("instance").valueChanges.forEach(t=>{this.instance=t,this.refreshDataSources()})}initializeOptions(){const t=this.route.snapshot.queryParamMap;t.has("instance")&&(this.instance=t.get("instance"),this.filterForm.get("instance").setValue(this.instance))}ngAfterViewInit(){this.dataSource.sort=this.sort}isAllSelected(){return this.selection.selected.length===this.dataSource.data.length}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.data.forEach(t=>this.selection.select(t))}toggleOne(t){(!this.selection.isSelected(t)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(t)}createBucket(){this.dialog.open(yt,{width:"400px",data:{bucketInstance:this.instance}}).afterClosed().subscribe(t=>{t&&this.refreshDataSources()})}deleteSelectedBuckets(){if(confirm("Are you sure you want to delete the selected buckets?")){const t=[];for(const e of this.selection.selected){const n=this.storageClient.deleteBucket(this.instance,e.name);t.push(n)}Promise.all(t).then(()=>{this.selection.clear(),this.refreshDataSources()})}}refreshDataSources(){this.updateURL(),this.storageClient.getBuckets(this.instance).then(t=>{this.dataSource.data=t})}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{instance:this.instance||null},queryParamsHandling:"merge"})}}return t.\u0275fac=function(e){return new(e||t)(m.Y36(d.C),m.Y36(g.uw),m.Y36(o.F0),m.Y36(o.gz),m.Y36(J.Dx))},t.\u0275cmp=m.Xpm({type:t,selectors:[["ng-component"]],viewQuery:function(t,e){if(1&t&&m.Gf(wt.YE,7),2&t){let t;m.iGM(t=m.CRH())&&(e.sort=t.first)}},decls:31,vars:8,consts:[["mat-button","","color","primary",3,"click"],["mat-button","","color","primary",3,"disabled","click"],[1,"panel-content"],[3,"formGroup"],[1,"filter-bar"],["formControlName","instance",3,"options"],["mat-table","","matSort","","matSortActive","name","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table",3,"dataSource"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","","width","200",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","size"],["mat-header-cell","","mat-sort-header","","style","text-align: right; width: 70px",4,"matHeaderCellDef"],["mat-cell","","style","text-align: right",4,"matCellDef"],["matColumnDef","numObjects"],["mat-header-cell","","mat-sort-header","","style","text-align: right; width: 100px",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"checked","change"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"checked","click","change"],["mat-header-cell","","mat-sort-header","","width","200"],["mat-cell",""],[1,"icon12",2,"vertical-align","middle","margin-right","7px"],[3,"routerLink","click"],["mat-header-cell","","mat-sort-header","",2,"text-align","right","width","70px"],["mat-cell","",2,"text-align","right"],["mat-header-cell","","mat-sort-header","",2,"text-align","right","width","100px"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(t,e){1&t&&(m.TgZ(0,"app-storage-page"),m.TgZ(1,"app-storage-toolbar"),m._uU(2," Buckets \xa0\xa0\xa0 "),m.TgZ(3,"button",0),m.NdJ("click",function(){return e.createBucket()}),m.TgZ(4,"mat-icon"),m._uU(5,"add"),m.qZA(),m._uU(6," CREATE BUCKET "),m.qZA(),m.TgZ(7,"button",1),m.NdJ("click",function(){return e.deleteSelectedBuckets()}),m.TgZ(8,"mat-icon"),m._uU(9,"delete"),m.qZA(),m._uU(10," DELETE "),m.qZA(),m.qZA(),m.TgZ(11,"div",2),m.TgZ(12,"form",3),m.TgZ(13,"div",4),m._UZ(14,"app-select",5),m.ALo(15,"async"),m.qZA(),m.qZA(),m.TgZ(16,"table",6),m.ynx(17,7),m.YNc(18,Tt,2,1,"th",8),m.YNc(19,qt,2,1,"td",9),m.BQk(),m.ynx(20,10),m.YNc(21,_t,2,0,"th",11),m.YNc(22,Ot,5,5,"td",12),m.BQk(),m.ynx(23,13),m.YNc(24,Dt,2,0,"th",14),m.YNc(25,Jt,4,6,"td",15),m.BQk(),m.ynx(26,16),m.YNc(27,Nt,2,0,"th",17),m.YNc(28,Pt,4,6,"td",15),m.BQk(),m.YNc(29,Yt,1,0,"tr",18),m.YNc(30,St,1,2,"tr",19),m.qZA(),m.qZA(),m.qZA()),2&t&&(m.xp6(7),m.Q6J("disabled",!e.selection.hasValue()),m.xp6(5),m.Q6J("formGroup",e.filterForm),m.xp6(2),m.Q6J("options",m.lcZ(15,6,e.instanceOptions$)),m.xp6(2),m.Q6J("dataSource",e.dataSource),m.xp6(13),m.Q6J("matHeaderRowDef",e.displayedColumns),m.xp6(1),m.Q6J("matRowDefColumns",e.displayedColumns))},directives:[Y,j,A.lW,w.Hw,h._Y,h.JL,h.sg,Ct.P,h.JJ,h.u,r.BZ,wt.YE,B.fo,B.D5,B.O_,r.w1,r.fO,r.Dz,r.as,r.nj,r.ge,r.ev,wt.nU,o.yS,r.XQ,r.Gk],pipes:[y.Ov,vt.m,X.b,y.JJ],encapsulation:2,changeDetection:0}),t})();var Qt=n(5048),It=n(168),Mt=n(5078),Ft=n(4776);const jt=[{path:"",canActivate:[i.a,c.U],canActivateChild:[i.a],runGuardsAndResolvers:"always",component:(()=>{class t{constructor(t){this.sidebar$=t.sidebar$}}return t.\u0275fac=function(e){return new(e||t)(m.Y36(S.V))},t.\u0275cmp=m.Xpm({type:t,selectors:[["ng-component"]],decls:18,vars:8,consts:[["messageBar",""],[1,"mat-typography"],["mode","side",3,"opened","disableClose"],[1,"top","module-title"],[1,"icon32",2,"margin-right","16px"],["dense",""],["routerLink","/storage/buckets"],[1,"item-icon"]],template:function(t,e){if(1&t&&(m._UZ(0,"app-message-bar",null,0),m.TgZ(2,"mat-sidenav-container",1),m.ALo(3,"async"),m.TgZ(4,"mat-sidenav",2),m.ALo(5,"async"),m.TgZ(6,"mat-toolbar",3),m.TgZ(7,"mat-toolbar-row"),m.TgZ(8,"mat-icon",4),m._uU(9,"storage"),m.qZA(),m._uU(10," Storage "),m.qZA(),m.qZA(),m.TgZ(11,"mat-nav-list",5),m.TgZ(12,"app-sidebar-nav-item",6),m.TgZ(13,"mat-icon",7),m._uU(14,"shopping_basket"),m.qZA(),m._uU(15," Buckets "),m.qZA(),m.qZA(),m.qZA(),m.TgZ(16,"mat-sidenav-content"),m._UZ(17,"router-outlet"),m.qZA(),m.qZA()),2&t){const t=m.MAs(1);m.xp6(2),m.ekj("message-bar-visible",m.lcZ(3,4,t.show$)),m.xp6(2),m.Q6J("opened",m.lcZ(5,6,e.sidebar$))("disableClose",!0)}},directives:[Qt.c,It.TM,It.JX,$.Ye,$.rD,w.Hw,Mt.Hk,Ft.y,o.rH,It.Rh,o.lC],pipes:[y.Ov],styles:["mat-sidenav-container[_ngcontent-%COMP%]{position:absolute;top:48px;bottom:0;left:0;right:0;background-color:#fff}mat-sidenav-container.message-bar-visible[_ngcontent-%COMP%]{top:112px}mat-sidenav[_ngcontent-%COMP%]{width:250px;border-right:1px solid #d3d3d3}mat-sidenav[_ngcontent-%COMP%], mat-toolbar[_ngcontent-%COMP%]{background-color:#fcfcfc}mat-toolbar[_ngcontent-%COMP%]{border-bottom:1px solid #d3d3d3;box-sizing:initial;color:rgba(0,0,0,.65)}"],changeDetection:0}),t})(),children:[{path:"buckets",pathMatch:"full",component:$t},{path:"buckets/:instance/:name",component:At,children:[{path:"**",component:kt}]}]}];let Lt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=m.oAB({type:t}),t.\u0275inj=m.cJS({imports:[[o.Bz.forChild(jt)],o.Bz]}),t})(),Ht=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=m.oAB({type:t}),t.\u0275inj=m.cJS({imports:[[a.m,Lt]]}),t})()}}]);