(self.webpackChunk_yamcs_webapp=self.webpackChunk_yamcs_webapp||[]).push([[969],{7969:(t,e,c)=>{"use strict";c.r(e),c.d(e,{GapsModule:()=>F});var n=c(7290),a=c(3337),i=c(7102),s=c(4017),o=c(9385),l=c(8378),r=c(7340),u=c(8293),p=c(1041),d=c(2935),h=c(8512),m=c(8509),g=c(5366),f=c(1116),Z=c(808);function k(t,e){1&t&&(g.ynx(0),g.TgZ(1,"label"),g._uU(2," Merge tolerance (minutes) "),g._UZ(3,"input",8),g.TgZ(4,"span",9),g._uU(5,"Gaps that are at least this close to each other, are merged."),g.qZA(),g.qZA(),g._UZ(6,"br"),g.BQk())}let y=(()=>{class t{constructor(t,e,c){this.dialogRef=t,this.yamcs=e,this.data=c,this.linkOptions$=new h.X([]),this.form=new p.cw({mergeTolerance:new p.NI(30),link:new p.NI("",p.kI.required)}),this.gaps=this.data.gaps,this.yamcs.yamcsClient.getLinks(e.instance).then(t=>{const e=[];for(const c of t)-1!==c.type.indexOf("DassPlaybackPacketProvider")&&e.push({id:c.name,label:c.name});this.linkOptions$.next(e),e.length&&this.form.get("link").setValue(e[0].id)})}sendRequest(){const t=[],e=new Map,c=60*this.form.value.mergeTolerance*1e3;for(const n of this.gaps){const a=e.get(n.apid);if(a&&this.toMillis(n.start)-this.toMillis(a.stop)<c)a.stop=n.stop;else{const c={apid:n.apid,start:n.start,stop:n.stop};t.push(c),e.set(n.apid,c)}}this.dialogRef.close({link:this.form.value.link,ranges:t})}toMillis(t){return m.ZU(t).getTime()}}return t.\u0275fac=function(e){return new(e||t)(g.Y36(d.so),g.Y36(u.C),g.Y36(d.WI))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-request-playback-dialog"]],decls:15,vars:6,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],[4,"ngIf"],["formControlName","link",3,"options"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"],["type","number","formControlName","mergeTolerance"],[1,"hint"]],template:function(t,e){1&t&&(g.TgZ(0,"h2",0),g._uU(1,"Request playback"),g.qZA(),g.TgZ(2,"mat-dialog-content",1),g.TgZ(3,"form",2),g.YNc(4,k,7,0,"ng-container",3),g.TgZ(5,"label"),g._uU(6," Link"),g._UZ(7,"br"),g._UZ(8,"app-select",4),g.ALo(9,"async"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(10,"mat-dialog-actions",5),g.TgZ(11,"button",6),g._uU(12,"CANCEL"),g.qZA(),g.TgZ(13,"button",7),g.NdJ("click",function(){return e.sendRequest()}),g._uU(14,"SEND REQUEST"),g.qZA(),g.qZA()),2&t&&(g.xp6(3),g.Q6J("formGroup",e.form),g.xp6(1),g.Q6J("ngIf",e.gaps.length>1),g.xp6(4),g.Q6J("options",g.lcZ(9,4,e.linkOptions$)),g.xp6(5),g.Q6J("disabled",!e.form.valid))},directives:[d.uh,d.xY,p._Y,p.JL,p.sg,f.O5,Z.P,p.JJ,p.u,d.H8,d.ZT,p.wV,p.Fj],pipes:[f.Ov],encapsulation:2}),t})();var A=c(9624),q=c(2420),T=c(9451),b=c(6972),x=c(4369),w=c(7307),C=c(4311),_=c(5722),S=c(487),U=c(8888);function N(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"th",20),g.TgZ(1,"input",21),g.NdJ("change",function(e){g.CHM(t);const c=g.oxw();return e?c.masterToggle():null}),g.qZA(),g.qZA()}if(2&t){const t=g.oxw();g.xp6(1),g.Q6J("checked",t.selection.hasValue()&&t.isAllSelected())}}function D(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"td",22),g.TgZ(1,"input",23),g.NdJ("click",function(t){return t.stopPropagation()})("change",function(e){const c=g.CHM(t).$implicit,n=g.oxw();return e?n.selection.toggle(c):null}),g.qZA(),g.qZA()}if(2&t){const t=e.$implicit,c=g.oxw();g.xp6(1),g.Q6J("checked",c.selection.isSelected(t))("disabled",!t.start||!t.stop)}}function v(t,e){1&t&&(g.TgZ(0,"th",24),g._uU(1,"APID"),g.qZA())}function Y(t,e){if(1&t&&(g.TgZ(0,"td",25),g._uU(1),g.qZA()),2&t){const t=e.$implicit;g.xp6(1),g.hij(" ",t.apid," ")}}function Q(t,e){1&t&&(g.TgZ(0,"th",24),g._uU(1,"Start"),g.qZA())}function J(t,e){if(1&t&&(g.TgZ(0,"td",25),g._uU(1),g.ALo(2,"datetime"),g.qZA()),2&t){const t=e.$implicit;g.xp6(1),g.hij(" ",g.lcZ(2,1,t.start)||"-"," ")}}function B(t,e){1&t&&(g.TgZ(0,"th",24),g._uU(1,"Stop"),g.qZA())}function R(t,e){if(1&t&&(g.TgZ(0,"td",25),g._uU(1),g.ALo(2,"datetime"),g.qZA()),2&t){const t=e.$implicit;g.xp6(1),g.hij(" ",g.lcZ(2,1,t.stop)||"-"," ")}}function $(t,e){1&t&&(g.TgZ(0,"th",24),g._uU(1,"Start sequence"),g.qZA())}function j(t,e){if(1&t&&(g.TgZ(0,"td",25),g._uU(1),g.qZA()),2&t){const t=e.$implicit;g.xp6(1),g.hij(" ",t.startSequenceCount||"-"," ")}}function E(t,e){1&t&&(g.TgZ(0,"th",24),g._uU(1,"Stop sequence"),g.qZA())}function M(t,e){if(1&t&&(g.TgZ(0,"td",25),g._uU(1),g.qZA()),2&t){const t=e.$implicit;g.xp6(1),g.hij(" ",t.stopSequenceCount||"-"," ")}}function P(t,e){1&t&&(g.TgZ(0,"th",26),g._uU(1,"Duration"),g.qZA())}function O(t,e){if(1&t&&(g.TgZ(0,"td",27),g._uU(1),g.ALo(2,"deltaWith"),g.qZA()),2&t){const t=e.$implicit;g.xp6(1),g.hij(" ",g.Dn7(2,1,t.stop,t.start,!1)||"-"," ")}}function G(t,e){1&t&&(g.TgZ(0,"th",24),g._uU(1,"Missing packets"),g.qZA())}function H(t,e){if(1&t&&(g.TgZ(0,"td",25),g._uU(1),g.qZA()),2&t){const t=e.$implicit;g.xp6(1),g.hij(" ",t.missingPacketCount||"-"," ")}}function L(t,e){1&t&&g._UZ(0,"tr",28)}function I(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"tr",29),g.NdJ("click",function(){const e=g.CHM(t).$implicit;return g.oxw().toggleOne(e)}),g.qZA()}if(2&t){const t=e.$implicit,c=g.oxw();g.ekj("selected",c.selection.isSelected(t))}}const V=[{path:"",canActivate:[s.a,i.z],canActivateChild:[s.a],runGuardsAndResolvers:"always",component:o.K,children:[{path:"",pathMatch:"full",component:(()=>{class t{constructor(t,e,c,n){this.yamcs=t,this.dialog=c,this.messageService=n,this.displayedColumns=["select","apid","start","stop","duration","startSequence","stopSequence","packetCount"],this.dataSource=new r.by,this.selection=new l.Ov(!0,[]),e.setTitle("Gaps"),t.yamcsClient.getGaps(t.instance).then(t=>{this.dataSource.data=t.gaps||[]})}isAllSelected(){return this.selection.selected.length===this.dataSource.data.length}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.data.forEach(t=>{t.start&&t.stop&&this.selection.select(t)})}toggleOne(t){t.start&&t.stop&&((!this.selection.isSelected(t)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(t))}openPlaybackDialog(){this.dialog.open(y,{data:{gaps:this.selection.selected}}).afterClosed().subscribe(t=>{t&&this.yamcs.yamcsClient.requestPlayback(this.yamcs.instance,t.link,{ranges:t.ranges}).then(()=>this.messageService.showInfo("Playback requested")).catch(t=>this.messageService.showError(t))})}refreshView(){this.yamcs.yamcsClient.getGaps(this.yamcs.instance).then(t=>{this.selection.clear(),this.dataSource.data=t.gaps||[]})}}return t.\u0275fac=function(e){return new(e||t)(g.Y36(u.C),g.Y36(A.Dx),g.Y36(d.uw),g.Y36(q.e))},t.\u0275cmp=g.Xpm({type:t,selectors:[["ng-component"]],decls:38,vars:4,consts:[["mat-button","","color","primary",3,"disabled","click"],["mat-icon-button","","matTooltip","Refresh view","color","primary",3,"click"],[1,"panel-content"],["mat-table","",1,"ya-data-table",3,"dataSource"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["matColumnDef","apid"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","start"],["matColumnDef","stop"],["matColumnDef","startSequence"],["matColumnDef","stopSequence"],["matColumnDef","duration"],["mat-header-cell","","class","vdiv","style","width: 100px",4,"matHeaderCellDef"],["mat-cell","","class","vdiv",4,"matCellDef"],["matColumnDef","packetCount"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"checked","change"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"checked","disabled","click","change"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"vdiv",2,"width","100px"],["mat-cell","",1,"vdiv"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(t,e){1&t&&(g.TgZ(0,"app-instance-page"),g.TgZ(1,"app-instance-toolbar"),g._uU(2," Gaps \xa0\xa0\xa0 "),g.TgZ(3,"button",0),g.NdJ("click",function(){return e.openPlaybackDialog()}),g.TgZ(4,"mat-icon"),g._uU(5,"redo"),g.qZA(),g._uU(6," REQUEST PLAYBACK "),g.qZA(),g.TgZ(7,"button",1),g.NdJ("click",function(){return e.refreshView()}),g.TgZ(8,"mat-icon"),g._uU(9,"refresh"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(10,"div",2),g.TgZ(11,"table",3),g.ynx(12,4),g.YNc(13,N,2,1,"th",5),g.YNc(14,D,2,2,"td",6),g.BQk(),g.ynx(15,7),g.YNc(16,v,2,0,"th",8),g.YNc(17,Y,2,1,"td",9),g.BQk(),g.ynx(18,10),g.YNc(19,Q,2,0,"th",8),g.YNc(20,J,3,3,"td",9),g.BQk(),g.ynx(21,11),g.YNc(22,B,2,0,"th",8),g.YNc(23,R,3,3,"td",9),g.BQk(),g.ynx(24,12),g.YNc(25,$,2,0,"th",8),g.YNc(26,j,2,1,"td",9),g.BQk(),g.ynx(27,13),g.YNc(28,E,2,0,"th",8),g.YNc(29,M,2,1,"td",9),g.BQk(),g.ynx(30,14),g.YNc(31,P,2,0,"th",15),g.YNc(32,O,3,5,"td",16),g.BQk(),g.ynx(33,17),g.YNc(34,G,2,0,"th",8),g.YNc(35,H,2,1,"td",9),g.BQk(),g.YNc(36,L,1,0,"tr",18),g.YNc(37,I,1,2,"tr",19),g.qZA(),g.qZA(),g.qZA()),2&t&&(g.xp6(3),g.Q6J("disabled",e.selection.isEmpty()),g.xp6(8),g.Q6J("dataSource",e.dataSource),g.xp6(25),g.Q6J("matHeaderRowDef",e.displayedColumns),g.xp6(1),g.Q6J("matRowDefColumns",e.displayedColumns))},directives:[T.a,b.k,x.lW,w.Hw,C.gM,r.BZ,_.fo,_.D5,_.O_,r.w1,r.fO,r.Dz,r.as,r.nj,r.ge,r.ev,r.XQ,r.Gk],pipes:[S.i,U.m],encapsulation:2,changeDetection:0}),t})()}]}];let z=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({imports:[[a.Bz.forChild(V)],a.Bz]}),t})(),F=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({imports:[[n.m,z]]}),t})()}}]);